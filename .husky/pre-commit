#!/bin/sh
# Pre-commit hook for dead code and quality checks
# Generated by @mathonsunday/dead-code-toolkit

set -e

echo "[Dead Code Toolkit] Running pre-commit checks..."

# Stage 1: lint-staged (on staged files only)
echo "[Stage 1/4] Running lint-staged (ESLint + Prettier)..."
npx lint-staged || {
  echo "❌ Lint-staged failed"
  exit 1
}

# Stage 2: Full type check
echo "[Stage 2/4] Running TypeScript type check..."
npm run type-check || {
  echo "❌ Type check failed"
  exit 1
}

# Stage 3: Dead code detection (optional - doesn't block on failure)
echo "[Stage 3/4] Checking for dead code..."
npm run dead-code || {
  echo "⚠️  Dead code detected. Consider running: npm run dead-code:fix"
  # Don't exit - just warn
}

# Stage 4: Run tests
echo "[Stage 4/4] Running tests..."
npm test -- --run || {
  echo "❌ Tests failed"
  exit 1
}

echo "✅ All pre-commit checks passed!"
exit 0