"use strict";var VisualToolkit=(()=>{var Ln=Object.defineProperty;var qt=Object.getOwnPropertyDescriptor;var Vt=Object.getOwnPropertyNames;var Ft=Object.prototype.hasOwnProperty;var X=(e,r)=>{for(var n in r)Ln(e,n,{get:r[n],enumerable:!0})},Nt=(e,r,n,a)=>{if(r&&typeof r=="object"||typeof r=="function")for(let t of Vt(r))!Ft.call(e,t)&&t!==n&&Ln(e,t,{get:()=>r[t],enumerable:!(a=qt(r,t))||a.enumerable});return e};var _t=e=>Nt(Ln({},"__esModule",{value:!0}),e);var Aa={};X(Aa,{amplitude:()=>oe,applyShadow:()=>Wr,bioGlow:()=>ze,bioluminescence:()=>ne,bob:()=>En,calculateDirectionalIllumination:()=>Jr,calculateIllumination:()=>ge,clearShadow:()=>zr,createBioParticles:()=>je,createDeepParticles:()=>Ne,createEye:()=>un,createEyes:()=>_n,createMarineSnow:()=>qe,createSeeker:()=>zn,createSeekerSwarm:()=>Me,cssBioGlow:()=>gn,cssBreathingGlow:()=>Fr,cssCreatureBody:()=>pn,cssDeepWater:()=>bn,cssDistantCreature:()=>fn,cssEyeGlow:()=>qr,cssFishGlow:()=>Yr,cssGlow:()=>Xr,cssHudGlow:()=>Vr,cssJellyfishBell:()=>cn,cssJellyfishGlow:()=>Hr,cssTimings:()=>Lr,darkness:()=>Ee,deepSea:()=>q,deepWaterBackground:()=>ie,depthPresets:()=>Yn,drawBarnacles:()=>Ze,drawBioParticles:()=>Je,drawBiolumGlow:()=>ln,drawCaustics:()=>Nn,drawEye:()=>hn,drawEyes:()=>Jn,drawGrille:()=>be,drawJellyfish:()=>rn,drawLens:()=>ke,drawLight:()=>Te,drawLightCone:()=>nn,drawMarineSnow:()=>Fe,drawOffsetShadow:()=>Er,drawOrganicSurface:()=>Ue,drawOrganicTexture:()=>Fn,drawPanelLines:()=>Re,drawPlayerLight:()=>Oe,drawROV:()=>en,drawScarring:()=>Qe,drawSeeker:()=>dn,drawSeekerSwarm:()=>we,drawSpecimen:()=>tn,drawTentacle:()=>Vn,drawTether:()=>$e,drawTrackingEye:()=>qn,drawWithDepth:()=>Nr,drift:()=>An,eyeGlow:()=>Ye,getTheme:()=>nt,getThemeNames:()=>rt,hexToRgb:()=>Kr,lightBeam:()=>He,material3D:()=>Se,materials:()=>Y,organicRadii:()=>jr,organicRadius:()=>_r,playerLight:()=>Xe,pulse:()=>he,radialGlow:()=>Hn,randomBioHue:()=>We,registerTheme:()=>re,scenes:()=>et,staggerDelay:()=>Ar,surfacePalettes:()=>K,themes:()=>tt,timing:()=>ee,updateDeepParticles:()=>_e,updateEye:()=>mn,updateEyes:()=>jn,updateMarineSnow:()=>Ve,updateSeeker:()=>ye,updateSeekerSwarm:()=>Ce,updateSeekerWithDrift:()=>Xn,vignette:()=>Pe,waver:()=>Wn});var ee={glacial:8e-4,verySlow:.001,slow:.002,medium:.003,fast:.005,rapid:.01},oe={micro:.02,small:.03,medium:.1,large:.3};function An(e,r=ee.verySlow,n=ee.slow){return{x:Math.sin(e*r)*oe.micro+Math.sin(e*n)*oe.micro*.5,y:Math.cos(e*r*1.1)*oe.micro+Math.cos(e*n*.9)*oe.micro*.3,rotation:Math.sin(e*ee.glacial)*oe.small}}function En(e,r=ee.slow,n=.02){return Math.sin(e*r)*n}function he(e,r=ee.medium,n=.8,a=1.2){let t=(Math.sin(e*r)+1)/2;return n+t*(a-n)}function Wn(e,r,n=ee.slow){return{x:Math.sin(e*n+r*.5)*.5,y:Math.cos(e*n+r*.3)*.5}}function zn(e,r){return{x:Math.random()*e,y:Math.random()*r,vx:0,vy:0,size:2+Math.random()*6,maxSpeed:1+Math.random()*3,awareness:150+Math.random()*250,timidity:.3+Math.random()*.7,glow:0,hue:180+Math.random()*40}}function ye(e,r,n,a,t,o){let i=r-e.x,s=n-e.y,l=Math.sqrt(i*i+s*s);l<e.awareness?a>15*e.timidity?(e.vx-=i/l*.5,e.vy-=s/l*.5,e.glow=Math.max(0,e.glow-.1)):l>40?(e.vx+=i/l*.08,e.vy+=s/l*.08,e.glow=Math.min(1,e.glow+.02)):(e.vx+=s/l*.1,e.vy-=i/l*.1,e.glow=1):(e.vx+=(Math.random()-.5)*.1,e.vy+=(Math.random()-.5)*.1,e.glow=Math.max(0,e.glow-.01));let d=Math.sqrt(e.vx*e.vx+e.vy*e.vy);d>e.maxSpeed&&(e.vx=e.vx/d*e.maxSpeed,e.vy=e.vy/d*e.maxSpeed),e.vx*=.98,e.vy*=.98,e.x+=e.vx,e.y+=e.vy,e.x<-50&&(e.x=t+50),e.x>t+50&&(e.x=-50),e.y<-50&&(e.y=o+50),e.y>o+50&&(e.y=-50)}function Me(e,r,n,a={}){let{spawnBias:t="uniform",sizeRange:o=[2,8],speedRange:i=[1,4],hueRange:s=[180,220]}=a,l=[];for(let d=0;d<e;d++){let u,m;switch(t){case"center":{let h=Math.random()*Math.PI*2,b=Math.random()*Math.random()*Math.min(r,n)*.4;u=r/2+Math.cos(h)*b,m=n/2+Math.sin(h)*b;break}case"edges":{let h=Math.floor(Math.random()*4),b=Math.random();switch(h){case 0:u=b*r,m=Math.random()*50;break;case 1:u=r-Math.random()*50,m=b*n;break;case 2:u=b*r,m=n-Math.random()*50;break;default:u=Math.random()*50,m=b*n}break}default:u=Math.random()*r,m=Math.random()*n}l.push({x:u,y:m,vx:0,vy:0,size:o[0]+Math.random()*(o[1]-o[0]),maxSpeed:i[0]+Math.random()*(i[1]-i[0]),awareness:150+Math.random()*250,timidity:.3+Math.random()*.7,glow:0,hue:s[0]+Math.random()*(s[1]-s[0])})}return l}function Xn(e,r,n,a,t,o,i=0){if(ye(e,r,n,a,t,o),i>0){let s=r-e.x,l=n-e.y;if(Math.sqrt(s*s+l*l)>e.awareness){let u=t/2,m=o/2,h=u-e.x,b=m-e.y,g=Math.sqrt(h*h+b*b);g>0&&(e.vx+=h/g*i,e.vy+=b/g*i)}}}function Ce(e,r,n,a,t,o,i=0){for(let s of e)i>0?Xn(s,r,n,a,t,o,i):ye(s,r,n,a,t,o)}function ln(e,r,n,a,t,o,i){let s=i!==void 0?(Math.sin(i*.003)+1)/2:1,l=o*(.7+s*.3),d=a*(.9+s*.2),u=e.createRadialGradient(r,n,0,r,n,d*3);u.addColorStop(0,`hsla(${t}, 70%, 60%, ${l*.6})`),u.addColorStop(.5,`hsla(${t}, 60%, 40%, ${l*.2})`),u.addColorStop(1,"transparent"),e.fillStyle=u,e.beginPath(),e.arc(r,n,d*3,0,Math.PI*2),e.fill(),e.fillStyle=`hsla(${t}, 50%, 70%, ${l*.8})`,e.beginPath(),e.arc(r,n,d*.6,0,Math.PI*2),e.fill(),e.fillStyle=`hsla(${t}, 30%, 90%, ${l*.9})`,e.beginPath(),e.arc(r,n,d*.2,0,Math.PI*2),e.fill()}function dn(e,r,n=150,a,t,o){let i=r.glow;if(a!==void 0&&t!==void 0){let s=Math.sqrt((r.x-a)**2+(r.y-t)**2);s<n&&(i=Math.max(i,(1-s/n)*.8))}i<.05||ln(e,r.x,r.y,r.size,r.hue,i,o)}function we(e,r,n={}){let{lightX:a,lightY:t,lightRadius:o=150,time:i}=n,s=[...r].sort((l,d)=>{let u=l.glow,m=d.glow;if(a!==void 0&&t!==void 0){let h=Math.sqrt((l.x-a)**2+(l.y-t)**2),b=Math.sqrt((d.x-a)**2+(d.y-t)**2);h<o&&(u=Math.max(u,(1-h/o)*.8)),b<o&&(m=Math.max(m,(1-b/o)*.8))}return u-m});for(let l of s)dn(e,l,o,a,t,i)}var Lr={pulse:"4s",drift:"8s",creature:"12s",ambient:"20s",glacial:"30s"};function Ar(e,r=.3){return`${e*r}s`}function Se(e,r,n,a,t,o){let i=e.createLinearGradient(r,n,r,n+t);return i.addColorStop(0,o.highlight),i.addColorStop(.5,o.mid),i.addColorStop(1,o.shadow),i}function Hn(e,r,n,a,t,o){let i=e.createRadialGradient(r,n,a,r,n,t);return i.addColorStop(0,o.core),i.addColorStop(.4,o.mid),i.addColorStop(.7,o.outer),i.addColorStop(1,"transparent"),i}function Pe(e,r,n,a,t,o=.5){let i=e.createRadialGradient(r,n,a,r,n,t);return i.addColorStop(0,"transparent"),i.addColorStop(1,`rgba(0, 0, 0, ${o})`),i}function Er(e,r,n=4,a=4,t="rgba(0, 0, 0, 0.4)"){e.save(),e.translate(n,a),e.fillStyle=t,r(),e.restore()}function Wr(e,r,n,a=0,t=0){e.shadowColor=n,e.shadowBlur=r,e.shadowOffsetX=a,e.shadowOffsetY=t}function zr(e){e.shadowColor="transparent",e.shadowBlur=0,e.shadowOffsetX=0,e.shadowOffsetY=0}function Xr(e,r="medium"){let n={subtle:[.3,.15],medium:[.6,.3],strong:[.9,.5]},[a,t]=n[r],o=e.match(/rgba?\((\d+),\s*(\d+),\s*(\d+)/);if(!o)return"none";let[,i,s,l]=o;return`
    0 0 20px rgba(${i}, ${s}, ${l}, ${a}),
    0 0 40px rgba(${i}, ${s}, ${l}, ${t})
  `.trim()}function Hr(){return`
    0 0 20px rgba(150, 200, 255, 0.3),
    inset 0 -10px 20px rgba(100, 180, 255, 0.2)
  `.trim()}function Yr(){return`
    0 0 10px rgba(100, 200, 255, 0.5),
    0 0 20px rgba(80, 180, 255, 0.3)
  `.trim()}function qr(){return`
    0 0 15px rgba(255, 100, 80, 0.6),
    0 0 30px rgba(255, 80, 60, 0.3)
  `.trim()}function Vr(){return"0 0 10px rgba(77, 208, 225, 0.3)"}function Fr(){return{dim:"0 0 10px rgba(77, 208, 225, 0.2)",bright:"0 0 25px rgba(77, 208, 225, 0.5)"}}var Yn={equipment:{shadowOffset:{x:4,y:4},shadowColor:"rgba(0, 0, 0, 0.4)",outlineWidth:2,outlineColor:"#8a5a15"},light:{shadowOffset:{x:2,y:2},shadowColor:"rgba(0, 0, 0, 0.3)",outlineWidth:1,outlineColor:"#cc4420"},creature:{shadowOffset:{x:0,y:0},shadowColor:"transparent",outlineWidth:0,outlineColor:"transparent"}};function Nr(e,r,n,a){let t=Yn[r];(t.shadowOffset.x!==0||t.shadowOffset.y!==0)&&(e.save(),e.translate(t.shadowOffset.x,t.shadowOffset.y),e.fillStyle=t.shadowColor,n(),e.restore()),e.fillStyle=a,n(),t.outlineWidth>0&&(e.strokeStyle=t.outlineColor,e.lineWidth=t.outlineWidth,n(),e.stroke())}function _r(){let e=[40+Math.random()*30,40+Math.random()*30,40+Math.random()*30,40+Math.random()*30];return`${e[0]}% ${e[1]}% ${e[2]}% ${e[3]}%`}var jr={blob:"60% 50% 45% 55%",fish:"60% 40% 40% 60%",bell:"50% 50% 40% 40%",head:"55% 45% 50% 50%",tail:"30% 70% 60% 40%"};function Re(e,r,n,a,t,o=[.25,.75],i="rgba(100, 60, 20, 0.5)"){e.strokeStyle=i,e.lineWidth=1;for(let s of o){let l=r+a*s;e.beginPath(),e.moveTo(l,n),e.lineTo(l,n+t),e.stroke()}}function be(e,r,n,a,t,o=4,i="#555"){e.strokeStyle=i,e.lineWidth=2;let s=t/(o+1);for(let l=1;l<=o;l++){let d=n+s*l;e.beginPath(),e.moveTo(r,d),e.lineTo(r+a,d),e.stroke()}}function $e(e,r,n,a,t,o,i=10,s="rgba(80, 80, 80, 0.6)"){e.strokeStyle=s,e.lineWidth=3,e.setLineDash([8,4]);let l=r+Math.sin(o*.002)*i;e.beginPath(),e.moveTo(r,n),e.lineTo(l,t),e.stroke(),e.setLineDash([])}function ke(e,r,n,a,t,o="#222",i="#1a1a2e",s="rgba(100, 150, 200, 0.5)"){e.fillStyle=o,e.beginPath(),e.arc(r,n,a,0,Math.PI*2),e.fill(),e.fillStyle=i,e.beginPath(),e.arc(r,n,t,0,Math.PI*2),e.fill(),e.fillStyle=s,e.beginPath(),e.arc(r-2,n-2,t*.4,0,Math.PI*2),e.fill()}function Te(e,r,n,a,t,o){if(e.fillStyle="#444",e.beginPath(),e.arc(r,n,a,0,Math.PI*2),e.fill(),t){let i=.8+Math.sin(o*.005)*.1,s=e.createRadialGradient(r,n,0,r,n,a*8);s.addColorStop(0,`rgba(255, 250, 230, ${i})`),s.addColorStop(.2,`rgba(255, 240, 200, ${i*.5})`),s.addColorStop(1,"rgba(255, 240, 200, 0)"),e.fillStyle=s,e.beginPath(),e.arc(r,n,a*8,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(255, 255, 240, ${i})`,e.beginPath(),e.arc(r,n,a*.6,0,Math.PI*2),e.fill()}}function qn(e,r,n,a,t,o,i=0){let s=30+i*30,l=e.createRadialGradient(r,n,0,r,n,s);l.addColorStop(0,`rgba(${180+i*75}, ${60+i*40}, ${60+i*20}, 0.8)`),l.addColorStop(.5,`rgba(${120+i*60}, 40, 40, 0.3)`),l.addColorStop(1,"transparent"),e.fillStyle=l,e.beginPath(),e.arc(r,n,s,0,Math.PI*2),e.fill();let d=a*(1+i*.5);e.fillStyle=`rgba(${200+i*55}, ${80+i*80}, ${60+i*40}, 1)`,e.beginPath(),e.arc(r,n,d,0,Math.PI*2),e.fill();let u=t-r,m=o-n,h=Math.sqrt(u*u+m*m),b=h>0?u/h*3:0,g=h>0?m/h*3:0;e.fillStyle="rgba(10, 0, 0, 1)",e.beginPath(),i>.4?e.ellipse(r+b,n+g,2,d*.7,0,0,Math.PI*2):e.arc(r+b,n+g,4-i*2,0,Math.PI*2),e.fill()}function Vn(e,r,n,a="rgba(10, 10, 15, 0.9)"){if(!(r.length<2)){e.beginPath(),e.moveTo(r[0].x,r[0].y);for(let t=1;t<r.length;t++)e.lineTo(r[t].x,r[t].y);e.strokeStyle=a,e.lineWidth=n,e.lineCap="round",e.stroke()}}function ge(e,r,n,a,t=200){let o=e-n,i=r-a,s=Math.sqrt(o*o+i*i);if(s>=t)return 0;let l=1-s/t;return l*l}function Jr(e,r,n,a,t,o=200){let i=ge(e,r,n,a,o);if(i===0)return 0;let s=e-n,l=r-a,d=Math.atan2(l,s),u=Math.abs(d-t),h=1-Math.min(u,Math.PI*2-u)/Math.PI;return i*(.3+h*.7)}function Oe(e,r,n,a=120,t={}){let{intensity:o=1,pulseTime:i,coreColor:s={r:255,g:255,b:255},ambientColor:l={r:180,g:220,b:255}}=t,d=i!==void 0?Math.sin(i*.003)*20:0,u=a+d;for(let h=5;h>=1;h--){let b=u*(h/2),g=.15/h*o,p=e.createRadialGradient(r,n,0,r,n,b);p.addColorStop(0,`rgba(${l.r}, ${l.g}, ${l.b}, ${g})`),p.addColorStop(.5,`rgba(${Math.round(l.r*.55)}, ${l.g}, ${Math.round(l.b*.85)}, ${g*.5})`),p.addColorStop(1,"transparent"),e.fillStyle=p,e.beginPath(),e.arc(r,n,b,0,Math.PI*2),e.fill()}let m=e.createRadialGradient(r,n,0,r,n,15);m.addColorStop(0,`rgba(${s.r}, ${s.g}, ${s.b}, ${.9*o})`),m.addColorStop(.5,`rgba(${Math.round(s.r*.8)}, ${Math.round(s.g*.94)}, ${s.b}, ${.5*o})`),m.addColorStop(1,"transparent"),e.fillStyle=m,e.beginPath(),e.arc(r,n,15,0,Math.PI*2),e.fill()}function Fn(e,r,n,a={}){let{density:t=20,color:o={r:20,g:30,b:40},intensity:i=.15,time:s=0,seed:l=12345}=a,d=u=>{let m=Math.sin(l+u*127.1)*43758.5453;return m-Math.floor(m)};for(let u=0;u<t;u++){let m=d(u)*r,h=d(u+1e3)*n,b=s>0?Math.sin(s*8e-4+u*.5)*3:0,g=s>0?Math.cos(s*6e-4+u*.3)*2:0,p=m+b,v=h+g,c=30+d(u+2e3)*80,f=i*(.5+d(u+3e3)*.5),C=e.createRadialGradient(p,v,0,p,v,c);C.addColorStop(0,`rgba(${o.r}, ${o.g}, ${o.b}, ${f})`),C.addColorStop(.6,`rgba(${o.r}, ${o.g}, ${o.b}, ${f*.3})`),C.addColorStop(1,"transparent"),e.fillStyle=C,e.beginPath(),e.arc(p,v,c,0,Math.PI*2),e.fill()}}function Nn(e,r,n,a,t={}){let{count:o=5,heightRatio:i=.4,intensity:s=.03}=t;for(let l=0;l<o;l++){let d=(Math.sin(a*.001+l)*.3+.5)*r,u=n*.1,m=e.createRadialGradient(d,u,0,d,u,150);m.addColorStop(0,`rgba(100, 150, 200, ${s})`),m.addColorStop(1,"rgba(100, 150, 200, 0)"),e.fillStyle=m,e.fillRect(0,0,r,n*i)}}function un(e){return{x:e.x,y:e.y,size:e.size??8,openness:1,awarenessRadius:e.awarenessRadius??200,blinkTimer:2e3+Math.random()*3e3,isBlinking:!1,blinkProgress:0,dilation:.5,hue:e.hue??0,illumination:0,pupilOffset:{x:0,y:0}}}function mn(e,r,n,a=16){e.illumination=ge(r,n,e.x,e.y,e.awarenessRadius);let t=r-e.x,o=n-e.y,i=Math.sqrt(t*t+o*o);if(i>0){let l=e.size*.3,d=t/i*l,u=o/i*l;e.pupilOffset.x+=(d-e.pupilOffset.x)*.1,e.pupilOffset.y+=(u-e.pupilOffset.y)*.1}let s=1-e.illumination*.8;e.dilation+=(s-e.dilation)*.05,e.isBlinking?(e.blinkProgress+=a/150,e.blinkProgress<.5?e.openness=1-e.blinkProgress*2:e.openness=(e.blinkProgress-.5)*2,e.blinkProgress>=1&&(e.isBlinking=!1,e.blinkProgress=0,e.openness=1,e.blinkTimer=2e3+Math.random()*4e3)):(e.blinkTimer-=a,e.blinkTimer<=0&&(e.isBlinking=!0,e.blinkProgress=0))}function hn(e,r,n={}){let{showGlow:a=!0,glowSize:t=2.5}=n,o=r.size*r.openness;if(o<.5)return;let i=r.hue===0||r.hue<60?200:100,s=r.hue>30&&r.hue<90?150:50,l=r.hue>150?200:50,d=r.illumination*55,u=Math.min(255,i+d),m=Math.min(255,s+r.illumination*40),h=Math.min(255,l+r.illumination*20);if(a){let p=o*t+r.illumination*o,v=e.createRadialGradient(r.x,r.y,0,r.x,r.y,p);v.addColorStop(0,`rgba(${u}, ${m}, ${h}, ${.6+r.illumination*.2})`),v.addColorStop(.5,`rgba(${u*.6}, ${m*.6}, ${h*.6}, ${.2+r.illumination*.2})`),v.addColorStop(1,"transparent"),e.fillStyle=v,e.beginPath(),e.arc(r.x,r.y,p,0,Math.PI*2),e.fill()}e.fillStyle=`rgba(${u}, ${m}, ${h}, ${.8+r.illumination*.2})`,e.beginPath(),e.arc(r.x,r.y,o,0,Math.PI*2),e.fill();let b=r.x+r.pupilOffset.x,g=r.y+r.pupilOffset.y;if(e.fillStyle="rgba(10, 0, 0, 0.9)",e.beginPath(),r.illumination>.4){let p=2*r.dilation,v=o*.7;e.ellipse(b,g,p,v,0,0,Math.PI*2)}else{let p=2+r.dilation*2;e.arc(b,g,p,0,Math.PI*2)}e.fill(),r.openness>.5&&(e.fillStyle=`rgba(255, 255, 255, ${.3*r.openness})`,e.beginPath(),e.arc(r.x-o*.3,r.y-o*.3,o*.2,0,Math.PI*2),e.fill())}function _n(e){return e.map(un)}function jn(e,r,n,a=16){for(let t of e)mn(t,r,n,a)}function Jn(e,r,n){for(let a of r)hn(e,a,n)}function Kr(e){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:{r:0,g:0,b:0}}var Ie=class{constructor(r){this.onFrame=r;this.animationId=null;this.frameCount=0;this.lastFrameTime=0;this.isRunning=!1;this.render=()=>{if(!this.isRunning)return;let r=performance.now(),n=r-this.lastFrameTime;this.lastFrameTime=r,this.onFrame(this.frameCount,n),this.frameCount++,this.animationId=requestAnimationFrame(this.render)}}start(){this.isRunning||(this.isRunning=!0,this.lastFrameTime=performance.now(),this.frameCount=0,this.render())}stop(){this.animationId!==null&&(cancelAnimationFrame(this.animationId),this.animationId=null),this.isRunning=!1}reset(){this.frameCount=0,this.lastFrameTime=performance.now()}getFrameNum(){return this.frameCount}isRunning_(){return this.isRunning}};var De=class{constructor(r){this.resizeObserver=null;this.canvas=r}startResizing(){if(this.resizeObserver)return;let r=this.handleResize.bind(this);this.resizeObserver=new ResizeObserver(r),this.handleResize(),this.resizeObserver.observe(this.canvas.parentElement)}stopResizing(){this.resizeObserver&&(this.resizeObserver.disconnect(),this.resizeObserver=null)}registerResizeCallback(r){this.resizeCallback=r}getSize(){return{width:this.canvas.width,height:this.canvas.height}}getCenter(){return{x:this.canvas.width/2,y:this.canvas.height/2}}getBounds(){return this.canvas.getBoundingClientRect()}handleResize(){let r=this.canvas.getBoundingClientRect(),n=window.devicePixelRatio||1;this.canvas.width=r.width*n,this.canvas.height=r.height*n;let a=this.canvas.getContext("2d");a&&a.scale(n,n),this.resizeCallback&&this.resizeCallback()}};var Ge=class{constructor(r){this.pos={x:-1e3,y:-1e3,angle:0,distance:0,isOver:!1};this.centerX=0;this.centerY=0;this.onMouseMove=this.handleMouseMove.bind(this);this.onMouseLeave=this.handleMouseLeave.bind(this);this.onMouseEnter=this.handleMouseEnter.bind(this);this.canvas=r,this.updateCenter()}startTracking(){this.canvas.addEventListener("mousemove",this.onMouseMove),this.canvas.addEventListener("mouseleave",this.onMouseLeave),this.canvas.addEventListener("mouseenter",this.onMouseEnter)}stopTracking(){this.canvas.removeEventListener("mousemove",this.onMouseMove),this.canvas.removeEventListener("mouseleave",this.onMouseLeave),this.canvas.removeEventListener("mouseenter",this.onMouseEnter)}getPosition(){return{...this.pos}}isOver(){return this.pos.isOver}updateCenter(){this.centerX=this.canvas.width/2,this.centerY=this.canvas.height/2}handleMouseMove(r){let n=this.canvas.getBoundingClientRect(),a=(r.clientX-n.left)*(this.canvas.width/n.width),t=(r.clientY-n.top)*(this.canvas.height/n.height);this.pos.x=a,this.pos.y=t;let o=a-this.centerX,i=t-this.centerY;this.pos.distance=Math.sqrt(o*o+i*i),this.pos.angle=Math.atan2(i,o)*(180/Math.PI),this.pos.angle<0&&(this.pos.angle+=360),this.pos.isOver=!0}handleMouseLeave(){this.pos.x=-1e3,this.pos.y=-1e3,this.pos.isOver=!1}handleMouseEnter(){this.pos.isOver=!0}};var _=class{constructor(){this.frameNum=0;this.deltaTime=0}async init(r,n){this.canvas=r,this.ctx=r.getContext("2d"),this.config={...this.defaultConfig,...n},this.responsiveCanvas=new De(r),this.responsiveCanvas.registerResizeCallback(()=>this.onCanvasResize()),this.responsiveCanvas.startResizing(),this.animationLoop=new Ie((a,t)=>{this.frameNum=a,this.deltaTime=t,this.render(this.ctx,t),this.config.onFrame&&this.config.onFrame(a,t)}),await this.onInit(),this.animationLoop.start()}cleanup(){this.animationLoop?.stop(),this.responsiveCanvas?.stopResizing(),this.cursorManager?.stopTracking(),this.onCleanup()}async onInit(){}onCanvasResize(){}onCleanup(){}startCursorTracking(){if(this.cursorManager||(this.cursorManager=new Ge(this.canvas)),this.cursorManager.startTracking(),this.responsiveCanvas){let r=this.onCanvasResize.bind(this),n=()=>{this.cursorManager?.updateCenter(),r()};this.onCanvasResize=n}}getCursorPos(){return this.cursorManager?.getPosition()??{x:-1e3,y:-1e3,angle:0,distance:0,isOver:!1}}getCanvasSize(){return this.responsiveCanvas?.getSize()??{width:this.canvas.width,height:this.canvas.height}}getCanvasCenter(){return this.responsiveCanvas?.getCenter()??{x:this.canvas.width/2,y:this.canvas.height/2}}};var Be=class extends _{constructor(){super(...arguments);this.name="Shadows";this.description="Jellyfish-like creatures drifting in the deep";this.defaultConfig={intensity:.5,scale:1,duration:1/0};this.shadows=[];this.particles=[];this.time=0;this.lastW=0;this.lastH=0}async onInit(){this.startCursorTracking();for(let n=0;n<10;n++)this.particles.push({x:Math.random(),y:Math.random(),size:.5+Math.random()*1.5,speed:5e-4+Math.random()*.001,alpha:.1+Math.random()*.2});this.resizeShadows()}onCanvasResize(){let{width:n,height:a}=this.getCanvasSize();(this.shadows.length===0||Math.abs(n-this.lastW)>20||Math.abs(a-this.lastH)>20)&&this.resizeShadows()}onCleanup(){this.shadows=[],this.particles=[]}render(n,a){let{width:t,height:o}=this.getCanvasSize(),i=this.getCursorPos(),s=n.createLinearGradient(0,0,0,o);if(s.addColorStop(0,"#0a0f2e"),s.addColorStop(.5,"#020810"),s.addColorStop(1,"#000305"),n.fillStyle=s,n.fillRect(0,0,t,o),this.updateAndDrawShadows(n,t,o),i.isOver){let d=n.createRadialGradient(i.x,i.y,0,i.x,i.y,200);d.addColorStop(0,"rgba(200, 240, 255, 0.3)"),d.addColorStop(.5,"rgba(100, 180, 220, 0.1)"),d.addColorStop(1,"transparent"),n.fillStyle=d,n.beginPath(),n.arc(i.x,i.y,200,0,Math.PI*2),n.fill()}for(let d of this.particles)d.y+=d.speed,d.x+=Math.sin(this.time*.001+d.y*5)*3e-4,d.y>1.05&&(d.y=-.05,d.x=Math.random()),n.fillStyle=`rgba(150, 180, 200, ${d.alpha})`,n.beginPath(),n.arc(d.x*t,d.y*o,d.size,0,Math.PI*2),n.fill();let l=n.createRadialGradient(t/2,o/2,o*.25,t/2,o/2,o*.85);l.addColorStop(0,"transparent"),l.addColorStop(1,"rgba(0, 0, 0, 0.4)"),n.fillStyle=l,n.fillRect(0,0,t,o),this.time+=a}resizeShadows(){let{width:n,height:a}=this.getCanvasSize();this.shadows=[];let t=4+Math.floor(Math.random()*4);for(let o=0;o<t;o++)this.shadows.push({x:Math.random()*n,y:Math.random()*a,vx:(Math.random()-.5)*2,vy:(Math.random()-.5)*1.5-.5,size:60+Math.random()*80,bellSize:40+Math.random()*50,tentacleCount:5+Math.floor(Math.random()*4),angle:Math.random()*Math.PI*2,angleSpeed:(Math.random()-.5)*.03,pulsePhase:Math.random()*Math.PI*2,pulseSpeed:.5+Math.random()*.5,timeOffset:Math.random()*1e3});this.lastW=n,this.lastH=a}calculateIllumination(n,a,t){if(!t.isOver)return 0;let o=n-t.x,i=a-t.y,s=o*o+i*i,l=200,d=l*l;return s<d?Math.pow(1-Math.sqrt(s)/l,2.5):0}updateAndDrawShadows(n,a,t){let o=this.getCursorPos();for(let i of this.shadows){i.x+=i.vx,i.y+=i.vy,i.angle+=i.angleSpeed,i.pulsePhase+=i.pulseSpeed*.01,Math.random()<.01&&(i.vx+=(Math.random()-.5)*.5,i.vy+=(Math.random()-.5)*.3),i.x<-i.size*2&&(i.x=a+i.size),i.x>a+i.size*2&&(i.x=-i.size),i.y<-i.size*2&&(i.y=t+i.size),i.y>t+i.size*2&&(i.y=-i.size);let s=Math.sqrt(i.vx**2+i.vy**2);s>3&&(i.vx=i.vx/s*3,i.vy=i.vy/s*3),i.vx*=.995,i.vy*=.995}for(let i of this.shadows){n.save();let s=this.time*.001+i.timeOffset,l=Math.sin(i.pulsePhase)*.15+1,d=i.bellSize*l;n.translate(i.x,i.y),n.rotate(i.angle),n.beginPath();let u=12;for(let p=0;p<=u;p++){let v=p/u*Math.PI*2,c=d*(.7+Math.sin(v*3+s)*.1),f=Math.cos(v)*c,C=Math.sin(v)*c-d*.3;p===0?n.moveTo(f,C):n.lineTo(f,C)}n.closePath();let m=this.calculateIllumination(i.x,i.y,o),b=.8+m*.08;n.fillStyle=`rgba(5, 3, 8, ${b})`,n.shadowBlur=12,n.shadowColor="rgba(0, 0, 0, 0.4)",n.fill();let g=i.size*1.5;for(let p=0;p<i.tentacleCount;p++){let v=p/i.tentacleCount*Math.PI*2,c=Math.cos(v)*d*.6,f=Math.sin(v)*d*.3,C=8;n.beginPath(),n.moveTo(c,f);for(let $=1;$<=C;$++){let w=$/C,T=c+Math.sin(s*1.5+p+w*2)*d*.15,P=f+w*g+Math.sin(s*2+p*2+w*3)*d*.1;n.lineTo(T,P)}let y=.8+m*.08;n.strokeStyle=`rgba(5, 3, 8, ${y})`,n.lineWidth=d*.1,n.lineCap="round",n.lineJoin="round",n.shadowBlur=6,n.shadowColor="rgba(0, 0, 0, 0.3)",n.stroke()}n.restore()}}},to=new Be;var Le=class extends _{constructor(){super(...arguments);this.name="ROV Exterior";this.description="External camera - ROV Nereid descent";this.defaultConfig={intensity:.7,duration:1/0};this.time=0;this.particles=[];this.timing={glacial:8e-4,verySlow:.001,slow:.002};this.deepSea={surface:"#020810",mid:"#051018",deep:"#020a12",abyss:"#010508"};this.materials={rovYellow:{highlight:"#e8a832",mid:"#d4942a",shadow:"#b87820",outline:"#8a5a15"},flotation:{fill:"#ff6b35",outline:"#cc4420"},metal:{light:"#666",mid:"#444",dark:"#333",darkest:"#222"},lens:{body:"#1a1a2e",glint:"rgba(100, 150, 200, 0.5)"},panel:{line:"rgba(100, 60, 20, 0.5)"}};this.rov={x:.5,y:.45}}async onInit(){this.particles=[];for(let n=0;n<80;n++)this.particles.push({x:Math.random(),y:Math.random(),size:Math.random()*2+.5,speed:Math.random()*.008+.003,alpha:Math.random()*.5+.2})}onCanvasResize(){}render(n,a){let t=this.canvas.width/window.devicePixelRatio,o=this.canvas.height/window.devicePixelRatio,i=n.createLinearGradient(0,0,0,o);i.addColorStop(0,this.deepSea.surface),i.addColorStop(.3,this.deepSea.mid),i.addColorStop(.6,this.deepSea.deep),i.addColorStop(1,this.deepSea.abyss),n.fillStyle=i,n.fillRect(0,0,t,o);for(let h=0;h<3;h++){let b=(Math.sin(this.time*this.timing.glacial+h)*.3+.5)*t,g=n.createRadialGradient(b,o*.1,0,b,o*.1,150);g.addColorStop(0,"rgba(100, 150, 200, 0.03)"),g.addColorStop(1,"transparent"),n.fillStyle=g,n.fillRect(0,0,t,o*.4)}for(let h of this.particles)h.y-=h.speed,h.y<-.05&&(h.y=1.05,h.x=Math.random()),n.beginPath(),n.arc(h.x*t,h.y*o,h.size,0,Math.PI*2),n.fillStyle=`rgba(180, 200, 220, ${h.alpha})`,n.fill();let s=this.drift(this.time),l=(this.rov.x+s.x)*t,d=(this.rov.y+s.y)*o;this.drawROV(n,l,d,1.2),n.save(),n.translate(l,d),n.rotate(s.rotation);let u=n.createLinearGradient(0,50,0,o*.6);u.addColorStop(0,"rgba(255, 250, 230, 0.15)"),u.addColorStop(.5,"rgba(200, 220, 255, 0.05)"),u.addColorStop(1,"transparent"),n.fillStyle=u,n.beginPath(),n.moveTo(-35,50),n.lineTo(-80,o*.5),n.lineTo(80,o*.5),n.lineTo(35,50),n.closePath(),n.fill(),n.restore();let m=n.createRadialGradient(t/2,o/2,o*.3,t/2,o/2,o*.8);m.addColorStop(0,"transparent"),m.addColorStop(1,"rgba(0, 0, 0, 0.5)"),n.fillStyle=m,n.fillRect(0,0,t,o),this.time+=16}onCleanup(){}drift(n){return{x:Math.sin(n*this.timing.verySlow)*.02+Math.sin(n*this.timing.slow)*.01,y:Math.cos(n*this.timing.verySlow*1.1)*.02+Math.cos(n*this.timing.slow*.9)*.006,rotation:Math.sin(n*this.timing.glacial)*.03}}material3D(n,a,t,o,i,s){let l=n.createLinearGradient(a,t,a,t+i);return l.addColorStop(0,s.highlight),l.addColorStop(.5,s.mid),l.addColorStop(1,s.shadow),l}drawPanelLines(n,a,t,o,i,s){n.strokeStyle=this.materials.panel.line,n.lineWidth=1;for(let l of s){let d=a+o*l;n.beginPath(),n.moveTo(d,t),n.lineTo(d,t+i),n.stroke()}}drawGrille(n,a,t,o,i,s){n.strokeStyle=this.materials.metal.light,n.lineWidth=2;let l=i/(s+1);for(let d=1;d<=s;d++){let u=t+l*d;n.beginPath(),n.moveTo(a,u),n.lineTo(a+o,u),n.stroke()}}drawLens(n,a,t,o,i){n.fillStyle=this.materials.metal.darkest,n.beginPath(),n.arc(a,t,o,0,Math.PI*2),n.fill(),n.fillStyle=this.materials.lens.body,n.beginPath(),n.arc(a,t,i,0,Math.PI*2),n.fill(),n.fillStyle=this.materials.lens.glint,n.beginPath(),n.arc(a-2,t-2,i*.4,0,Math.PI*2),n.fill()}drawLight(n,a,t,o,i){if(n.fillStyle=this.materials.metal.mid,n.beginPath(),n.arc(a,t,o,0,Math.PI*2),n.fill(),i){let s=.8+Math.sin(this.time*this.timing.slow)*.1,l=n.createRadialGradient(a,t,0,a,t,o*8);l.addColorStop(0,`rgba(255, 250, 230, ${s})`),l.addColorStop(.2,`rgba(255, 240, 200, ${s*.5})`),l.addColorStop(1,"rgba(255, 240, 200, 0)"),n.fillStyle=l,n.beginPath(),n.arc(a,t,o*8,0,Math.PI*2),n.fill(),n.fillStyle=`rgba(255, 255, 240, ${s})`,n.beginPath(),n.arc(a,t,o*.6,0,Math.PI*2),n.fill()}}drawTether(n,a,t,o,i){n.strokeStyle="rgba(80, 80, 80, 0.6)",n.lineWidth=3,n.setLineDash([8,4]);let s=a+Math.sin(this.time*this.timing.slow)*i;n.beginPath(),n.moveTo(a,t),n.lineTo(s,o),n.stroke(),n.setLineDash([])}drawROV(n,a,t,o){n.save(),n.translate(a,t);let i=this.drift(this.time);n.rotate(i.rotation),n.scale(o,o);let s=80,l=50;n.fillStyle="rgba(0, 0, 0, 0.4)",n.fillRect(-s/2+4,-l/2+4,s,l),n.fillStyle=this.material3D(n,-s/2,-l/2,s,l,this.materials.rovYellow),n.fillRect(-s/2,-l/2,s,l),n.strokeStyle=this.materials.rovYellow.outline,n.lineWidth=2,n.strokeRect(-s/2,-l/2,s,l),this.drawPanelLines(n,-s/2,-l/2,s,l,[.25,.75]),n.fillStyle=this.materials.flotation.fill,n.fillRect(-s/2+5,-l/2-15,s-10,15),n.strokeStyle=this.materials.flotation.outline,n.strokeRect(-s/2+5,-l/2-15,s-10,15),n.fillStyle=this.materials.metal.dark,n.fillRect(-s/2-15,-10,15,20),n.fillRect(s/2,-10,15,20),this.drawGrille(n,-s/2-15,-10,15,20,4),this.drawGrille(n,s/2,-10,15,20,4),this.drawLens(n,0,l/2+10,12,8),this.drawLight(n,-25,l/2+5,8,!0),this.drawLight(n,25,l/2+5,8,!0),n.strokeStyle=this.materials.metal.light,n.lineWidth=4,n.lineCap="round",n.beginPath(),n.moveTo(-s/2+10,l/2),n.lineTo(-s/2+5,l/2+20),n.lineTo(-s/2+15,l/2+25),n.stroke(),this.drawTether(n,0,-l/2-15,-l/2-100,10),n.restore()}},io=new Le;var Ae=class extends _{constructor(){super(...arguments);this.name="The Wall";this.description="A massive organic surface covered in watching eyes";this.defaultConfig={intensity:.8,duration:1/0};this.time=0;this.eyes=[];this.particles=[];this.mottledBase=null;this.timing={glacial:8e-4,verySlow:.001,slow:.002,medium:.003};this.palette={base:{r:28,g:22,b:26},mid:{r:38,g:30,b:35},highlight:{r:58,g:48,b:52},shadow:{r:18,g:14,b:18},vein:{r:50,g:28,b:35},veinHighlight:{r:85,g:50,b:55}};this.F2=.5*(Math.sqrt(3)-1);this.G2=(3-Math.sqrt(3))/6;this.grad3=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]];this.perm=[]}async onInit(){this.startCursorTracking(),this.perm=this.createPerm(42),this.eyes=[];for(let n=0;n<12;n++)this.eyes.push({x:Math.random()*.85+.075,y:Math.random()*.85+.075,size:5+Math.random()*12,openness:0,awareness:100+Math.random()*120,blinkTimer:Math.random()*500,isBlinking:!1});this.particles=[];for(let n=0;n<15;n++)this.particles.push({x:Math.random(),y:Math.random(),size:Math.random()*1.5+.5,speed:Math.random()*.002+.001,alpha:Math.random()*.3+.1})}onCanvasResize(){this.mottledBase=null,this.cursorManager?.updateCenter()}render(n,a){let{width:t,height:o}=this.getCanvasSize(),i=t,s=o,l=this.cursorManager?this.cursorManager.getPosition():{x:-1e3,y:-1e3},d={x:l.x>=0&&l.x<=i?l.x:-1e3,y:l.y>=0&&l.y<=s?l.y:-1e3};if(this.drawOrganicSurface(n,i,s,{lightX:d.x,lightY:d.y,time:this.time}),d.x>0&&d.x<i){for(let h=5;h>=1;h--){let b=150*(h/2),g=.12/h,p=n.createRadialGradient(d.x,d.y,0,d.x,d.y,b);p.addColorStop(0,`rgba(180, 220, 255, ${g})`),p.addColorStop(.5,`rgba(100, 180, 220, ${g*.5})`),p.addColorStop(1,"transparent"),n.fillStyle=p,n.beginPath(),n.arc(d.x,d.y,b,0,Math.PI*2),n.fill()}let m=n.createRadialGradient(d.x,d.y,0,d.x,d.y,15);m.addColorStop(0,"rgba(255, 255, 255, 0.9)"),m.addColorStop(.5,"rgba(200, 240, 255, 0.5)"),m.addColorStop(1,"transparent"),n.fillStyle=m,n.beginPath(),n.arc(d.x,d.y,15,0,Math.PI*2),n.fill()}for(let m of this.eyes){let h=m.x*i,b=m.y*s,g=0;if(d.x>0){let c=d.x-h,f=d.y-b,C=Math.sqrt(c*c+f*f);C<m.awareness&&(g=1-C/m.awareness,g=g*g)}let p=g>.1?Math.min(g*1.5,1):0;m.openness+=(p-m.openness)*.05,m.openness>.5&&(m.blinkTimer++,m.blinkTimer>200&&Math.random()<.008&&(m.isBlinking=!0,setTimeout(()=>{m.isBlinking=!1},120),m.blinkTimer=0));let v=m.isBlinking?m.openness*.1:m.openness;this.drawTrackingEye(n,h,b,m.size,d.x,d.y,g,v)}for(let m of this.particles)m.y+=m.speed,m.x+=Math.sin(this.time*this.timing.verySlow+m.y*10)*5e-4,m.y>1.05&&(m.y=-.05,m.x=Math.random()),n.beginPath(),n.arc(m.x*i,m.y*s,m.size,0,Math.PI*2),n.fillStyle=`rgba(150, 180, 200, ${m.alpha})`,n.fill();let u=n.createRadialGradient(i/2,s/2,s*.2,i/2,s/2,s*.9);u.addColorStop(0,"transparent"),u.addColorStop(1,"rgba(0, 0, 0, 0.7)"),n.fillStyle=u,n.fillRect(0,0,i,s),this.time+=16}onCleanup(){}createPerm(n){let a=Array.from({length:256},(o,i)=>i),t=n;for(let o=255;o>0;o--){t=t*1103515245+12345&2147483647;let i=t%(o+1);[a[o],a[i]]=[a[i],a[o]]}return[...a,...a]}simplex2D(n,a){let t=(n+a)*this.F2,o=Math.floor(n+t),i=Math.floor(a+t),s=(o+i)*this.G2,l=n-(o-s),d=a-(i-s),u=l>d?1:0,m=l>d?0:1,h=l-u+this.G2,b=d-m+this.G2,g=l-1+2*this.G2,p=d-1+2*this.G2,v=o&255,c=i&255,f=this.perm[v+this.perm[c]]%8,C=this.perm[v+u+this.perm[c+m]]%8,M=this.perm[v+1+this.perm[c+1]]%8,y=0,$=0,w=0,T=.5-l*l-d*d;T>=0&&(T*=T,y=T*T*(this.grad3[f][0]*l+this.grad3[f][1]*d));let P=.5-h*h-b*b;P>=0&&(P*=P,$=P*P*(this.grad3[C][0]*h+this.grad3[C][1]*b));let S=.5-g*g-p*p;return S>=0&&(S*=S,w=S*S*(this.grad3[M][0]*g+this.grad3[M][1]*p)),70*(y+$+w)}fbm(n,a,t=4){let o=0,i=.5,s=1,l=0;for(let d=0;d<t;d++)o+=i*this.simplex2D(n*s,a*s),l+=i,i*=.5,s*=2;return o/l}drawOrganicSurface(n,a,t,o){let{lightX:i,lightY:s,time:l}=o;if(!this.mottledBase||this.mottledBase.width!==a||this.mottledBase.height!==t){this.mottledBase=document.createElement("canvas"),this.mottledBase.width=a,this.mottledBase.height=t;let d=this.mottledBase.getContext("2d"),u=d.createImageData(a,t),m=u.data,h=.008;for(let b=0;b<t;b++)for(let g=0;g<a;g++){let p=this.fbm(g*h,b*h,4),v=this.fbm(g*h*2+100,b*h*2+100,3),c=(p+1)/2,f=(v+1)/2,C,M,y;if(c<.4){let w=c/.4;C=this.palette.shadow.r+(this.palette.base.r-this.palette.shadow.r)*w,M=this.palette.shadow.g+(this.palette.base.g-this.palette.shadow.g)*w,y=this.palette.shadow.b+(this.palette.base.b-this.palette.shadow.b)*w}else if(c<.7){let w=(c-.4)/.3;C=this.palette.base.r+(this.palette.mid.r-this.palette.base.r)*w,M=this.palette.base.g+(this.palette.mid.g-this.palette.base.g)*w,y=this.palette.base.b+(this.palette.mid.b-this.palette.base.b)*w}else{let w=(c-.7)/.3;C=this.palette.mid.r+(this.palette.highlight.r-this.palette.mid.r)*w*.3,M=this.palette.mid.g+(this.palette.highlight.g-this.palette.mid.g)*w*.3,y=this.palette.mid.b+(this.palette.highlight.b-this.palette.mid.b)*w*.3}C+=(f-.5)*10,M+=(f-.5)*8,y+=(f-.5)*10;let $=(b*a+g)*4;m[$]=Math.max(0,Math.min(255,C)),m[$+1]=Math.max(0,Math.min(255,M)),m[$+2]=Math.max(0,Math.min(255,y)),m[$+3]=255}d.putImageData(u,0,0)}n.drawImage(this.mottledBase,0,0),n.lineCap="round",n.lineJoin="round";for(let d=0;d<6;d++){let u=Math.floor((this.simplex2D(d*100,0)+1)*2)%4,m=(this.simplex2D(d*50,d*50)+1)/2,h,b,g;switch(u){case 0:h=m*a,b=-20,g=Math.PI/2+this.simplex2D(d*30,0)*.4;break;case 1:h=a+20,b=m*t,g=Math.PI+this.simplex2D(d*30,100)*.4;break;case 2:h=m*a,b=t+20,g=-Math.PI/2+this.simplex2D(d*30,200)*.4;break;default:h=-20,b=m*t,g=this.simplex2D(d*30,300)*.4}let p=5+Math.abs(this.simplex2D(d*20,d*20))*4,v=[{x:h,y:b,t:p}];for(let c=0;c<12;c++){let f=this.simplex2D(d*1e3+c*10,0)*.5;g+=f;let C=25+this.simplex2D(d*1e3+c*20,0)*15,M=Math.sin(l*.002+c*.5)*2;h+=Math.cos(g)*C,b+=Math.sin(g)*C+M;let y=this.simplex2D(d*1e3+c*15,500);if(p*=.92+y*.1,y>.6&&(p*=1.15),v.push({x:h,y:b,t:Math.max(.5,p)}),h<-50||h>a+50||b<-50||b>t+50)break}for(let c=0;c<v.length-1;c++){let f=v[Math.max(0,c-1)],C=v[c],M=v[c+1],y=v[Math.min(v.length-1,c+2)],$=C.x+(M.x-f.x)/6,w=C.y+(M.y-f.y)/6,T=M.x-(y.x-C.x)/6,P=M.y-(y.y-C.y)/6,S=(C.t+M.t)/2;n.strokeStyle=`rgba(${this.palette.shadow.r}, ${this.palette.shadow.g}, ${this.palette.shadow.b}, 0.4)`,n.lineWidth=S+2,n.beginPath(),n.moveTo(C.x+1,C.y+1),n.bezierCurveTo($+1,w+1,T+1,P+1,M.x+1,M.y+1),n.stroke(),n.strokeStyle=`rgba(${this.palette.vein.r}, ${this.palette.vein.g}, ${this.palette.vein.b}, 0.7)`,n.lineWidth=S,n.beginPath(),n.moveTo(C.x,C.y),n.bezierCurveTo($,w,T,P,M.x,M.y),n.stroke(),n.strokeStyle=`rgba(${this.palette.veinHighlight.r}, ${this.palette.veinHighlight.g}, ${this.palette.veinHighlight.b}, 0.25)`,n.lineWidth=S*.4,n.beginPath(),n.moveTo(C.x,C.y-S*.25),n.bezierCurveTo($,w-S*.25,T,P-S*.25,M.x,M.y-S*.25),n.stroke()}}if(i>0&&s>0){let d=n.createRadialGradient(i,s,0,i,s,200);d.addColorStop(0,`rgba(${this.palette.veinHighlight.r+20}, ${this.palette.veinHighlight.g}, ${this.palette.veinHighlight.b-10}, 0.15)`),d.addColorStop(.3,`rgba(${this.palette.vein.r+15}, ${this.palette.vein.g}, ${this.palette.vein.b}, 0.1)`),d.addColorStop(.6,`rgba(${this.palette.mid.r+10}, ${this.palette.mid.g+5}, ${this.palette.mid.b+5}, 0.05)`),d.addColorStop(1,"transparent"),n.fillStyle=d,n.fillRect(0,0,a,t);let u=n.createRadialGradient(i,s,0,i,s,100);u.addColorStop(0,`rgba(${this.palette.highlight.r+40}, ${this.palette.highlight.g+35}, ${this.palette.highlight.b+30}, 0.2)`),u.addColorStop(.5,`rgba(${this.palette.highlight.r+20}, ${this.palette.highlight.g+15}, ${this.palette.highlight.b+10}, 0.08)`),u.addColorStop(1,"transparent"),n.fillStyle=u,n.fillRect(0,0,a,t)}}drawTrackingEye(n,a,t,o,i,s,l,d){if(d<.05)return;let u=o*d,m=(30+l*30)*d,h=n.createRadialGradient(a,t,0,a,t,m),b=180+l*75,g=60+l*40,p=60+l*20;h.addColorStop(0,`rgba(${b}, ${g}, ${p}, ${.8*d})`),h.addColorStop(.5,`rgba(${120+l*60}, 40, 40, ${.3*d})`),h.addColorStop(1,"transparent"),n.fillStyle=h,n.beginPath(),n.arc(a,t,m,0,Math.PI*2),n.fill(),n.fillStyle=`rgba(${200+l*55}, ${80+l*80}, ${60+l*40}, ${d})`,n.beginPath(),n.arc(a,t,u,0,Math.PI*2),n.fill();let v=i-a,c=s-t,f=Math.sqrt(v*v+c*c),C=f>0?v/f*u*.3:0,M=f>0?c/f*u*.3:0;n.fillStyle=`rgba(10, 0, 0, ${d})`,n.beginPath(),l>.4?n.ellipse(a+C,t+M,2*d,u*.7,0,0,Math.PI*2):n.arc(a+C,t+M,(4-l*2)*d,0,Math.PI*2),n.fill()}},uo=new Ae;var Un={};X(Un,{cssBioGlow:()=>gn,cssCreatureBody:()=>pn,cssDeepWater:()=>bn,cssDistantCreature:()=>fn,cssJellyfishBell:()=>cn,deepWaterBackground:()=>ie,eyeGlow:()=>Ye,lightBeam:()=>He,playerLight:()=>Xe});var Kn={};X(Kn,{bioGlow:()=>ze,bioluminescence:()=>ne,darkness:()=>Ee,deepSea:()=>q,materials:()=>Y,randomBioHue:()=>We});var q={background:{surface:"#020810",mid:"#010508",deep:"#000305",abyss:"#000000",void:"#000000"},water:{ambient:"rgba(100, 150, 200, 0.03)",light:"rgba(180, 200, 220, 0.4)",particleDim:"rgba(180, 200, 230, 0.3)"},hud:{text:"rgba(77, 208, 225, 0.5)",recording:"rgba(255, 150, 100, 0.7)"}},ne={cyan:{core:"rgba(100, 200, 255, 0.9)",mid:"rgba(80, 180, 255, 0.5)",outer:"rgba(60, 150, 255, 0.2)",halo:"rgba(77, 208, 225, 0.5)"},warm:{core:"rgba(255, 100, 80, 0.8)",mid:"rgba(255, 80, 60, 0.4)",outer:"rgba(200, 50, 50, 0.3)"},playerLight:{core:"rgba(255, 255, 255, 0.9)",inner:"rgba(200, 240, 255, 0.5)",mid:"rgba(180, 220, 255, 0.15)",ambient:"rgba(100, 180, 220, 0.1)"},hueRange:{min:180,max:220}},Y={rovYellow:{highlight:"#e8a832",mid:"#d4942a",shadow:"#b87820",outline:"#8a5a15"},flotation:{fill:"#ff6b35",outline:"#cc4420"},metal:{light:"#666666",mid:"#444444",dark:"#333333",darkest:"#222222"},lens:{body:"#1a1a2e",glint:"rgba(100, 150, 200, 0.5)"},panel:{line:"rgba(100, 60, 20, 0.5)",shadow:"rgba(0, 0, 0, 0.4)"},creatureFlesh:e=>({r:15+e*25,g:12+e*18,b:20+e*25})},Ee={true:"#000000",soft:"#010508",tendril:"rgba(10, 10, 15, 0.9)",vignette:"rgba(0, 0, 0, 0.4)",shadow:"rgba(0, 0, 0, 0.4)"};function We(){let{min:e,max:r}=ne.hueRange;return e+Math.random()*(r-e)}function ze(e,r=70,n=60,a=.6){return`hsla(${e}, ${r}%, ${n}%, ${a})`}function ie(e,r){let n=e.createLinearGradient(0,0,0,r);return n.addColorStop(0,q.background.surface),n.addColorStop(.3,q.background.mid),n.addColorStop(.6,q.background.deep),n.addColorStop(1,q.background.abyss),n}function Xe(e,r,n,a,t=1){let o=[];for(let s=5;s>=1;s--){let l=a*(s/2),d=.15/s*t,u=e.createRadialGradient(r,n,0,r,n,l);u.addColorStop(0,`rgba(180, 220, 255, ${d})`),u.addColorStop(.5,`rgba(100, 180, 220, ${d*.5})`),u.addColorStop(1,"transparent"),o.push(u)}let i=e.createRadialGradient(r,n,0,r,n,15);return i.addColorStop(0,`rgba(255, 255, 255, ${.9*t})`),i.addColorStop(.5,`rgba(200, 240, 255, ${.5*t})`),i.addColorStop(1,"transparent"),o.push(i),o}function He(e,r,n){let a=e.createLinearGradient(0,r,0,n);return a.addColorStop(0,"rgba(255, 250, 230, 0.15)"),a.addColorStop(.5,"rgba(200, 220, 255, 0.05)"),a.addColorStop(1,"rgba(200, 220, 255, 0)"),a}function Ye(e,r,n,a,t=0){let o=e.createRadialGradient(r,n,0,r,n,a),i=180+t*75,s=60+t*40,l=60+t*20;return o.addColorStop(0,`rgba(${i}, ${s}, ${l}, 0.8)`),o.addColorStop(.5,`rgba(${120+t*60}, 40, 40, 0.3)`),o.addColorStop(1,"transparent"),o}function bn(){return`linear-gradient(
    180deg,
    ${q.background.surface} 0%,
    ${q.background.mid} 30%,
    ${q.background.deep} 60%,
    ${q.background.abyss} 100%
  )`}function gn(e="cyan"){let r=ne[e];return`radial-gradient(
    circle,
    ${r.core} 0%,
    ${r.mid} 30%,
    ${r.outer} 60%,
    transparent 70%
  )`}function pn(e=.8){return`radial-gradient(
    ellipse at 40% 40%,
    rgba(20, 30, 40, ${e}) 0%,
    rgba(15, 25, 35, ${e*.8}) 50%,
    rgba(10, 20, 30, ${e*.5}) 80%,
    transparent 100%
  )`}function cn(){return`radial-gradient(
    ellipse at 50% 30%,
    rgba(180, 220, 255, 0.4) 0%,
    rgba(150, 200, 255, 0.2) 40%,
    rgba(120, 180, 255, 0.1) 70%,
    transparent 100%
  )`}function fn(){return`radial-gradient(
    ellipse at center,
    rgba(10, 20, 35, 0.8) 0%,
    transparent 70%
  )`}var Zn={};X(Zn,{createBioParticles:()=>je,createDeepParticles:()=>Ne,createMarineSnow:()=>qe,cssMarineSnowParticle:()=>jt,cssMarineSnowStyles:()=>Kt,drawBioParticles:()=>Je,drawMarineSnow:()=>Fe,htmlMarineSnow:()=>Jt,updateDeepParticles:()=>_e,updateMarineSnow:()=>Ve});function qe(e=80){return Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:Math.random()*2+.5,speed:Math.random()*.008+.003,alpha:Math.random()*.5+.2}))}function Ve(e,r="down"){let n=r==="up"?-1:1;for(let a of e)a.y+=a.speed*n,r==="up"&&a.y<-.05?(a.y=1.05,a.x=Math.random()):r==="down"&&a.y>1.05&&(a.y=-.05,a.x=Math.random())}function Fe(e,r,n,a){for(let t of r)e.beginPath(),e.arc(t.x*n,t.y*a,t.size,0,Math.PI*2),e.fillStyle=`rgba(180, 200, 220, ${t.alpha})`,e.fill()}function Ne(e=12){return Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:Math.random()*1.5+.5,speed:Math.random()*.002+.001,alpha:Math.random()*.3+.1,phase:Math.random()*Math.PI*2}))}function _e(e,r){for(let n of e)n.y+=n.speed,n.x+=Math.sin(r*.001+(n.phase??0))*5e-4,n.y>1.05&&(n.y=-.05,n.x=Math.random())}function jt(e){let r=Math.random()*100,n=Math.random()*100,a=Math.random()*5,t=Math.random()>.5?3:2,o=Math.random()>.5?.3:.4;return{style:`
      position: absolute;
      left: ${r}%;
      top: ${n}%;
      width: ${t}px;
      height: ${t}px;
      background: rgba(200, 220, 255, ${o});
      border-radius: 50%;
      animation: snow-drift 8s linear infinite;
      animation-delay: ${a}s;
    `.trim(),animation:`
      @keyframes snow-drift {
        0% { transform: translateY(-20px) translateX(0); opacity: 0; }
        10% { opacity: 1; }
        90% { opacity: 1; }
        100% { transform: translateY(300px) translateX(20px); opacity: 0; }
      }
    `.trim()}}function Jt(e=20){return`<div class="marine-snow">${Array.from({length:e},(n,a)=>{let t=Math.random()*100,o=Math.random()*100,i=Math.random()*5;return`<div class="snow-particle" style="left: ${t}%; top: ${o}%; animation-delay: ${i}s;"></div>`}).join(`
`)}</div>`}var Kt=`
  .marine-snow {
    position: absolute;
    inset: 0;
    pointer-events: none;
    overflow: hidden;
  }
  
  .snow-particle {
    position: absolute;
    width: 2px;
    height: 2px;
    background: rgba(200, 220, 255, 0.4);
    border-radius: 50%;
    animation: snow-drift 8s linear infinite;
  }
  
  .snow-particle:nth-child(odd) {
    width: 3px;
    height: 3px;
    background: rgba(180, 200, 230, 0.3);
  }
  
  @keyframes snow-drift {
    0% { transform: translateY(-20px) translateX(0); opacity: 0; }
    10% { opacity: 1; }
    90% { opacity: 1; }
    100% { transform: translateY(300px) translateX(20px); opacity: 0; }
  }
`;function je(e=15){return Array.from({length:e},()=>({x:Math.random(),y:Math.random(),size:Math.random()*4+2,speed:Math.random()*.002+.001,alpha:Math.random()*.6+.3,hue:180+Math.random()*40,pulseSpeed:Math.random()*.003+.002,phase:Math.random()*Math.PI*2}))}function Je(e,r,n,a,t){for(let o of r){let i=(Math.sin(t*o.pulseSpeed+(o.phase??0))+1)/2,s=o.alpha*(.5+i*.5),l=o.size*(.8+i*.4),d=o.x*n,u=o.y*a,m=e.createRadialGradient(d,u,0,d,u,l*3);m.addColorStop(0,`hsla(${o.hue}, 70%, 60%, ${s})`),m.addColorStop(.5,`hsla(${o.hue}, 60%, 40%, ${s*.3})`),m.addColorStop(1,"transparent"),e.fillStyle=m,e.beginPath(),e.arc(d,u,l*3,0,Math.PI*2),e.fill(),e.fillStyle=`hsla(${o.hue}, 50%, 80%, ${s})`,e.beginPath(),e.arc(d,u,l*.5,0,Math.PI*2),e.fill()}}var xn={};X(xn,{drawBarnacles:()=>Ze,drawOrganicSurface:()=>Ue,drawScarring:()=>Qe,surfacePalettes:()=>K});var Ut=.5*(Math.sqrt(3)-1),Ke=(3-Math.sqrt(3))/6,pe=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]];function Zr(e){let r=Array.from({length:256},(a,t)=>t),n=e;for(let a=255;a>0;a--){n=n*1103515245+12345&2147483647;let t=n%(a+1);[r[a],r[t]]=[r[t],r[a]]}return[...r,...r]}function I(e,r,n){let a=(e+r)*Ut,t=Math.floor(e+a),o=Math.floor(r+a),i=(t+o)*Ke,s=t-i,l=o-i,d=e-s,u=r-l,m=d>u?1:0,h=d>u?0:1,b=d-m+Ke,g=u-h+Ke,p=d-1+2*Ke,v=u-1+2*Ke,c=t&255,f=o&255,C=n[c+n[f]]%8,M=n[c+m+n[f+h]]%8,y=n[c+1+n[f+1]]%8,$=0,w=0,T=0,P=.5-d*d-u*u;P>=0&&(P*=P,$=P*P*(pe[C][0]*d+pe[C][1]*u));let S=.5-b*b-g*g;S>=0&&(S*=S,w=S*S*(pe[M][0]*b+pe[M][1]*g));let R=.5-p*p-v*v;return R>=0&&(R*=R,T=R*R*(pe[y][0]*p+pe[y][1]*v)),70*($+w+T)}function Ur(e,r,n,a=4){let t=0,o=.5,i=1,s=0;for(let l=0;l<a;l++)t+=o*I(e*i,r*i,n),s+=o,o*=.5,i*=2;return t/s}var K={fleshy:{base:{r:28,g:22,b:26},mid:{r:38,g:30,b:35},highlight:{r:58,g:48,b:52},shadow:{r:18,g:14,b:18},vein:{r:50,g:28,b:35},veinHighlight:{r:85,g:50,b:55}},abyssal:{base:{r:20,g:25,b:32},mid:{r:30,g:38,b:48},highlight:{r:50,g:62,b:75},shadow:{r:12,g:15,b:22},vein:{r:35,g:45,b:60},veinHighlight:{r:60,g:80,b:100}},rocky:{base:{r:25,g:28,b:25},mid:{r:38,g:42,b:38},highlight:{r:55,g:62,b:55},shadow:{r:15,g:18,b:16},vein:{r:35,g:32,b:30},veinHighlight:{r:55,g:50,b:45}},membranous:{base:{r:25,g:20,b:30},mid:{r:38,g:30,b:45},highlight:{r:60,g:48,b:68},shadow:{r:15,g:12,b:20},vein:{r:70,g:40,b:55},veinHighlight:{r:100,g:60,b:75}}},Zt={visible:{noiseScale:.003,showVeins:!0,veinCount:6},subtle:{noiseScale:.005,showVeins:!0,veinCount:3},dramatic:{noiseScale:.002,showVeins:!0,veinCount:10}};function Ue(e,r,n,a={}){let t=a.preset?Zt[a.preset]:{},{type:o="fleshy",noiseScale:i=t.noiseScale??.003,showVeins:s=t.showVeins??!0,veinCount:l=t.veinCount??6,seed:d=42,time:u=0,lightX:m,lightY:h,lightRadius:b=250}={...t,...a},g=K[o]||K.fleshy,p=Zr(d);Qn(e,r,n,g,p,i,u),Qt(e,r,n,g,p,i),s&&xt(e,r,n,g,p,l,u),ea(e,r,n,g,p,i*3),m!==void 0&&h!==void 0&&na(e,r,n,m,h,b,g,p)}function Qn(e,r,n,a,t,o,i){let u=Math.min(r,1920),m=Math.min(n,1080),h=u*m;if((r>1920||n>1080)&&console.warn(`drawOrganicSurface: Dimensions ${r}x${n} exceed safe limit (1920x1080). Using reduced size ${u}x${m} to prevent memory allocation failure.`),h>2073600){let v=Math.sqrt(2073600/h),c=Math.floor(u*v),f=Math.floor(m*v);return console.warn(`drawOrganicSurface: Pixel count ${h} exceeds limit 2073600. Scaling to ${c}x${f}.`),Qn(e,c,f,a,t,o,i)}let b;try{b=e.createImageData(u,m)}catch(v){if(v instanceof RangeError||v instanceof DOMException){let c=Math.floor(u*.5),f=Math.floor(m*.5);return console.error(`drawOrganicSurface: Failed to allocate ${u}x${m} buffer. Falling back to ${c}x${f}.`,v),Qn(e,c,f,a,t,o,i)}throw v}let g=b.data,p=i*5e-5;for(let v=0;v<m;v++)for(let c=0;c<u;c++){let f=Ur(c*o+p,v*o,t,4),C=Ur(c*o*2+100,v*o*2+100,t,3),M=(f+1)/2,y=(C+1)/2,$,w,T;if(M<.4){let S=M/.4;$=a.shadow.r+(a.base.r-a.shadow.r)*S,w=a.shadow.g+(a.base.g-a.shadow.g)*S,T=a.shadow.b+(a.base.b-a.shadow.b)*S}else if(M<.7){let S=(M-.4)/.3;$=a.base.r+(a.mid.r-a.base.r)*S,w=a.base.g+(a.mid.g-a.base.g)*S,T=a.base.b+(a.mid.b-a.base.b)*S}else{let S=(M-.7)/.3;$=a.mid.r+(a.highlight.r-a.mid.r)*S*.3,w=a.mid.g+(a.highlight.g-a.mid.g)*S*.3,T=a.mid.b+(a.highlight.b-a.mid.b)*S*.3}$+=(y-.5)*8,w+=(y-.5)*6,T+=(y-.5)*8;let P=(v*r+c)*4;g[P]=Math.max(0,Math.min(255,$)),g[P+1]=Math.max(0,Math.min(255,w)),g[P+2]=Math.max(0,Math.min(255,T)),g[P+3]=255}if(u===r&&m===n)e.putImageData(b,0,0);else{let v=document.createElement("canvas");v.width=u,v.height=m,v.getContext("2d").putImageData(b,0,0),e.drawImage(v,0,0,r,n)}}function Qt(e,r,n,a,t,o){let i=o*.5;e.globalCompositeOperation="overlay";for(let s=0;s<8;s++){let l=I(s*50,0,t)*.5+.5,d=I(0,s*50,t)*.5+.5,u=l*r,m=d*n,h=100+Math.abs(I(s*30,s*30,t))*200;if(I(s*20,s*20+500,t)>0){let g=I(s*10,0,t)*Math.PI;e.save(),e.translate(u,m),e.rotate(g);let p=e.createLinearGradient(0,-h*.3,0,h*.3);p.addColorStop(0,`rgba(${a.highlight.r}, ${a.highlight.g}, ${a.highlight.b}, 0.15)`),p.addColorStop(.5,"rgba(128, 128, 128, 0)"),p.addColorStop(1,`rgba(${a.shadow.r}, ${a.shadow.g}, ${a.shadow.b}, 0.1)`),e.fillStyle=p,e.beginPath(),e.ellipse(0,0,h,h*.4,0,0,Math.PI*2),e.fill(),e.restore()}}e.globalCompositeOperation="source-over"}function xt(e,r,n,a,t,o,i){for(let s=0;s<o;s++){let l=Math.floor((I(s*100,0,t)+1)*2)%4,d,u,m,h=(I(s*50,s*50,t)+1)/2;switch(l){case 0:d=h*r,u=-20,m=Math.PI/2+I(s*30,0,t)*.4;break;case 1:d=r+20,u=h*n,m=Math.PI+I(s*30,100,t)*.4;break;case 2:d=h*r,u=n+20,m=-Math.PI/2+I(s*30,200,t)*.4;break;default:d=-20,u=h*n,m=I(s*30,300,t)*.4}Qr(e,d,u,m,5+Math.abs(I(s*20,s*20,t))*4,0,t,a,i,r,n,s*1e3)}}function Qr(e,r,n,a,t,o,i,s,l,d,u,m){if(t<1||o>4)return;let h=[{x:r,y:n,thickness:t}],b=r,g=n,p=a,v=t,c=8+Math.floor(Math.abs(I(m,0,i))*6);for(let f=0;f<c;f++){let C=I(m+f*10,o*100,i)*.6;p+=C;let M=30+I(m+f*20,0,i)*20,y=l>0?Math.sin(l*.002+f*.5+m*.01)*2:0;b+=Math.cos(p)*M,g+=Math.sin(p)*M+y;let $=I(m+f*15,o*50+500,i);if(v*=.92+$*.1,$>.6&&(v*=1.15),h.push({x:b,y:g,thickness:Math.max(.5,v)}),b<-50||b>d+50||g<-50||g>u+50)break;if(f>2&&I(m+f*25,o*200,i)>.7&&o<3){let w=p+(I(m+f*30,0,i)>0?1:-1)*(.5+Math.abs(I(m+f*35,0,i))*.5);Qr(e,b,g,w,v*.6,o+1,i,s,l,d,u,m+f*1e3+o*1e4)}}if(!(h.length<2)){e.lineCap="round",e.lineJoin="round";for(let f=0;f<h.length-1;f++){let C=h[Math.max(0,f-1)],M=h[f],y=h[f+1],$=h[Math.min(h.length-1,f+2)],w=M.x+(y.x-C.x)/6,T=M.y+(y.y-C.y)/6,P=y.x-($.x-M.x)/6,S=y.y-($.y-M.y)/6,R=(M.thickness+y.thickness)/2;e.strokeStyle=`rgba(${s.shadow.r}, ${s.shadow.g}, ${s.shadow.b}, 0.4)`,e.lineWidth=R+2,e.beginPath(),e.moveTo(M.x+1,M.y+1),e.bezierCurveTo(w+1,T+1,P+1,S+1,y.x+1,y.y+1),e.stroke(),e.strokeStyle=`rgba(${s.vein.r}, ${s.vein.g}, ${s.vein.b}, 0.7)`,e.lineWidth=R,e.beginPath(),e.moveTo(M.x,M.y),e.bezierCurveTo(w,T,P,S,y.x,y.y),e.stroke(),e.strokeStyle=`rgba(${s.veinHighlight.r}, ${s.veinHighlight.g}, ${s.veinHighlight.b}, 0.25)`,e.lineWidth=R*.4,e.beginPath(),e.moveTo(M.x,M.y-R*.25),e.bezierCurveTo(w,T-R*.25,P,S-R*.25,y.x,y.y-R*.25),e.stroke()}}}function ea(e,r,n,a,t,o){e.globalCompositeOperation="soft-light";for(let i=0;i<15;i++){let s=(I(i*70,0,t)+1)/2*r,l=(I(0,i*70,t)+1)/2*n,d=40+Math.abs(I(i*40,i*40,t))*100,u=I(i*25,500,t)*Math.PI;e.save(),e.translate(s,l),e.rotate(u);let m=.3+Math.abs(I(i*35,0,t))*.4,h=e.createRadialGradient(0,0,0,0,0,d),b=I(i*45,250,t)>0?1.2:.8;h.addColorStop(0,`rgba(${a.mid.r*b}, ${a.mid.g*b}, ${a.mid.b*b}, 0.15)`),h.addColorStop(.7,`rgba(${a.base.r}, ${a.base.g}, ${a.base.b}, 0.05)`),h.addColorStop(1,"transparent"),e.fillStyle=h,e.beginPath(),e.ellipse(0,0,d,d*m,0,0,Math.PI*2),e.fill(),e.restore()}e.globalCompositeOperation="source-over"}function na(e,r,n,a,t,o,i,s){let l=e.createRadialGradient(a,t,0,a,t,o*1.5);l.addColorStop(0,`rgba(${i.veinHighlight.r+20}, ${i.veinHighlight.g}, ${i.veinHighlight.b-10}, 0.12)`),l.addColorStop(.3,`rgba(${i.vein.r+15}, ${i.vein.g}, ${i.vein.b}, 0.08)`),l.addColorStop(.6,`rgba(${i.mid.r+10}, ${i.mid.g+5}, ${i.mid.b+5}, 0.04)`),l.addColorStop(1,"transparent"),e.fillStyle=l,e.fillRect(0,0,r,n);let d=e.createRadialGradient(a,t,0,a,t,o*.5);d.addColorStop(0,`rgba(${i.highlight.r+40}, ${i.highlight.g+35}, ${i.highlight.b+30}, 0.2)`),d.addColorStop(.5,`rgba(${i.highlight.r+20}, ${i.highlight.g+15}, ${i.highlight.b+10}, 0.08)`),d.addColorStop(1,"transparent"),e.fillStyle=d,e.fillRect(0,0,r,n),e.globalCompositeOperation="overlay";let u=o*1.2;for(let m=0;m<5;m++){let h=(I(a*.01+m*20,t*.01,s)+1)*Math.PI,b=20+Math.abs(I(m*30,0,s))*60,g=a+Math.cos(h)*b,p=t+Math.sin(h)*b,v=Math.max(0,1-Math.sqrt((g-a)**2+(p-t)**2)/u)*.3;if(v>.05){e.strokeStyle=`rgba(${i.vein.r+20}, ${i.vein.g}, ${i.vein.b}, ${v})`,e.lineWidth=1+Math.abs(I(m*25,0,s))*2,e.lineCap="round",e.beginPath(),e.moveTo(g,p);let c=h+I(m*15,500,s)*.8,f=20+Math.abs(I(m*35,0,s))*40,C=f*.5,M=h+I(m*20,250,s)*.5;e.quadraticCurveTo(g+Math.cos(M)*C,p+Math.sin(M)*C,g+Math.cos(c)*f,p+Math.sin(c)*f),e.stroke()}}e.globalCompositeOperation="source-over"}function Ze(e,r,n,a,t={}){let{count:o=8,seed:i=123,palette:s=K.rocky}=t,l=Zr(i);for(let d=0;d<o;d++){let u=(I(d*50,0,l)+1)*Math.PI,m=Math.abs(I(d*30,d*30,l))*a,h=r+Math.cos(u)*m,b=n+Math.sin(u)*m,g=3+Math.abs(I(d*40,0,l))*8;e.strokeStyle=`rgba(${s.highlight.r}, ${s.highlight.g}, ${s.highlight.b}, 0.5)`,e.lineWidth=2,e.beginPath(),e.arc(h,b,g,Math.PI*.7,Math.PI*1.9),e.stroke(),e.strokeStyle=`rgba(${s.shadow.r}, ${s.shadow.g}, ${s.shadow.b}, 0.6)`,e.beginPath(),e.arc(h,b,g,Math.PI*1.9,Math.PI*.7),e.stroke(),e.fillStyle=`rgba(${s.mid.r}, ${s.mid.g}, ${s.mid.b}, 0.7)`,e.beginPath(),e.arc(h,b,g*.5,0,Math.PI*2),e.fill()}}function Qe(e,r,n,a,t={}){let{angle:o=0,width:i=3,palette:s=K.fleshy}=t,l=r+Math.cos(o)*a*.5,d=n+Math.sin(o)*a*.5,u=r+Math.cos(o)*a,m=n+Math.sin(o)*a,h=(Math.random()-.5)*15,b=l+Math.cos(o+Math.PI/2)*h,g=d+Math.sin(o+Math.PI/2)*h;e.strokeStyle=`rgba(${s.shadow.r}, ${s.shadow.g}, ${s.shadow.b}, 0.7)`,e.lineWidth=i,e.lineCap="round",e.beginPath(),e.moveTo(r,n),e.quadraticCurveTo(b,g,u,m),e.stroke(),e.strokeStyle=`rgba(${s.veinHighlight.r}, ${s.veinHighlight.g}, ${s.veinHighlight.b}, 0.35)`,e.lineWidth=i*.4,e.beginPath(),e.moveTo(r,n-i*.4),e.quadraticCurveTo(b,g-i*.4,u,m-i*.4),e.stroke()}var er={};X(er,{drawJellyfish:()=>rn,drawLightCone:()=>nn,drawROV:()=>en,drawSpecimen:()=>tn});var xe={glacial:8e-4,verySlow:.001,slow:.002,medium:.003};function en(e,r,n,a=1,t={}){let{lightsOn:o=!0,showTether:i=!0,showArm:s=!0,time:l=0,rotation:d=0}=t;e.save(),e.translate(r,n),e.rotate(d),e.scale(a,a);let u=80,m=50;e.fillStyle="rgba(0, 0, 0, 0.4)",e.fillRect(-u/2+4,-m/2+4,u,m),e.fillStyle=Se(e,-u/2,-m/2,u,m,Y.rovYellow),e.fillRect(-u/2,-m/2,u,m),e.strokeStyle=Y.rovYellow.outline,e.lineWidth=2,e.strokeRect(-u/2,-m/2,u,m),Re(e,-u/2,-m/2,u,m,[.25,.75]),e.fillStyle=Y.flotation.fill,e.fillRect(-u/2+5,-m/2-15,u-10,15),e.strokeStyle=Y.flotation.outline,e.lineWidth=1,e.strokeRect(-u/2+5,-m/2-15,u-10,15),e.fillStyle=Y.metal.dark,e.fillRect(-u/2-15,-10,15,20),e.fillRect(u/2,-10,15,20),be(e,-u/2-15,-10,15,20,4,Y.metal.mid),be(e,u/2,-10,15,20,4,Y.metal.mid),ke(e,0,m/2+10,12,8),o?[-25,25].forEach(h=>{Te(e,h,m/2+5,8,!0,l)}):[-25,25].forEach(h=>{e.fillStyle=Y.metal.mid,e.beginPath(),e.arc(h,m/2+5,8,0,Math.PI*2),e.fill()}),s&&(e.strokeStyle=Y.metal.mid,e.lineWidth=4,e.lineCap="round",e.beginPath(),e.moveTo(-u/2+10,m/2),e.lineTo(-u/2+5,m/2+20),e.lineTo(-u/2+15,m/2+25),e.stroke()),i&&$e(e,0,-m/2-15,0,-m/2-100,l),e.restore()}function nn(e,r,n,a,t,o={}){let{spread:i=.5,startOpacity:s=.15,color:l={r:255,g:250,b:230}}=o;e.save(),e.translate(r,n),e.rotate(a-Math.PI/2);let d=i/2,u=Math.tan(d)*t,m=e.createLinearGradient(0,0,0,t);m.addColorStop(0,`rgba(${l.r}, ${l.g}, ${l.b}, ${s})`),m.addColorStop(.5,`rgba(${l.r}, ${l.g}, ${l.b}, ${s*.3})`),m.addColorStop(1,`rgba(${l.r}, ${l.g}, ${l.b}, 0)`),e.fillStyle=m,e.beginPath(),e.moveTo(-10,0),e.lineTo(-u,t),e.lineTo(u,t),e.lineTo(10,0),e.closePath(),e.fill(),e.restore()}function rn(e,r,n,a={}){let{bellWidth:t=50,tentacleCount:o=4,time:i=0,glowIntensity:s=.4}=a,l=t*.7,d=he(i,xe.slow,.95,1.05);e.save(),e.translate(r,n);let u=e.createRadialGradient(0,0,0,0,0,t*1.5);u.addColorStop(0,`rgba(150, 200, 255, ${s*.3})`),u.addColorStop(.5,`rgba(150, 200, 255, ${s*.1})`),u.addColorStop(1,"transparent"),e.fillStyle=u,e.beginPath(),e.arc(0,0,t*1.5,0,Math.PI*2),e.fill(),e.scale(d,1/d);let m=e.createRadialGradient(0,-l*.3,0,0,0,t);m.addColorStop(0,`rgba(180, 220, 255, ${s})`),m.addColorStop(.4,`rgba(150, 200, 255, ${s*.5})`),m.addColorStop(.7,`rgba(120, 180, 255, ${s*.25})`),m.addColorStop(1,"transparent"),e.fillStyle=m,e.beginPath(),e.ellipse(0,0,t/2,l/2,0,0,Math.PI,!0),e.fill(),e.fillStyle=`rgba(200, 230, 255, ${s*.3})`,e.beginPath(),e.ellipse(0,-l*.15,t*.25,l*.2,0,0,Math.PI*2),e.fill();let h=t/(o+1),b=l*.3;for(let g=0;g<o;g++){let p=-t/2+h*(g+1),v=40+g%2*15,c=Math.sin(i*xe.slow+g*.8)*5,f=e.createLinearGradient(p,b,p+c,b+v);f.addColorStop(0,`rgba(150, 200, 255, ${s*.5})`),f.addColorStop(.5,`rgba(150, 200, 255, ${s*.2})`),f.addColorStop(1,"transparent"),e.strokeStyle=f,e.lineWidth=2,e.lineCap="round",e.beginPath(),e.moveTo(p,b),e.quadraticCurveTo(p+c*.5,b+v*.5,p+c,b+v),e.stroke()}e.restore()}function tn(e,r,n,a={}){let{width:t=70,time:o=0,illumination:i=0,lookAt:s}=a,l=t*.65,d=Math.sin(o*xe.verySlow)*3,u=Math.sin(o*xe.glacial)*.02;e.save(),e.translate(r,n+d),e.rotate(u);let m=.6+i*.3,h=e.createRadialGradient(-t*.1,-l*.1,0,0,0,t*.7);h.addColorStop(0,`rgba(${20+i*15}, ${30+i*10}, ${40+i*10}, ${m})`),h.addColorStop(.5,`rgba(15, 25, 35, ${m*.8})`),h.addColorStop(.8,`rgba(10, 20, 30, ${m*.5})`),h.addColorStop(1,"transparent"),e.fillStyle=h,e.beginPath(),e.ellipse(0,0,t/2,l/2,0,0,Math.PI*2),e.fill();let b=he(o,xe.medium,.6,1),g=-t*.1,p=-l*.05,v=8*b,c=e.createRadialGradient(g,p,0,g,p,v*2);c.addColorStop(0,`rgba(255, 100, 80, ${.8*b})`),c.addColorStop(.4,`rgba(255, 80, 60, ${.4*b})`),c.addColorStop(1,"transparent"),e.fillStyle=c,e.beginPath(),e.arc(g,p,v*2,0,Math.PI*2),e.fill();let f=t*.15,C=-l*.1,M=4+i*2,y=15+i*10,$=e.createRadialGradient(f,C,0,f,C,y);$.addColorStop(0,`rgba(200, 50, 50, ${.6+i*.3})`),$.addColorStop(.5,`rgba(150, 30, 30, ${.2+i*.2})`),$.addColorStop(1,"transparent"),e.fillStyle=$,e.beginPath(),e.arc(f,C,y,0,Math.PI*2),e.fill(),e.fillStyle=`rgba(200, 50, 50, ${.8+i*.2})`,e.beginPath(),e.arc(f,C,M,0,Math.PI*2),e.fill();let w=0,T=0;if(s){let P=s.x-(r+f),S=s.y-(n+C),R=Math.sqrt(P*P+S*S);R>0&&(w=P/R*2,T=S/R*2)}if(e.fillStyle="rgba(10, 0, 0, 0.9)",e.beginPath(),i>.4?e.ellipse(f+w,C+T,1.5,M*.6,0,0,Math.PI*2):e.arc(f+w,C+T,2,0,Math.PI*2),e.fill(),i>.3){let P=(i-.3)*1.4,S=t*.05,R=l*.15;e.fillStyle=`rgba(180, 40, 40, ${P*.5})`,e.beginPath(),e.arc(S,R,3,0,Math.PI*2),e.fill()}e.restore()}var an=class extends _{constructor(){super(...arguments);this.name="Seekers";this.description="Bioluminescent seekers attracted to light";this.defaultConfig={intensity:1,scale:1,duration:1/0};this.seekers=[];this.particles=[];this.time=0;this.lastCursorX=0;this.lastCursorY=0}async onInit(){this.startCursorTracking();let{width:n,height:a}=this.getCanvasSize();this.seekers=Me(50,n,a,{spawnBias:"center",sizeRange:[2,8],speedRange:[1,4],hueRange:[180,220],centerDrift:.02}),this.particles=Array.from({length:30},()=>({x:Math.random(),y:Math.random(),size:.5+Math.random()*1.5,speed:5e-4+Math.random()*.001,alpha:.1+Math.random()*.2,phase:Math.random()*Math.PI*2})),this.lastCursorX=n/2,this.lastCursorY=a/2}render(n,a){let{width:t,height:o}=this.getCanvasSize(),i=this.getCursorPos();n.fillStyle=ie(n,o),n.fillRect(0,0,t,o);let s=Math.sqrt((i.x-this.lastCursorX)**2+(i.y-this.lastCursorY)**2);Ce(this.seekers,i.x,i.y,s,t,o,.02),we(n,this.seekers,{lightX:i.x,lightY:i.y,lightRadius:200,time:this.time}),i.isOver&&Oe(n,i.x,i.y,200);for(let l of this.particles)l.y+=l.speed,l.x+=Math.sin(this.time*.001+(l.phase??0)+l.y*5)*3e-4,l.y>1.05&&(l.y=-.05,l.x=Math.random()),l.x<-.05&&(l.x=1.05),l.x>1.05&&(l.x=-.05),n.fillStyle=`rgba(150, 180, 200, ${l.alpha})`,n.beginPath(),n.arc(l.x*t,l.y*o,l.size,0,Math.PI*2),n.fill();n.fillStyle=Pe(n,t/2,o/2,o*.25,o*.85,.4),n.fillRect(0,0,t,o),this.lastCursorX=i.x,this.lastCursorY=i.y,this.time+=a}onCleanup(){this.seekers=[],this.particles=[]}},Io=new an;var ra=new Be,ta=new Le,aa=new Ae,oa=new an,xr={shadows:ra,rovExterior:ta,wall:aa,seekers:oa};var et={deepSea:xr};var se={};function re(e,r){se[e]&&console.warn(`Theme "${e}" is already registered. Overwriting.`),se[e]=r}function nt(e){return se[e]}function rt(){return Object.keys(se)}var tt=new Proxy({},{get(e,r){if(typeof r=="string")return se[r]},ownKeys(){return Object.keys(se)},has(e,r){return r in se}});re("deepSea",{colors:Kn,gradients:Un,particles:Zn,recipes:er,surfaces:xn});var nr={};X(nr,{addAlphaToColor:()=>vn,getGrowthColor:()=>it,livingOs:()=>G,rgbToHex:()=>at,rgbToRgba:()=>ot});var G={bark:{dark:{r:29,g:20,b:23},mid:{r:61,g:40,b:23},light:{r:92,g:61,b:42}},foliage:{dark:{r:29,g:58,b:45},mid:{r:45,g:90,b:61},light:{r:61,g:106,b:77},vibrant:{r:77,g:122,b:93}},growth:{new:{r:90,g:122,b:77},young:{r:106,g:138,b:93}},decay:{old:{r:29,g:58,b:45},withered:{r:23,g:45,b:35}},unsettling:{hungry:{r:100,g:80,b:60},satisfied:{r:60,g:80,b:60},starving:{r:40,g:50,b:40}}};function at(e){let r=Math.round(e.r).toString(16).padStart(2,"0"),n=Math.round(e.g).toString(16).padStart(2,"0"),a=Math.round(e.b).toString(16).padStart(2,"0");return`#${r}${n}${a}`}function ot(e,r=1){return`rgba(${Math.round(e.r)}, ${Math.round(e.g)}, ${Math.round(e.b)}, ${r})`}function it(e){let r=Math.max(0,Math.min(100,e));if(r<20)return G.foliage.mid;if(r<50){let n=(r-20)/30;return{r:Math.round(G.foliage.mid.r+(G.growth.new.r-G.foliage.mid.r)*n),g:Math.round(G.foliage.mid.g+(G.growth.new.g-G.foliage.mid.g)*n),b:Math.round(G.foliage.mid.b+(G.growth.new.b-G.foliage.mid.b)*n)}}else if(r<80){let n=(r-50)/30;return{r:Math.round(G.growth.new.r+(G.unsettling.hungry.r-G.growth.new.r)*n),g:Math.round(G.growth.new.g+(G.unsettling.hungry.g-G.growth.new.g)*n),b:Math.round(G.growth.new.b+(G.unsettling.hungry.b-G.growth.new.b)*n)}}else{let n=(r-80)/20;return{r:Math.round(G.unsettling.hungry.r+(G.unsettling.starving.r-G.unsettling.hungry.r)*n),g:Math.round(G.unsettling.hungry.g+(G.unsettling.starving.g-G.unsettling.hungry.g)*n),b:Math.round(G.unsettling.hungry.b+(G.unsettling.starving.b-G.unsettling.hungry.b)*n)}}}function vn(e,r){let n=Math.max(0,Math.min(1,r)),a=e.match(/rgba?\s*\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)(?:\s*,\s*[\d.]+)?\s*\)/i);if(a)return`rgba(${a[1]}, ${a[2]}, ${a[3]}, ${n})`;let t=e.match(/#([0-9a-fA-F]{3}|[0-9a-fA-F]{6})/);if(t){let o=t[1],i,s,l;return o.length===3?(i=parseInt(o[0]+o[0],16),s=parseInt(o[1]+o[1],16),l=parseInt(o[2]+o[2],16)):(i=parseInt(o.slice(0,2),16),s=parseInt(o.slice(2,4),16),l=parseInt(o.slice(4,6),16)),`rgba(${i}, ${s}, ${l}, ${n})`}return console.warn(`Could not parse color format: "${e}". Returning as-is.`),e}var sr={};X(sr,{drawGrowingRoots:()=>or,drawGrowthIndicator:()=>pt,drawOrganicRoots:()=>ft,drawOrganicVine:()=>ct,drawVines:()=>ir});var ar={};X(ar,{clearPermutationCache:()=>lt,clearTextureCache:()=>dt,createPermutation:()=>rr,drawBarkTexture:()=>U,drawBarkTextureCached:()=>mt,drawOrganicSurface:()=>ht,fbm:()=>N,getOrCreatePermutation:()=>Z,getTextureCacheSize:()=>ut,precomputePermutations:()=>st,simplex2D:()=>k,woodPalettes:()=>tr});var ia=.5*(Math.sqrt(3)-1),on=(3-Math.sqrt(3))/6,ce=[[1,1],[-1,1],[1,-1],[-1,-1],[1,0],[-1,0],[0,1],[0,-1]];function rr(e){let r=Array.from({length:256},(a,t)=>t),n=e;for(let a=255;a>0;a--){n=n*1103515245+12345&2147483647;let t=n%(a+1);[r[a],r[t]]=[r[t],r[a]]}return[...r,...r]}var yn=new Map;function Z(e){if(yn.has(e))return yn.get(e);let r=rr(e);return yn.set(e,r),r}function st(e){for(let r of e)Z(r)}function lt(){yn.clear()}function k(e,r,n){let a=(e+r)*ia,t=Math.floor(e+a),o=Math.floor(r+a),i=(t+o)*on,s=t-i,l=o-i,d=e-s,u=r-l,m=d>u?1:0,h=d>u?0:1,b=d-m+on,g=u-h+on,p=d-1+2*on,v=u-1+2*on,c=t&255,f=o&255,C=n[c+n[f]]%8,M=n[c+m+n[f+h]]%8,y=n[c+1+n[f+1]]%8,$=0,w=0,T=0,P=.5-d*d-u*u;P>=0&&(P*=P,$=P*P*(ce[C][0]*d+ce[C][1]*u));let S=.5-b*b-g*g;S>=0&&(S*=S,w=S*S*(ce[M][0]*b+ce[M][1]*g));let R=.5-p*p-v*v;return R>=0&&(R*=R,T=R*R*(ce[y][0]*p+ce[y][1]*v)),70*($+w+T)}function N(e,r,n,a=4){let t=0,o=.5,i=1,s=0;for(let l=0;l<a;l++)t+=o*k(e*i,r*i,n),s+=o,o*=.5,i*=2;return t/s}var tr={oak:{darkBrown:{r:35,g:22,b:12},baseBrown:{r:61,g:40,b:23},midBrown:{r:85,g:58,b:35},lightBrown:{r:110,g:78,b:50},grain:{r:45,g:28,b:15},moss:{r:55,g:75,b:40}},darkWood:{darkBrown:{r:20,g:12,b:8},baseBrown:{r:38,g:25,b:15},midBrown:{r:55,g:38,b:25},lightBrown:{r:75,g:52,b:35},grain:{r:28,g:18,b:10},moss:{r:45,g:65,b:35}},weathered:{darkBrown:{r:40,g:35,b:28},baseBrown:{r:65,g:55,b:42},midBrown:{r:88,g:75,b:58},lightBrown:{r:115,g:100,b:80},grain:{r:50,g:42,b:32},moss:{r:60,g:80,b:45}}},le=new Map,sa=.1,la=10;function dt(){le.clear()}function ut(){return le.size}function U(e,r){let{width:n,height:a,grainFlow:t="vertical",age:o=.5,growthLevel:i=0,knotDensity:s=.3,mossPatches:l=!1,roughness:d=.5,color:u,woodType:m="oak",seed:h=0,time:b=0}=r,g=1920,p=1080,v=g*p,c=Math.min(n,g),f=Math.min(a,p),C=c*f;if((n>g||a>p)&&console.warn(`drawBarkTexture: Dimensions ${n}x${a} exceed safe limit. Using ${c}x${f}.`),C>v){let P=Math.sqrt(v/C);return U(e,{...r,width:Math.floor(c*P),height:Math.floor(f*P)})}let M=rr(h),y=u?da(u):tr[m],$;try{$=e.createImageData(c,f)}catch(P){if(P instanceof RangeError||P instanceof DOMException){let S=Math.floor(c*.5),R=Math.floor(f*.5);return console.error(`drawBarkTexture: Allocation failed. Falling back to ${S}x${R}.`),U(e,{...r,width:S,height:R})}throw P}let w=$.data,T=b*5e-5;for(let P=0;P<f;P++)for(let S=0;S<c;S++){let R=(P*c+S)*4,O=N(S*.008+T,P*.008,M,4),E=N(S*.016+100,P*.016+100,M,3),B=(O+1)/2,L=(E+1)/2,W,A,z;if(B<.3){let D=B/.3;W=y.darkBrown.r+(y.baseBrown.r-y.darkBrown.r)*D,A=y.darkBrown.g+(y.baseBrown.g-y.darkBrown.g)*D,z=y.darkBrown.b+(y.baseBrown.b-y.darkBrown.b)*D}else if(B<.6){let D=(B-.3)/.3;W=y.baseBrown.r+(y.midBrown.r-y.baseBrown.r)*D,A=y.baseBrown.g+(y.midBrown.g-y.baseBrown.g)*D,z=y.baseBrown.b+(y.midBrown.b-y.baseBrown.b)*D}else{let D=(B-.6)/.4;W=y.midBrown.r+(y.lightBrown.r-y.midBrown.r)*D*.4,A=y.midBrown.g+(y.lightBrown.g-y.midBrown.g)*D*.4,z=y.midBrown.b+(y.lightBrown.b-y.midBrown.b)*D*.4}W+=(L-.5)*8,A+=(L-.5)*6,z+=(L-.5)*5;let H;if(t==="vertical")H=N(S*.08,P*.008+h*.1,M,3);else if(t==="horizontal")H=N(S*.008+h*.1,P*.08,M,3);else if(t==="radial"){let D=c/2,j=f/2,x=S-D,J=P-j,ue=Math.atan2(J,x),me=Math.sqrt(x*x+J*J);H=N(ue*2+me*.01,me*.02,M,3)}else{let D=N(S*.01,P*.01,M,2)*30,j=N(S*.01+50,P*.01+50,M,2)*30;H=N((S+D)*.03,(P+j)*.03,M,3)}if(H>.3&&H<.5){let D=1-Math.abs(H-.4)*10;W=W*(1-D*.3)+y.grain.r*D*.3,A=A*(1-D*.3)+y.grain.g*D*.3,z=z*(1-D*.3)+y.grain.b*D*.3}w[R]=Math.max(0,Math.min(255,W)),w[R+1]=Math.max(0,Math.min(255,A)),w[R+2]=Math.max(0,Math.min(255,z)),w[R+3]=255}if(s>0){let P=Math.floor(s*5*(c*f)/16e4),S=[];for(let R=0;R<P;R++){let O=k(R*100+h,0,M)*.5+.5,E=k(R*100+h,100,M)*.5+.5;S.push({x:O*c,y:E*f,radius:15+k(R*50,h,M)*20})}for(let R=0;R<f;R++)for(let O=0;O<c;O++){let E=(R*c+O)*4;for(let B of S){let L=O-B.x,W=R-B.y,A=Math.sqrt(L*L+W*W);if(A<B.radius*1.5){let z=A/B.radius;if(z<1){let H=Math.sin(A*.5)*.5+.5,D=(1-z)*.4*(1+H*.3);w[E]=Math.max(0,w[E]-D*40),w[E+1]=Math.max(0,w[E+1]-D*35),w[E+2]=Math.max(0,w[E+2]-D*30)}}}}}if(i>.1){let P=Math.min(1,(i-.1)*2)*o,S=Math.floor(P*8);for(let R=0;R<S;R++){let O=k(R*200+h,0,M)*.5+.5,E=k(R*200+h,200,M)*.5+.5,B=50+k(R*100,h,M)*100,L=k(R*150,h+50,M)*Math.PI;for(let W=0;W<f;W++)for(let A=0;A<c;A++){let z=(W*c+A)*4,H=O*c,D=E*f,j=A-H,x=W-D,J=j*Math.cos(L)+x*Math.sin(L),ue=Math.abs(-j*Math.sin(L)+x*Math.cos(L));if(J>0&&J<B&&ue<3){let me=1-ue/3,Gn=1-J/B,ae=me*Gn*P*.5;w[z]=Math.max(0,w[z]-ae*50),w[z+1]=Math.max(0,w[z+1]-ae*45),w[z+2]=Math.max(0,w[z+2]-ae*40)}}}}if(i>.3){let P=Math.min(1,(i-.3)*2.5)*d;for(let S=0;S<f;S++)for(let R=0;R<c;R++){let O=(S*c+R)*4,B=N(R*.1,S*.1,M,5)*P*12;w[O]=Math.max(0,Math.min(255,w[O]+B)),w[O+1]=Math.max(0,Math.min(255,w[O+1]+B*.8)),w[O+2]=Math.max(0,Math.min(255,w[O+2]+B*.6))}}if(l&&i>.5){let P=(i-.5)*2;for(let S=0;S<f;S++)for(let R=0;R<c;R++){let O=(S*c+R)*4,E=N(R*.015+h*.5,S*.015,M,3);if(E>.3){let B=(E-.3)*1.4*P,L=Math.min(.6,B);w[O]=w[O]*(1-L)+y.moss.r*L,w[O+1]=w[O+1]*(1-L)+y.moss.g*L,w[O+2]=w[O+2]*(1-L)+y.moss.b*L}}}if(c===n&&f===a)e.putImageData($,0,0);else{let P=document.createElement("canvas");P.width=c,P.height=f,P.getContext("2d").putImageData($,0,0),e.drawImage(P,0,0,n,a)}}function mt(e,r){let{cacheKey:n,cacheTolerance:a=sa,growthLevel:t=0,...o}=r;if(!n){U(e,r);return}let i=le.get(n);if(i&&Math.abs(i.growthLevel-t)<a){e.drawImage(i.canvas,0,0);return}let s=typeof OffscreenCanvas<"u"?new OffscreenCanvas(r.width,r.height):document.createElement("canvas");s instanceof OffscreenCanvas,s.width=r.width,s.height=r.height;let l=s.getContext("2d");if(U(l,r),e.drawImage(s,0,0),le.size>=la){let d=le.keys().next().value;le.delete(d)}le.set(n,{canvas:s,growthLevel:t,timestamp:Date.now()})}function ht(e,r){let{type:n="organic",...a}=r;n==="bark"?U(e,{...a,grainFlow:"vertical",roughness:.7}):n==="wood"?U(e,{...a,grainFlow:"vertical",roughness:.4}):U(e,{...a,grainFlow:"chaotic",roughness:(a.roughness||.5)*.6})}function da(e){let r=ua(e);return{darkBrown:{r:r.r*.5,g:r.g*.5,b:r.b*.5},baseBrown:r,midBrown:{r:r.r*1.3,g:r.g*1.3,b:r.b*1.3},lightBrown:{r:r.r*1.6,g:r.g*1.6,b:r.b*1.6},grain:{r:r.r*.7,g:r.g*.7,b:r.b*.7},moss:{r:55,g:75,b:40}}}function ua(e){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:{r:61,g:40,b:23}}function or(e,r){let{origin:n,direction:a="down",length:t,branches:o=2,thickness:i=3,color:s="#3d2817",time:l=0,seed:d=0}=r;e.save(),e.strokeStyle=s,e.lineCap="round",e.lineJoin="round";let u={down:{x:0,y:1},left:{x:-1,y:0},right:{x:1,y:0},up:{x:0,y:-1}}[a],m=t*150,h=30+d%20,b=n.x+u.x*m,g=n.y+u.y*m,p=n.x+u.x*(m*.3)+(d%15-7),v=n.y+u.y*(m*.3)+(d%15-7),c=n.x+u.x*(m*.7)+(d%10-5),f=n.y+u.y*(m*.7)+(d%10-5);e.beginPath(),e.moveTo(n.x,n.y),e.bezierCurveTo(p,v,c,f,b,g);let C=e.createLinearGradient(n.x,n.y,b,g);C.addColorStop(0,s);let M=vn(s,0);C.addColorStop(1,M),e.strokeStyle=C,e.lineWidth=i*(1-t*.3),e.stroke();for(let y=0;y<o;y++){let $=(y+1)/(o+1),w=bt(n.x,p,c,b,$),T=bt(n.y,v,f,g,$),P=-u.y,S=u.x,O=((d+y*100)%60-30)*Math.PI/180,E=P*Math.cos(O)-S*Math.sin(O),B=P*Math.sin(O)+S*Math.cos(O),L=t*40*(.5+d%50/100),W=w+E*L,A=T+B*L;e.beginPath(),e.moveTo(w,T),e.lineTo(W,A),e.lineWidth=i*.5*(1-$),e.strokeStyle=s,e.stroke()}e.restore()}function ir(e,r){let{origin:n,length:a,thickness:t=2,color:o="#2d5a3d",path:i}=r;if(e.save(),e.strokeStyle=o,e.lineCap="round",e.lineJoin="round",e.lineWidth=t,i&&i.length>1){let s=i.filter(l=>l!=null&&typeof l=="object"&&typeof l.x=="number"&&typeof l.y=="number"&&!isNaN(l.x)&&!isNaN(l.y));if(s.length<2)console.warn(`drawVines: Path array has insufficient valid points (${s.length} valid out of ${i.length} total). Falling back to generated path.`);else{e.beginPath(),e.moveTo(s[0].x,s[0].y);for(let l=1;l<s.length;l++){let d=s[l-1],u=s[l];if(l<s.length-1){let m=s[l+1],h=d.x+(u.x-d.x)*.5,b=d.y+(u.y-d.y)*.5,g=u.x+(m.x-u.x)*.3,p=u.y+(m.y-u.y)*.3;e.bezierCurveTo(h,b,g,p,u.x,u.y)}else e.lineTo(u.x,u.y)}e.stroke(),e.restore();return}}{let s=Math.floor(a*20);e.beginPath(),e.moveTo(n.x,n.y);let l=n.x,d=n.y;for(let u=1;u<=s;u++){let m=u/s,h=Math.sin(m*Math.PI*3)*.3,b=Math.cos(h)*10,g=Math.sin(h)*10+5;l+=b,d+=g,e.lineTo(l,d)}e.stroke()}e.restore()}function pt(e,r){let{x:n,y:a,width:t,height:o,growthLevel:i,style:s="vines",color:l="#5a7a4d"}=r;e.save();let d=Math.max(0,Math.min(1,i)),u=o*d;switch(s){case"vines":let m=Math.floor(t/15);for(let g=0;g<m;g++){let p=n+g*t/m+5;ir(e,{origin:{x:p,y:a+o},length:d,thickness:2,color:l,direction:"up"})}break;case"roots":let h=Math.floor(t/20);for(let g=0;g<h;g++){let p=n+g*t/h+10;or(e,{origin:{x:p,y:a},length:d,thickness:2,color:l,direction:"down",branches:1,seed:g*100})}break;case"leaves":let b=Math.floor(d*10);for(let g=0;g<b;g++){let p=n+Math.random()*t,v=a+o-Math.random()*u;e.fillStyle=l,e.beginPath(),e.arc(p,v,4,0,Math.PI*2),e.fill()}break;case"bark":e.fillStyle=l,e.fillRect(n,a+o-u,t,u);break}e.restore()}function bt(e,r,n,a,t){let o=1-t;return o*o*o*e+3*o*o*t*r+3*o*t*t*n+t*t*t*a}function ct(e,r){let{origin:n,target:a,length:t,branchingDepth:o=2,organicVariation:i=.5,hasLeaves:s=!1,hasTendrils:l=!1,growthLevel:d=1,thickness:u=4,color:m="#2d5a3d",leafColor:h,time:b=0,seed:g=0}=r,p=yt(m),v=Z(g),c=h||ba(p,.15);e.save(),e.lineCap="round",e.lineJoin="round",e.strokeStyle=p,e.fillStyle=c;let f;a?f=Math.atan2(a.y-n.y,a.x-n.x):f=k(g,0,v)*Math.PI*2;let C=[],M=[];gt(e,n.x,n.y,f,u,t*d,0,o,i,v,g,b,p,a,C,M,s,l);for(let y of C)y.thickness>=1.5&&gt(e,y.x,y.y,y.angle,y.thickness,t*d*(1-y.progress)*.6,1,o,i,v,g+y.progress*1e3,b,p,void 0,[],M,s,l);if(s&&M.length>0)for(let y of M)ha(e,y.x,y.y,y.angle,y.size,c);e.restore()}function gt(e,r,n,a,t,o,i,s,l,d,u,m,h,b,g,p,v,c){if(o<5||t<.5)return;let f=Math.max(4,Math.floor(o/15)),C=o/f,M=r,y=n,$=a,w=t,T=Math.sin(m*.0015+u)*.03*l;for(let P=0;P<f;P++){let S=P/f,R=u+P*100+i*1e4,O=k(R,i*50,d)*.4*l,E=b?Math.atan2(b.y-y,b.x-M)*.1:0;$+=O+E+T;let L=.94+(k(R+500,u,d)>.6?.08:0);w*=L,w=Math.max(.5,w);let W=M+Math.cos($)*C,A=y+Math.sin($)*C,z=C*.3*(1+k(R+200,0,d)*l*.5),H=C*.3*(1+k(R+300,0,d)*l*.5),D=$+k(R+400,0,d)*.2*l,j=$-k(R+450,0,d)*.2*l,x=M+Math.cos(D)*z,J=y+Math.sin(D)*z,ue=W-Math.cos(j)*H,me=A-Math.sin(j)*H;e.beginPath(),e.moveTo(M,y),e.bezierCurveTo(x,J,ue,me,W,A);let Gn=1-S*.2;if(e.strokeStyle=sn(h,Gn),e.lineWidth=w,e.stroke(),i<s&&P>1&&P<f-1&&k(R+600,i,d)>.6-i*.1){let ae=k(R+700,0,d)>0?1:-1,Bn=$+ae*(.4+k(R+800,0,d)*.4);g.push({x:M,y,angle:Bn,thickness:w*.55,progress:S})}if(v&&P>0&&P%3===0&&w>1){let ae=k(R+900,0,d)>0?1:-1,Bn=$+ae*Math.PI*.4,Yt=6+k(R+950,0,d)*4;p.push({x:M,y,angle:Bn,size:Yt*(1-S*.3)})}M=W,y=A}c&&w<t*.5&&ma(e,M,y,$,w,d,u,h)}function ma(e,r,n,a,t,o,i,s){let l=2+k(i,100,o)*1.5,d=l*Math.PI*2,u=15+k(i+200,0,o)*10,m=k(i+300,0,o)>0?1:-1;e.beginPath(),e.moveTo(r,n);let h=r,b=n,g=u/(l*Math.PI*2),p=30;for(let v=1;v<=p;v++){let c=v/p,f=a+m*c*d,C=g*(1-c*.7);h=r+Math.cos(f)*C*c*u*.5,b=n+Math.sin(f)*C*c*u*.5,e.lineTo(h,b)}e.strokeStyle=sn(s,.85),e.lineWidth=Math.max(.5,t*.4),e.stroke()}function ha(e,r,n,a,t,o){e.save(),e.translate(r,n),e.rotate(a),e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(t*.5,-t*.4,t,0),e.quadraticCurveTo(t*.5,t*.4,0,0),e.fillStyle=o,e.fill(),e.beginPath(),e.moveTo(0,0),e.lineTo(t*.8,0),e.strokeStyle=sn(o,.7),e.lineWidth=.5,e.stroke(),e.restore()}function ft(e,r){let{origin:n,mainRootCount:a=4,maxDepth:t=3,length:o,growthLevel:i=1,thickness:s=5,color:l="#3d2817",surfaceY:d,time:u=0,seed:m=0}=r,h=Z(m);e.save(),e.lineCap="round",e.lineJoin="round";let b=Math.max(2,Math.min(6,a));for(let g=0;g<b;g++){let p=m+g*1e4,v=Math.PI*.5,c=Math.PI*.6,f=(g/(b-1)-.5)*c,C=k(p,0,h)*.2,M=v+f+C,y=o*(.7+k(p+100,0,h)*.5)*i,$=s*(.8+k(p+200,0,h)*.4);vt(e,n.x,n.y,M,$,y,0,t,h,p,u,l,d)}e.restore()}function vt(e,r,n,a,t,o,i,s,l,d,u,m,h){if(o<8||t<1||i>s)return;let b=Math.max(3,Math.floor(o/20)),g=o/b,p=r,v=n,c=a,f=t,C=.6;for(let M=0;M<b;M++){let y=M/b,$=d+M*100+i*5e3,w=k($,i*30,l)*.6*C,T=(i===0?.02:.01)*(c<Math.PI?1:-1);c+=w+T;let P=k($+500,d,l)>.65?1.12:.92;f*=P,f=Math.max(1,Math.min(t*1.2,f));let S=p+Math.cos(c)*g,R=v+Math.sin(c)*g,O=g*.35,E=c+k($+200,0,l)*.3,B=c-k($+250,0,l)*.3,L=p+Math.cos(E)*O,W=v+Math.sin(E)*O,A=S-Math.cos(B)*O,z=R-Math.sin(B)*O;if(e.beginPath(),e.moveTo(p,v),e.bezierCurveTo(L,W,A,z,S,R),e.strokeStyle=sn(m,.85-i*.05),e.lineWidth=f,e.stroke(),i<s&&M>0&&k($+600,i,l)>.5-i*.1){let H=k($+700,0,l)>0?1:-1,D=c+H*(.5+k($+800,0,l)*.5);vt(e,p,v,D,f*.5,o*(1-y)*.5,i+1,s,l,$+1e3,u,m,h)}h!==void 0&&v<h&&n>=h&&(e.fillStyle=sn(m,.6),e.beginPath(),e.ellipse(p,h,f*1.5,f*.8,0,0,Math.PI*2),e.fill()),p=S,v=R}}function sn(e,r){let n=Mt(e);return Ct(Math.round(n.r*r),Math.round(n.g*r),Math.round(n.b*r))}function ba(e,r){let n=Mt(e);return Ct(Math.round(n.r+(255-n.r)*r),Math.round(n.g+(255-n.g)*r),Math.round(n.b+(255-n.b)*r))}function yt(e){return e?/^#([a-f\d]{3}){1,2}$/i.test(e)||e.startsWith("rgb")?e:(console.warn(`Invalid color format: ${e}, using default green`),"#2d5a3d"):"#2d5a3d"}function Mt(e){let r=yt(e),n=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(r);return n?{r:parseInt(n[1],16),g:parseInt(n[2],16),b:parseInt(n[3],16)}:{r:45,g:90,b:61}}function Ct(e,r,n){return"#"+[e,r,n].map(a=>{let t=Math.max(0,Math.min(255,a)).toString(16);return t.length===1?"0"+t:t}).join("")}var ur={};X(ur,{drawFlower:()=>Pt,drawLeaf:()=>lr,drawLeaves:()=>wt});function lr(e,r){let{x:n,y:a,size:t=20,rotation:o=0,type:i="simple",color:s="#3d6a4d",opacity:l=1,growthLevel:d=1,seed:u=0}=r;switch(e.save(),e.translate(n,a),e.rotate(o),e.globalAlpha=l,i){case"simple":St(e,t,s);break;case"veined":ga(e,t,s);break;case"organic":pa(e,t,s);break;case"detailed":ca(e,t,s,d,u);break}e.restore()}function wt(e,r){r.forEach(n=>{let a=n.x+(n.driftX||0),t=n.y+(n.driftY||0);lr(e,{...n,x:a,y:t})})}function St(e,r,n){e.fillStyle=n,e.beginPath(),e.moveTo(0,-r*.5),e.bezierCurveTo(r*.3,-r*.2,r*.4,r*.3,0,r*.5),e.bezierCurveTo(-r*.4,r*.3,-r*.3,-r*.2,0,-r*.5),e.closePath(),e.fill()}function ga(e,r,n){St(e,r,n),e.strokeStyle=n,e.lineWidth=1,e.globalAlpha=.4,e.beginPath(),e.moveTo(0,-r*.5),e.lineTo(0,r*.5),e.stroke();let a=3;for(let t=0;t<a;t++){let o=(t+1)/(a+1),i=-r*.5+r*o;e.beginPath(),e.moveTo(0,i),e.lineTo(-r*.3,i+r*.1),e.stroke(),e.beginPath(),e.moveTo(0,i),e.lineTo(r*.3,i+r*.1),e.stroke()}e.globalAlpha=1}function pa(e,r,n){e.fillStyle=n,e.beginPath();let a=8,t=Math.PI*2/a;e.moveTo(0,-r*.5);for(let o=0;o<=a;o++){let i=t*o-Math.PI/2,s=r*.5*(1+Math.sin(o*.7)*.2),l=Math.cos(i)*s,d=Math.sin(i)*s;if(o===0)e.moveTo(l,d);else{let u=t*(o-1)-Math.PI/2,m=r*.5*(1+Math.sin((o-1)*.7)*.2),h=Math.cos(u)*m,b=Math.sin(u)*m,g=(h+l)/2+Math.sin(o)*r*.1,p=(b+d)/2+Math.cos(o)*r*.1;e.quadraticCurveTo(g,p,l,d)}}e.closePath(),e.fill(),e.strokeStyle=n,e.lineWidth=.5,e.globalAlpha=.3,e.beginPath(),e.moveTo(0,-r*.5),e.lineTo(0,r*.5),e.stroke(),e.globalAlpha=1}function ca(e,r,n,a,t){let o=Z(t),i=Mn(n);e.beginPath();let l=24/2,d=[],u=[];for(let m=0;m<=l;m++){let h=m/l,g=Math.sin(h*Math.PI)*.4*r,p=-r*.5+h*r,v=k(t+m*10,0,o)*r*.08,c=k(t+m*10,100,o)*r*.03;d.push({x:-g+v,y:p+c}),u.push({x:g-v,y:p+c})}e.moveTo(0,-r*.5);for(let m=0;m<u.length-1;m++){let h=u[m],b=u[m+1],g=(h.x+b.x)/2+k(t+m*20,200,o)*r*.05,p=(h.y+b.y)/2;e.quadraticCurveTo(h.x,h.y,g,p)}e.lineTo(0,r*.5);for(let m=d.length-1;m>0;m--){let h=d[m],b=d[m-1],g=(h.x+b.x)/2-k(t+m*20,300,o)*r*.05,p=(h.y+b.y)/2;e.quadraticCurveTo(h.x,h.y,g,p)}e.closePath(),e.fillStyle=n,e.fill(),a>.3&&fa(e,r,i,o,t,a),a>.2&&va(e,r,n,o,t,a)}function fa(e,r,n,a,t,o){let i=(o-.3)*1.4,s=Math.floor(i*8);e.save();for(let l=0;l<s;l++){let d=k(t+l*50,0,a)*r*.35,u=k(t+l*50,50,a)*r*.4,m=3+k(t+l*50,100,a)*4,h=k(t+l*50,150,a)*20,b=`rgba(${Math.max(0,n.r+h)}, ${Math.max(0,n.g+h)}, ${Math.max(0,n.b+h)}, 0.3)`;e.fillStyle=b,e.beginPath(),e.ellipse(d,u,m,m*.7,k(t+l,0,a),0,Math.PI*2),e.fill()}e.restore()}function va(e,r,n,a,t,o){let i=Rt(n,.7),s=Math.min(1,o*1.2);e.save(),e.strokeStyle=i,e.lineCap="round",e.lineWidth=1.5,e.globalAlpha=.5*s,e.beginPath(),e.moveTo(0,-r*.45),e.bezierCurveTo(k(t,0,a)*2,0,k(t+100,0,a)*2,r*.3,0,r*.45),e.stroke();let l=Math.floor(4+s*2);for(let d=0;d<l;d++){let u=(d+1)/(l+1),m=-r*.45+u*r*.9,h=Math.sin(u*Math.PI)*r*.35;for(let b of[-1,1]){let g=b*h*.85,p=m+r*.05;if(e.lineWidth=1,e.globalAlpha=.4*s,e.beginPath(),e.moveTo(0,m),e.quadraticCurveTo(b*h*.3+k(t+d*20,b*100,a)*3,m+r*.02,g,p),e.stroke(),o>.5){let v=2+Math.floor((o-.5)*4);for(let c=0;c<v;c++){let f=(c+1)/(v+1),C=b*h*.3*f,M=m+r*.02*f,y=C+b*h*.2,$=M+r*.03;e.lineWidth=.5,e.globalAlpha=.3*s,e.beginPath(),e.moveTo(C,M),e.lineTo(y,$),e.stroke()}}}}e.restore()}function Pt(e,r){let{x:n,y:a,petalCount:t=5,petalLength:o=15,color:i="#e8a0b0",centerColor:s="#f5d76e",growthStage:l=1,rotation:d=0,seed:u=0}=r,m=Z(u);e.save(),e.translate(n,a),e.rotate(d);let h=l*Math.PI*.4,b=Math.max(4,Math.min(8,t)),g=Math.PI*2/b;for(let p=0;p<b;p++){let v=g*p-Math.PI/2,c=u+p*100,f=1+k(c,0,m)*.15,C=1+k(c,50,m)*.1,M=k(c,100,m)*15,y=(1-l)*o*.3;e.save(),e.rotate(v);let $=Mn(i),w=dr(Math.min(255,Math.max(0,$.r+M)),Math.min(255,Math.max(0,$.g+M)),Math.min(255,Math.max(0,$.b+M)));ya(e,y,o*f*l,o*.35*C,h,w,m,c),e.restore()}if(l>.3){let p=o*.25*Math.min(1,(l-.3)*1.5);Ma(e,p,s,m,u)}e.restore()}function ya(e,r,n,a,t,o,i,s){e.save(),e.translate(0,-r),e.rotate(-t*.3),e.fillStyle=o,e.beginPath(),e.moveTo(0,0),e.bezierCurveTo(a*.8+k(s,0,i)*a*.2,-n*.3,a*.6+k(s,50,i)*a*.2,-n*.7,k(s,100,i)*a*.1,-n),e.bezierCurveTo(-a*.6-k(s,150,i)*a*.2,-n*.7,-a*.8-k(s,200,i)*a*.2,-n*.3,0,0),e.closePath(),e.fill(),e.strokeStyle=Rt(o,.85),e.lineWidth=.5,e.globalAlpha=.4,e.beginPath(),e.moveTo(0,0),e.quadraticCurveTo(k(s+300,0,i)*a*.2,-n*.5,0,-n*.85),e.stroke(),e.restore()}function Ma(e,r,n,a,t){let o=Mn(n);e.fillStyle=n,e.beginPath(),e.arc(0,0,r,0,Math.PI*2),e.fill();let i=Math.floor(r*2);for(let s=0;s<i;s++){let l=s/i*Math.PI*2,d=k(t+s*10,0,a),u=r*(.3+d*.5),m=Math.cos(l)*u,h=Math.sin(l)*u,b=1+k(t+s*10,100,a)*1,g=k(t+s*10,200,a)*30;e.fillStyle=dr(Math.max(0,Math.min(255,o.r-g)),Math.max(0,Math.min(255,o.g-g)),Math.max(0,Math.min(255,o.b-g))),e.beginPath(),e.arc(m,h,b,0,Math.PI*2),e.fill()}}function Mn(e){let r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e);return r?{r:parseInt(r[1],16),g:parseInt(r[2],16),b:parseInt(r[3],16)}:{r:61,g:106,b:77}}function dr(e,r,n){return"#"+[e,r,n].map(a=>{let t=Math.max(0,Math.min(255,Math.round(a))).toString(16);return t.length===1?"0"+t:t}).join("")}function Rt(e,r){let n=Mn(e);return dr(Math.round(n.r*r),Math.round(n.g*r),Math.round(n.b*r))}var gr={};X(gr,{GROWTH_TIMING:()=>br,applyDrift:()=>kt,applyGrowthTiming:()=>Gt,applySway:()=>$t,calculateDrift:()=>hr,calculateGrowthProgress:()=>Tt,calculatePulse:()=>It,calculateScalePulse:()=>Dt,calculateSway:()=>mr,calculateTipGrowthMultiplier:()=>Ot});function mr(e){let{intensity:r=.5,speed:n=1,time:a,baseRotation:t=0}=e,o=Math.sin(a*n*.5)*r*.05;return t+o}function hr(e){let{intensity:r=.5,speed:n=1,time:a,baseX:t=0,baseY:o=0}=e,i=Math.sin(a*n*.3)*r*5,s=Math.cos(a*n*.2)*r*3;return{x:t+i,y:o+s}}function $t(e,r,n,a){let t=mr(a);e.save(),e.translate(r,n),e.rotate(t),e.translate(-r,-n)}function kt(e,r){let{x:n,y:a}=hr(r);e.translate(n,a)}function Tt(e){let{baseGrowth:r,time:n,seed:a=0,style:t="linear"}=e,o=Math.max(0,Math.min(1,r));switch(t){case"linear":return o;case"pulse":{let s=1+(Math.sin(n*.0015+a)*.5+.5)*.3;return Math.min(1,o*s)}case"surge":{let i=o*o,s=Math.sin(n*.001+a*.1)*.05;return Math.max(0,Math.min(1,i+s))}case"glacial":{let l=(Math.sin(n*2e-4+a)*.5+.5-.5)*.04;return Math.max(0,Math.min(1,o+l))}default:return o}}function Ot(e,r,n=0){let a=e*.3,t=Math.sin(r*.002+n+e*10)*.1;return 1+a+t*e}function It(e){let{time:r,intensity:n=.15,speed:a=1,minOpacity:t=.8}=e,o=Math.sin(r*.002*a)*.5+.5,i=1-t;return t+Ca(o,i,n)}function Ca(e,r,n){return e*r*n+r*(1-n)}function Dt(e,r=.02,n=1){return 1+Math.sin(e*.001*n)*r}var br={glacial:{baseSpeed:2e-4,pulseSpeed:.001,tipMultiplier:1.2},slow:{baseSpeed:5e-4,pulseSpeed:.0015,tipMultiplier:1.3},normal:{baseSpeed:.001,pulseSpeed:.002,tipMultiplier:1.4},fast:{baseSpeed:.003,pulseSpeed:.004,tipMultiplier:1.5}};function Gt(e,r,n="slow",a=0){let t=br[n],o=r*t.baseSpeed,i=Math.sin(r*t.pulseSpeed+a)*.1,s=e+i*e;return Math.max(0,Math.min(1,s))}re("livingOs",{colors:nr,growth:sr,plants:ur,textures:ar,motion:gr});var Cn={};X(Cn,{gardenWindow:()=>Q,interpolateColor:()=>Lt,overgrown:()=>F,softGarden:()=>te,terrarium:()=>V,withAlpha:()=>Bt});var te={background:{light:"#faf6f1",mid:"#efe8dc",dark:"#dfd4c8"},accents:{pollen:"#f5e5b8",warmth:"#ffd9a3",sunRay:"#fff8eb"},particles:{pollen:{bright:"rgba(245, 229, 184, 0.6)",mid:"rgba(235, 215, 160, 0.4)",dim:"rgba(220, 200, 140, 0.2)"}}},V={background:{surface:"#c8d5b9",mid:"#7a9b76",deep:"#4a6b47",shadow:"#2d4a2c"},foliage:{new:"#a8c69f",mature:"#6b8f67",shadow:"#4a6247",accent:"#8fb581"},particles:{leaves:{light:"rgba(168, 198, 159, 0.5)",mid:"rgba(107, 143, 103, 0.35)",dark:"rgba(74, 98, 71, 0.2)"}}},Q={glass:{tint:"rgba(245, 248, 250, 0.3)",edge:"rgba(220, 230, 235, 0.5)",smudge:"rgba(200, 210, 220, 0.15)"},garden:{muted:"#b8c9b5",soft:"#9db09a",distant:"#8a998763"},particles:{dust:{bright:"rgba(220, 230, 240, 0.25)",dim:"rgba(180, 200, 220, 0.12)",veryDim:"rgba(150, 170, 190, 0.05)"}}},F={background:{dense:"#3d5a3c",vibrant:"#5a7f58",light:"#7fa67d"},growth:{vine:"#4f6b4e",leaf:"#6d8f6b",wild:"#5f9a5c",shadow:"#3a5538"},particles:{fragments:{bright:"rgba(127, 166, 125, 0.6)",mid:"rgba(95, 154, 92, 0.4)",dim:"rgba(62, 85, 60, 0.2)"}}};function Bt(e,r){let n=e.replace("#",""),a=parseInt(n.substring(0,2),16),t=parseInt(n.substring(2,4),16),o=parseInt(n.substring(4,6),16);return`rgba(${a}, ${t}, ${o}, ${r})`}function Lt(e,r,n){let a=e.replace("#",""),t=r.replace("#",""),o=parseInt(a.substring(0,2),16),i=parseInt(a.substring(2,4),16),s=parseInt(a.substring(4,6),16),l=parseInt(t.substring(0,2),16),d=parseInt(t.substring(2,4),16),u=parseInt(t.substring(4,6),16),m=Math.round(o+(l-o)*n),h=Math.round(i+(d-i)*n),b=Math.round(s+(u-s)*n);return`#${m.toString(16).padStart(2,"0")}${h.toString(16).padStart(2,"0")}${b.toString(16).padStart(2,"0")}`}var wn={};X(wn,{applyDepthLayers:()=>wa,applyFrostedGlassEffect:()=>Sa,drawAtmosphericFog:()=>Pa,drawSunRays:()=>yr,gardenWindowBackground:()=>fr,overgrownBackground:()=>vr,softGardenBackground:()=>pr,terrariumBackground:()=>cr});function pr(e,r,n){let a=e.createLinearGradient(0,0,0,n);a.addColorStop(0,te.background.light),a.addColorStop(.5,te.background.mid),a.addColorStop(1,te.background.dark),e.fillStyle=a,e.fillRect(0,0,r,n)}function cr(e,r,n){let a=e.createLinearGradient(0,0,0,n);a.addColorStop(0,V.background.deep),a.addColorStop(1,V.background.shadow),e.fillStyle=a,e.fillRect(0,0,r,n);let t=e.createLinearGradient(0,n*.2,0,n);t.addColorStop(0,V.background.mid),t.addColorStop(1,V.background.deep),e.fillStyle=t,e.globalAlpha=.6,e.fillRect(0,n*.3,r,n*.7),e.globalAlpha=1;let o=e.createLinearGradient(0,0,0,n*.4);o.addColorStop(0,V.background.surface),o.addColorStop(1,V.background.mid),e.fillStyle=o,e.globalAlpha=.5,e.fillRect(0,0,r,n*.4),e.globalAlpha=1}function fr(e,r,n){let a=e.createLinearGradient(0,0,0,n);a.addColorStop(0,Q.garden.soft),a.addColorStop(.5,Q.garden.muted),a.addColorStop(1,Q.garden.distant),e.fillStyle=a,e.fillRect(0,0,r,n),e.fillStyle=Q.glass.tint,e.fillRect(0,0,r,n)}function vr(e,r,n){let a=e.createLinearGradient(0,0,0,n);a.addColorStop(0,F.background.vibrant),a.addColorStop(.4,F.background.dense),a.addColorStop(.7,F.background.dense),a.addColorStop(1,F.growth.shadow),e.fillStyle=a,e.fillRect(0,0,r,n);let t=e.createRadialGradient(r/2,n/2,Math.min(r,n)*.3,r/2,n/2,Math.max(r,n)*.8);t.addColorStop(0,"transparent"),t.addColorStop(.7,"rgba(0, 0, 0, 0.1)"),t.addColorStop(1,"rgba(0, 0, 0, 0.2)"),e.fillStyle=t,e.fillRect(0,0,r,n)}function wa(e,r,n,a,t=3){for(let o=0;o<t;o++){let i=1/t*(o+1)*.2,s=a/t*o,l=a/t;e.fillStyle=r.includes("rgba")?r.replace(/[\d.]+\)$/,`${i})`):`rgba(0, 0, 0, ${i})`,e.fillRect(0,s,n,l)}}function yr(e,r,n,a=4){e.save();for(let t=0;t<a;t++){let o=Math.PI/a*(t+.5)-Math.PI/4,i=r*.5,s=n*-.2,l=i+Math.cos(o)*r,d=s+Math.sin(o)*n*1.5,u=e.createLinearGradient(i,s,l,d);u.addColorStop(0,"rgba(255, 248, 235, 0.3)"),u.addColorStop(.5,"rgba(255, 240, 220, 0.1)"),u.addColorStop(1,"transparent"),e.fillStyle=u,e.beginPath(),e.moveTo(i,s),e.lineTo(i+Math.cos(o)*r*1.5,s+Math.sin(o)*n*2),e.lineTo(i-Math.sin(o)*(r*.15),s+Math.cos(o)*(n*.15)),e.closePath(),e.fill()}e.restore()}function Sa(e,r,n,a=.1){let t=document.createElement("canvas");t.width=100,t.height=100;let o=t.getContext("2d");if(!o)return;for(let s=0;s<100;s+=5)for(let l=0;l<100;l+=5){let d=Math.random()*a;o.fillStyle=`rgba(255, 255, 255, ${d})`,o.fillRect(s,l,5,5)}let i=e.createPattern(t,"repeat");i&&(e.fillStyle=i,e.fillRect(0,0,r,n))}function Pa(e,r,n,a=.3){let t=e.createLinearGradient(0,0,0,n);t.addColorStop(0,`rgba(255, 255, 255, ${a*.5})`),t.addColorStop(.5,`rgba(255, 255, 255, ${a})`),t.addColorStop(1,`rgba(255, 255, 255, ${a*.3})`),e.fillStyle=t,e.fillRect(0,0,r,n)}var Pn={};X(Pn,{createDustMotes:()=>Pr,createFloatingLeaves:()=>wr,createOvergrownParticles:()=>$r,createPollen:()=>Sn,updateDustMotes:()=>Rr,updateFloatingLeaves:()=>Sr,updateOvergrownParticles:()=>kr,updatePollen:()=>Cr});var Mr={glacial:8e-4,verySlow:.001,slow:.002};function Sn(e=35){let r=[];for(let n=0;n<e;n++)r.push({x:Math.random()*100,y:Math.random()*100,size:.8+Math.random()*2.2,speed:.001+Math.random()*.004,alpha:.15+Math.random()*.25,driftPhase:Math.random()*Math.PI*2});return r}function Cr(e,r,n,a,t){e.forEach(o=>{o.y+=o.speed*t,o.y>110&&(o.y=-10),o.y<-5&&(o.y=105);let i=Math.sin(t*Mr.glacial+o.driftPhase)*.3,s=(o.x+i)*(n/100),l=o.y*(a/100);r.save(),r.fillStyle=`rgba(245, 229, 184, ${o.alpha})`,r.beginPath(),r.arc(s,l,o.size,0,Math.PI*2),r.fill(),r.strokeStyle=`rgba(255, 240, 220, ${o.alpha*.5})`,r.lineWidth=.5,r.stroke(),r.restore()})}function wr(e=18){let r=["oval","pointed","round"],n=[];for(let a=0;a<e;a++)n.push({x:Math.random()*100,y:Math.random()*100,size:3+Math.random()*5,speed:8e-4+Math.random()*.0022,alpha:.2+Math.random()*.3,rotation:Math.random()*Math.PI*2,rotationSpeed:(Math.random()-.5)*Mr.verySlow,shape:r[Math.floor(Math.random()*r.length)]});return n}function Sr(e,r,n,a,t){e.forEach(o=>{o.y+=o.speed*t*.5,o.x+=Math.sin(t*Mr.glacial+o.y*.01)*o.speed*.3,o.rotation+=o.rotationSpeed*t,o.y>110&&(o.y=-10),o.x<-10&&(o.x=110),o.x>110&&(o.x=-10);let i=o.x*(n/100),s=o.y*(a/100);switch(r.save(),r.translate(i,s),r.rotate(o.rotation),r.fillStyle=`rgba(107, 143, 103, ${o.alpha})`,o.shape){case"oval":r.ellipse(0,0,o.size*1.5,o.size,0,0,Math.PI*2);break;case"pointed":r.beginPath(),r.moveTo(0,-o.size),r.quadraticCurveTo(o.size*.7,0,0,o.size),r.quadraticCurveTo(-o.size*.7,0,0,-o.size);break;case"round":r.arc(0,0,o.size,0,Math.PI*2);break}r.fill(),r.restore()})}function Pr(e=55){let r=[];for(let n=0;n<e;n++)r.push({x:Math.random()*100,y:Math.random()*100,z:Math.random(),size:.5+Math.random()*1,speed:5e-4+Math.random()*.0015,alpha:.08+Math.random()*.17,phase:Math.random()*Math.PI*2});return r}function Rr(e,r,n,a,t){e.forEach(o=>{o.x+=Math.sin(t*o.speed+o.phase)*o.speed*.5,o.y+=Math.cos(t*o.speed+o.phase*1.3)*o.speed*.5,o.x=(o.x+100)%100,o.y=(o.y+100)%100;let i=o.x*(n/100),s=o.y*(a/100);r.save();let l=o.alpha*(.5+o.z*.5);r.fillStyle=`rgba(220, 230, 240, ${l})`,r.beginPath(),r.arc(i,s,o.size,0,Math.PI*2),r.fill(),r.restore()})}function $r(e=75){let r=[];for(let n=0;n<e;n++){let a=Math.random()>.6;r.push({x:Math.random()*100,y:Math.random()*100,size:a?1.5+Math.random()*3:.8+Math.random()*2,speed:8e-4+Math.random()*.003,alpha:.2+Math.random()*.35,rotation:Math.random()*Math.PI*2,type:a?"fragment":"pollen"})}return r}function kr(e,r,n,a,t){e.forEach(o=>{o.y+=o.speed*t*1.2,o.x+=Math.sin(t*o.speed+o.y)*o.speed*.8,o.type==="fragment"&&(o.rotation+=o.speed*t*.3),o.y>110&&(o.y=-10),o.x<-10&&(o.x=110),o.x>110&&(o.x=-10);let i=o.x*(n/100),s=o.y*(a/100);r.save(),r.translate(i,s),o.type==="fragment"?(r.rotate(o.rotation),r.fillStyle=`rgba(95, 154, 92, ${o.alpha})`,r.fillRect(-o.size*.3,-o.size*.6,o.size*.6,o.size)):(r.fillStyle=`rgba(127, 166, 125, ${o.alpha})`,r.beginPath(),r.arc(0,0,o.size,0,Math.PI*2),r.fill()),r.restore()})}var In={};X(In,{drawBlurredPlant:()=>Tn,drawFlower:()=>Et,drawFlowerCluster:()=>Ra,drawLeafCluster:()=>$n,drawOrganicVine:()=>de,drawPetal:()=>kn,drawPlantSilhouette:()=>On,drawPointedLeaf:()=>Rn,drawSimpleLeaf:()=>fe,drawVineSegment:()=>At});function fe(e,r,n,a,t,o=0){e.save(),e.translate(r,n),e.rotate(o),e.fillStyle=t,e.beginPath(),e.moveTo(0,-a),e.quadraticCurveTo(a*.6,-a*.3,a*.5,0),e.quadraticCurveTo(a*.6,a*.3,0,a),e.quadraticCurveTo(-a*.6,a*.3,-a*.5,0),e.quadraticCurveTo(-a*.6,-a*.3,0,-a),e.closePath(),e.fill(),e.strokeStyle="rgba(0, 0, 0, 0.15)",e.lineWidth=.5,e.beginPath(),e.moveTo(0,-a),e.quadraticCurveTo(a*.1,0,0,a),e.stroke(),e.restore()}function Rn(e,r,n,a,t,o=0){e.save(),e.translate(r,n),e.rotate(o),e.fillStyle=t,e.beginPath(),e.moveTo(0,-a*1.2),e.quadraticCurveTo(a*.5,-a*.4,a*.6,a*.3),e.quadraticCurveTo(a*.3,a*.8,0,a),e.quadraticCurveTo(-a*.3,a*.8,-a*.6,a*.3),e.quadraticCurveTo(-a*.5,-a*.4,0,-a*1.2),e.closePath(),e.fill(),e.restore()}function $n(e,r,n,a=5,t=8,o="#6b8f67",i=1){e.save();for(let s=0;s<a;s++){let l=(Math.random()-.5)*t*i,d=(Math.random()-.5)*t*i,u=s/a*Math.PI*2,m=.6+Math.random()*.4;e.globalAlpha=m,s%2===0?fe(e,r+l,n+d,t*.7,o,u):Rn(e,r+l,n+d,t*.6,o,u)}e.globalAlpha=1,e.restore()}function kn(e,r,n,a,t,o,i=0){e.save(),e.translate(r,n),e.rotate(i),e.fillStyle=o,e.beginPath(),e.ellipse(0,0,a*.5,t,0,0,Math.PI*2),e.fill(),e.restore()}function At(e,r,n,a,t,o,i,s=.1){e.save();let l=(r+a)/2+(Math.random()-.5)*s*20,d=(n+t)/2+(Math.random()-.5)*s*20;e.strokeStyle=i,e.lineWidth=o,e.lineCap="round",e.lineJoin="round",e.beginPath(),e.moveTo(r,n),e.quadraticCurveTo(l,d,a,t),e.stroke(),e.restore()}function de(e,r,n,a,t,o,i,s=0,l=3){if(s>l||o<.5)return;let d=r+Math.cos(t)*a,u=n+Math.sin(t)*a;if(At(e,r,n,d,u,o,i,.08),s<l){let m=a*.7,h=o*.75,b=t-.4+(Math.random()-.5)*.2;de(e,d,u,m,b,h,i,s+1,l);let g=t+.4+(Math.random()-.5)*.2;de(e,d,u,m,g,h,i,s+1,l)}}function Et(e,r,n,a=5,t=6,o="#a8c69f",i="#f5e5b8"){e.save();for(let s=0;s<a;s++){let l=s/a*Math.PI*2,d=r+Math.cos(l)*t*.8,u=n+Math.sin(l)*t*.8;kn(e,d,u,t*.6,t,o,l)}e.fillStyle=i,e.beginPath(),e.arc(r,n,t*.4,0,Math.PI*2),e.fill(),e.restore()}function Ra(e,r,n,a=3,t=30){for(let o=0;o<a;o++){let i=(Math.random()-.5)*t,s=(Math.random()-.5)*t,l=4+Math.floor(Math.random()*3);Et(e,r+i,n+s,l,4+Math.random()*2)}}function Tn(e,r,n,a,t,o=4){e.save(),e.filter=`blur(${o}px)`,e.globalAlpha=.4,$n(e,r,n,8,a,t,1.5),e.filter="none",e.globalAlpha=1,e.restore()}function On(e,r,n,a,t,o=6){e.save(),e.fillStyle=t,e.fillRect(r-1,n,2,a);for(let i=0;i<o;i++){let s=n+a/o*i,l=4+(o-i)*.5;i%2===0?fe(e,r-l*.8,s,l,t,-.3):fe(e,r+l*.8,s,l,t,.3)}e.restore()}var Dn={};X(Dn,{drawAnimatedShimmer:()=>Ia,drawDepthFog:()=>$a,drawEdgeVignette:()=>Oa,drawFrostedGlassOverlay:()=>Tr,drawGlassSmudges:()=>Or,drawLensDamage:()=>Gr,drawLensReflection:()=>ka,drawLightRays:()=>Ta,drawOrganicNoise:()=>Dr,drawVignette:()=>Ir});function Tr(e,r,n,a=.15){e.save(),e.fillStyle=`rgba(245, 248, 250, ${a*.3})`,e.fillRect(0,0,r,n);for(let t=0;t<r;t+=8)for(let o=0;o<n;o+=8){let i=Math.random()*a*.5;e.fillStyle=`rgba(255, 255, 255, ${i})`,e.fillRect(t,o,Math.random()*4+2,Math.random()*4+2)}e.restore()}function Or(e,r,n,a=8){e.save();for(let t=0;t<a;t++){let o=Math.random()*r,i=Math.random()*n,s=20+Math.random()*40,l=3+Math.random()*8,d=e.createLinearGradient(o,i,o,i+l*2);d.addColorStop(0,`rgba(220, 230, 235, ${Math.random()*.08})`),d.addColorStop(.5,`rgba(200, 210, 220, ${Math.random()*.1})`),d.addColorStop(1,"transparent"),e.fillStyle=d,e.fillRect(o,i,s,l)}e.restore()}function $a(e,r,n,a="rgba(255, 255, 255, 0.3)",t=3){e.save();for(let o=0;o<t;o++){let i=n/t*o,s=n/t,l=1/t*(o+1)*.15,d=e.createLinearGradient(0,i,0,i+s);d.addColorStop(0,`rgba(255, 255, 255, ${l*.5})`),d.addColorStop(.5,`rgba(255, 255, 255, ${l})`),d.addColorStop(1,`rgba(255, 255, 255, ${l*.5})`),e.fillStyle=d,e.fillRect(0,i,r,s)}e.restore()}function Ir(e,r,n,a=.3){e.save();let t=e.createRadialGradient(r/2,n/2,Math.min(r,n)*.2,r/2,n/2,Math.max(r,n)*.8);t.addColorStop(0,"transparent"),t.addColorStop(.6,`rgba(0, 0, 0, ${a*.3})`),t.addColorStop(1,`rgba(0, 0, 0, ${a})`),e.fillStyle=t,e.fillRect(0,0,r,n),e.restore()}function Dr(e,r,n,a=.2,t=20){e.save();for(let o=0;o<r;o+=t)for(let i=0;i<n;i+=t){let s=Math.random()*a;e.fillStyle=`rgba(0, 0, 0, ${s})`,e.fillRect(o,i,t,t)}e.restore()}function ka(e,r,n,a=40,t=.3){e.save();let o=e.createRadialGradient(r,n,0,r,n,a);o.addColorStop(0,`rgba(255, 255, 255, ${t})`),o.addColorStop(.5,`rgba(255, 255, 255, ${t*.3})`),o.addColorStop(1,"transparent"),e.fillStyle=o,e.beginPath(),e.arc(r,n,a,0,Math.PI*2),e.fill(),e.restore()}function Gr(e,r,n,a=3){e.save(),e.strokeStyle="rgba(100, 100, 100, 0.3)",e.lineWidth=1,e.lineCap="round";for(let t=0;t<a;t++){let o=Math.random()*r,i=Math.random()*n,s=o+(Math.random()-.5)*200,l=i+(Math.random()-.5)*200;e.beginPath(),e.moveTo(o,i);for(let d=0;d<10;d++){let u=o+(s-o)*d/10+(Math.random()-.5)*10,m=i+(l-i)*d/10+(Math.random()-.5)*10;e.lineTo(u,m)}e.lineTo(s,l),e.stroke()}e.restore()}function Ta(e,r,n,a=4,t=.2){e.save();for(let o=0;o<a;o++){let i=Math.PI/a*o-Math.PI/8,s=r/2,l=-n*.2,d=s+Math.cos(i)*r*1.5,u=l+Math.sin(i)*n*2,m=e.createLinearGradient(s,l,d,u);m.addColorStop(0,`rgba(255, 248, 235, ${t})`),m.addColorStop(.5,`rgba(255, 240, 220, ${t*.5})`),m.addColorStop(1,"transparent"),e.fillStyle=m,e.beginPath(),e.moveTo(s,l),e.lineTo(d,u),e.lineTo(s-Math.sin(i)*r*.3,l+Math.cos(i)*n*.3),e.closePath(),e.fill()}e.restore()}function Oa(e,r,n,a="rgba(0, 0, 0, 0.3)",t=40){e.save(),e.fillStyle=a,e.fillRect(0,0,r,t),e.fillRect(0,n-t,r,t),e.fillRect(0,0,t,n),e.fillRect(r-t,0,t,n),e.restore()}function Ia(e,r,n,a,t,o,i=.15){e.save();let s=Math.sin(o*.002)*i;e.fillStyle=`rgba(255, 255, 255, ${s})`,e.fillRect(r,n,a,t),e.restore()}var Br={};X(Br,{drawGardenThroughGlass:()=>Xt,drawOvergrownCamera:()=>Ht,drawSoftGardenWindow:()=>Wt,drawTerrariumView:()=>zt});var ve={glacial:8e-4,verySlow:.001,slow:.002},Da={pollenParticles:Sn(35)};function Wt(e,r,n,a,t,o={}){let{time:i=0,intensity:s=1}=o;e.save(),e.translate(r,n),pr(e,a,t),e.globalAlpha=.3*s,yr(e,a,t,4),e.globalAlpha=1,Cr(Da.pollenParticles,e,a,t,i),e.globalAlpha=.25*s;for(let l=0;l<6;l++){let d=(Math.sin(i*ve.glacial+l)*.5+.5)*a,u=(Math.cos(i*ve.glacial+l*.7)*.5+.5)*t;kn(e,d,u,3,5,te.accents.pollen,0)}e.globalAlpha=1,e.restore()}var Ga={leafParticles:wr(18)};function zt(e,r,n,a,t,o={}){let{time:i=0,growthLevel:s=0,intensity:l=1}=o;e.save(),e.translate(r,n),cr(e,a,t),e.globalAlpha=.35*l;for(let d=0;d<6;d++){let u=a/6*d+Math.sin(i*ve.verySlow+d)*20,m=t*.3+(Math.random()*30-15);Tn(e,u,m,12+Math.random()*8,V.foliage.shadow)}e.globalAlpha=1,e.globalAlpha=.6*l;for(let d=0;d<5;d++){let u=(Math.random()*.8+.1)*a,m=(Math.random()*.4+.2)*t;$n(e,u,m,6,8,V.foliage.mature,1.2)}e.globalAlpha=1,Sr(Ga.leafParticles,e,a,t,i),e.globalAlpha=.8*l,On(e,a*.15,t*.4,t*.5,V.background.shadow,7),On(e,a*.85,t*.35,t*.55,V.background.shadow,8),e.globalAlpha=1,e.strokeStyle=`rgba(200, 220, 230, ${.1*l})`,e.lineWidth=2,e.strokeRect(10,10,a-20,t-20),e.restore()}var Ba={dustMotes:Pr(55),pollenParticles:Sn(15)};function Xt(e,r,n,a,t,o={}){let{time:i=0,intensity:s=1}=o;e.save(),e.translate(r,n),fr(e,a,t),e.globalAlpha=.25*s;for(let l=0;l<10;l++){let d=(Math.random()*.8+.1)*a,u=(Math.random()*.6+.1)*t;Tn(e,d,u,15+Math.random()*10,Q.garden.soft,8)}e.globalAlpha=1,Rr(Ba.dustMotes,e,a,t,i),e.globalAlpha=.2*s,Tr(e,a,t,.12),e.globalAlpha=1,e.globalAlpha=.15*s,Or(e,a,t,6),e.globalAlpha=1,e.globalAlpha=.3*s,Ir(e,a,t,.25),e.globalAlpha=1,e.restore()}var La={particles:$r(75)};function Ht(e,r,n,a,t,o={}){let{time:i=0,growthLevel:s=0,intensity:l=1}=o;e.save(),e.translate(r,n),vr(e,a,t),e.globalAlpha=.7*l;for(let d=0;d<3;d++){let u=t/3*d+Math.sin(i*ve.verySlow+d)*20;de(e,-10,u,60+d*20,.2+Math.random()*.3,2+d*.5,F.growth.vine,0,2)}for(let d=0;d<3;d++){let u=t/3*d+Math.cos(i*ve.verySlow+d*1.5)*20;de(e,a+10,u,60+d*20,Math.PI-(.2+Math.random()*.3),2+d*.5,F.growth.vine,0,2)}for(let d=0;d<2;d++){let u=a/2.5*d+Math.sin(i*ve.verySlow+d*2)*20;de(e,u,-10,50+d*15,Math.PI/2+(Math.random()-.5)*.4,1.5+d*.5,F.growth.vine,0,2)}e.globalAlpha=1,e.globalAlpha=.65*l;for(let d=0;d<40;d++){let u=Math.random()*a,m=Math.random()*t,h=3+Math.random()*6,b=Math.random()*Math.PI*2;Math.random()>.5?fe(e,u,m,h,F.growth.leaf,b):Rn(e,u,m,h,F.growth.wild,b)}e.globalAlpha=1,kr(La.particles,e,a,t,i),e.globalAlpha=.2*l,Dr(e,a,t,.15,30),e.globalAlpha=1,s>50&&(e.globalAlpha=.15*l,Gr(e,a,t,2),e.globalAlpha=1),e.restore()}re("garden",{colors:Cn,gradients:wn,particles:Pn,plants:In,textures:Dn,recipes:Br});return _t(Aa);})();
