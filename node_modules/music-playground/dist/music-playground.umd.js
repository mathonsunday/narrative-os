(function(V,N){typeof exports=="object"&&typeof module<"u"?N(exports):typeof define=="function"&&define.amd?define(["exports"],N):(V=typeof globalThis<"u"?globalThis:V||self,N(V.MusicPlayground={}))})(this,function(V){"use strict";var hn=Object.defineProperty;var dn=(V,N,x)=>N in V?hn(V,N,{enumerable:!0,configurable:!0,writable:!0,value:x}):V[N]=x;var y=(V,N,x)=>dn(V,typeof N!="symbol"?N+"":N,x);let N=null,x=null;function d(){return N||(N=new AudioContext),N}function R(){if(!x){const i=d();x=i.createGain(),x.gain.value=.7,x.connect(i.destination)}return x}async function K(){const i=d();i.state==="suspended"&&await i.resume()}function X(){return d().sampleRate}class D{constructor(){y(this,"layers",[]);y(this,"masterGain");y(this,"isPlaying",!1);y(this,"presetHandlers",new Map);this.masterGain=R()}getMasterGain(){return this.masterGain}getIsPlaying(){return this.isPlaying}getLayers(){return this.layers}registerPreset(n,e){this.presetHandlers.set(n,e)}async play(n,e={}){await K();const a={intensity:.5,depth:2e3,mystery:.3,interval:5,fadeIn:2,...e};this.isPlaying=!0;const t=this.presetHandlers.get(n);t?t(this,a):console.warn(`Preset "${n}" not found. Register it with registerPreset().`)}async addLayer(n,e={}){await this.play(n,e)}stop(n=1){const a=d().currentTime;this.isPlaying=!1;for(const t of this.layers){for(const r of t.gains)r.gain.setValueAtTime(r.gain.value,a),r.gain.linearRampToValueAtTime(0,a+n);setTimeout(()=>{for(const r of t.oscillators)try{r.stop()}catch{}if(t.noiseSource)try{t.noiseSource.stop()}catch{}for(const r of t.intervals)clearInterval(r)},n*1e3)}this.layers=[]}setVolume(n){const e=d();this.masterGain.gain.setValueAtTime(n,e.currentTime)}addFilteredNoise(n,e,a,t,r){const o=d(),s=o.sampleRate*10,c=o.createBuffer(1,s,o.sampleRate),u=c.getChannelData(0);for(let p=0;p<s;p++)u[p]=Math.random()*2-1;const l=o.createBufferSource();l.buffer=c,l.loop=!0;const f=o.createBiquadFilter();f.type="lowpass",f.frequency.value=t;const m=o.createBiquadFilter();m.type="highpass",m.frequency.value=a;const h=o.createGain();h.gain.value=0,h.gain.linearRampToValueAtTime(e,o.currentTime+r),l.connect(f),f.connect(m),m.connect(h),h.connect(this.masterGain),l.start(),n.noiseSource=l,n.gains.push(h)}}class k{constructor(n=.5){y(this,"masterGain");y(this,"volume",.5);y(this,"soundHandlers",new Map);this.masterGain=R(),this.volume=n}registerSound(n,e){this.soundHandlers.set(n,e)}setVolume(n){this.volume=Math.max(0,Math.min(1,n))}async play(n){await K();const e=this.soundHandlers.get(n);e?e(this):console.warn(`Sound effect "${n}" not found. Register it with registerSound().`)}getMasterGain(){return this.masterGain}getVolume(){return this.volume}}const Me={waveform:"sawtooth",filterCutoff:2e3,filterResonance:2,envelope:{attack:.01,decay:.2,sustain:.5,release:.3},detune:10,numOscillators:2};class Y{constructor(n={}){y(this,"options");y(this,"activeVoices",new Map);y(this,"outputNode");this.options={...Me,...n};const e=d();this.outputNode=e.createGain(),this.outputNode.gain.value=.5,this.outputNode.connect(R())}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}playNote(n,e,a){const t=d(),r=e??t.currentTime,{envelope:o,waveform:s,filterCutoff:c,filterResonance:u,detune:l,numOscillators:f}=this.options,m=[];for(let M=0;M<f;M++){const O=t.createOscillator();if(O.type=s,O.frequency.setValueAtTime(n,r),M>0){const _=(M%2===0?1:-1)*l*Math.ceil(M/2);O.detune.setValueAtTime(_,r)}m.push(O)}const h=t.createBiquadFilter();h.type="lowpass",h.frequency.setValueAtTime(c,r),h.Q.setValueAtTime(u,r);const p=t.createGain();p.gain.setValueAtTime(0,r),m.forEach(M=>M.connect(h)),h.connect(p),p.connect(this.outputNode);const g=r+o.attack,T=g+o.decay;if(p.gain.linearRampToValueAtTime(1,g),p.gain.linearRampToValueAtTime(o.sustain,T),m.forEach(M=>M.start(r)),a){const M=r+a,O=M+o.release;p.gain.setValueAtTime(o.sustain,M),p.gain.linearRampToValueAtTime(0,O),m.forEach(_=>_.stop(O))}const w=n*1e3+r;this.activeVoices.set(w,{oscillators:m,gainNode:p,filterNode:h,isPlaying:!0});const S=a?(r+a+o.release+.1)*1e3:void 0;S&&setTimeout(()=>{this.activeVoices.delete(w)},S-Date.now())}startNote(n){const e=d(),a=e.currentTime,{envelope:t,waveform:r,filterCutoff:o,filterResonance:s,detune:c,numOscillators:u}=this.options,l=[];for(let T=0;T<u;T++){const w=e.createOscillator();if(w.type=r,w.frequency.setValueAtTime(n,a),T>0){const S=(T%2===0?1:-1)*c*Math.ceil(T/2);w.detune.setValueAtTime(S,a)}l.push(w)}const f=e.createBiquadFilter();f.type="lowpass",f.frequency.setValueAtTime(o,a),f.Q.setValueAtTime(s,a);const m=e.createGain();m.gain.setValueAtTime(0,a),l.forEach(T=>T.connect(f)),f.connect(m),m.connect(this.outputNode);const h=a+t.attack,p=h+t.decay;m.gain.linearRampToValueAtTime(1,h),m.gain.linearRampToValueAtTime(t.sustain,p),l.forEach(T=>T.start(a));const g=Math.random()*1e5;return this.activeVoices.set(g,{oscillators:l,gainNode:m,filterNode:f,isPlaying:!0}),g}releaseNote(n){const e=this.activeVoices.get(n);if(!e||!e.isPlaying)return;const t=d().currentTime,{envelope:r}=this.options;e.isPlaying=!1,e.gainNode.gain.cancelScheduledValues(t),e.gainNode.gain.setValueAtTime(e.gainNode.gain.value,t),e.gainNode.gain.linearRampToValueAtTime(0,t+r.release),e.oscillators.forEach(o=>o.stop(t+r.release)),setTimeout(()=>{this.activeVoices.delete(n)},(r.release+.1)*1e3)}setFilterCutoff(n){this.options.filterCutoff=n;const e=d();this.activeVoices.forEach(a=>{a.filterNode.frequency.setValueAtTime(n,e.currentTime)})}setFilterResonance(n){this.options.filterResonance=n;const e=d();this.activeVoices.forEach(a=>{a.filterNode.Q.setValueAtTime(n,e.currentTime)})}setWaveform(n){this.options.waveform=n}setEnvelope(n){this.options.envelope={...this.options.envelope,...n}}getOptions(){return{...this.options}}stopAll(){this.activeVoices.forEach((n,e)=>{this.releaseNote(e)})}}const be={damping:.5,brightness:.8,pluckPosition:.5};class Z{constructor(n={}){y(this,"options");y(this,"outputNode");y(this,"activeVoices",new Map);this.options={...be,...n};const e=d();this.outputNode=e.createGain(),this.outputNode.gain.value=.7,this.outputNode.connect(R())}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}generateKarplusStrong(n,e){const a=d(),t=X(),r=Math.ceil(t*e),o=Math.round(t/n),s=new Float32Array(o),c=Math.max(1,Math.floor(o*this.options.pluckPosition));for(let g=0;g<o;g++)if(g<c){const T=Math.sin(Math.PI*g/c);s[g]=(Math.random()*2-1)*T}else s[g]=0;const u=a.createBuffer(1,r,t),l=u.getChannelData(0),f=.5+(1-this.options.damping)*.499,m=this.options.brightness;let h=0,p=0;for(let g=0;g<r;g++){const T=s[p];l[g]=T;const w=(p+1)%o,S=s[w];let M=f*(T+S)/2;M=m*M+(1-m)*h,h=M,s[p]=M,p=w}return u}playNote(n,e,a=2){const t=d(),r=e??t.currentTime,o=this.generateKarplusStrong(n,a),s=t.createBufferSource();s.buffer=o,s.connect(this.outputNode),s.start(r);const c=n*1e3+Math.random();this.activeVoices.set(c,s),s.onended=()=>{this.activeVoices.delete(c)}}startNote(n){const e=d(),a=this.generateKarplusStrong(n,4),t=e.createBufferSource();t.buffer=a,t.connect(this.outputNode),t.start(e.currentTime);const r=Math.random()*1e5;return this.activeVoices.set(r,t),t.onended=()=>{this.activeVoices.delete(r)},r}releaseNote(n){const e=this.activeVoices.get(n);if(e){try{e.stop()}catch{}this.activeVoices.delete(n)}}setDamping(n){this.options.damping=Math.max(0,Math.min(1,n))}setBrightness(n){this.options.brightness=Math.max(0,Math.min(1,n))}setPluckPosition(n){this.options.pluckPosition=Math.max(.1,Math.min(.9,n))}getOptions(){return{...this.options}}stopAll(){this.activeVoices.forEach(n=>{try{n.stop()}catch{}}),this.activeVoices.clear()}}class ee{constructor(){y(this,"outputNode");const n=d();this.outputNode=n.createGain(),this.outputNode.gain.value=.7,this.outputNode.connect(R())}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}playKick(n){const e=d(),a=n??e.currentTime,t=e.createOscillator(),r=e.createGain();t.type="sine",t.frequency.setValueAtTime(150,a),t.frequency.exponentialRampToValueAtTime(40,a+.1),r.gain.setValueAtTime(1,a),r.gain.exponentialRampToValueAtTime(.01,a+.4),t.connect(r),r.connect(this.outputNode),t.start(a),t.stop(a+.5)}playSnare(n){const e=d(),a=n??e.currentTime,t=e.createBuffer(1,e.sampleRate*.2,e.sampleRate),r=t.getChannelData(0);for(let f=0;f<r.length;f++)r[f]=Math.random()*2-1;const o=e.createBufferSource();o.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.value=1e3;const c=e.createGain();c.gain.setValueAtTime(.5,a),c.gain.exponentialRampToValueAtTime(.01,a+.15),o.connect(s),s.connect(c),c.connect(this.outputNode);const u=e.createOscillator(),l=e.createGain();u.type="triangle",u.frequency.setValueAtTime(200,a),u.frequency.exponentialRampToValueAtTime(100,a+.05),l.gain.setValueAtTime(.5,a),l.gain.exponentialRampToValueAtTime(.01,a+.1),u.connect(l),l.connect(this.outputNode),o.start(a),u.start(a),u.stop(a+.2)}playHiHat(n=!1,e){const a=d(),t=e??a.currentTime,r=n?.3:.08,o=a.createBuffer(1,a.sampleRate*r,a.sampleRate),s=o.getChannelData(0);for(let f=0;f<s.length;f++)s[f]=Math.random()*2-1;const c=a.createBufferSource();c.buffer=o;const u=a.createBiquadFilter();u.type="highpass",u.frequency.value=7e3;const l=a.createGain();l.gain.setValueAtTime(.3,t),l.gain.exponentialRampToValueAtTime(.01,t+r),c.connect(u),u.connect(l),l.connect(this.outputNode),c.start(t)}}function Ne(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}function Se(i){if(i.__esModule)return i;var n=i.default;if(typeof n=="function"){var e=function a(){return this instanceof a?Reflect.construct(n,arguments,this.constructor):n.apply(this,arguments)};e.prototype=n.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(i).forEach(function(a){var t=Object.getOwnPropertyDescriptor(i,a);Object.defineProperty(e,a,t.get?t:{enumerable:!0,get:function(){return i[a]}})}),e}var te={exports:{}},ne={exports:{}};function xe(i){return i>64&&i<91?i-65:i>96&&i<123?i-71:i>47&&i<58?i+4:i===43?62:i===47?63:0}function Re(i,n){for(var e=i.replace(/[^A-Za-z0-9\+\/]/g,""),a=e.length,t=n?Math.ceil((a*3+1>>2)/n)*n:a*3+1>>2,r=new Uint8Array(t),o,s,c=0,u=0,l=0;l<a;l++)if(s=l&3,c|=xe(e.charCodeAt(l))<<18-6*s,s===3||a-l===1){for(o=0;o<3&&u<t;o++,u++)r[u]=c>>>(16>>>o&24)&255;c=0}return r}var qe={decode:Re},Oe=function(i,n){return new Promise(function(e,a){var t=new XMLHttpRequest;n&&(t.responseType=n),t.open("GET",i),t.onload=function(){t.status===200?e(t.response):a(Error(t.statusText))},t.onerror=function(){a(Error("Network Error"))},t.send()})};(function(i){var n=qe,e=Oe;function a(A){return function(v){return typeof v=="string"&&A.test(v)}}function t(A,v){return typeof A=="string"?A+v:typeof A=="function"?A(v):v}function r(A,v,G,b){var E=o(v)?s:c(v)?u:l(v)?f:m(v)?h:p(v)?g:T(v)?w:S(v)?M:O(v)?_:null,I=G||{};return E?E(A,v,I):b?Promise.resolve(b):Promise.reject("Source not valid ("+v+")")}r.fetch=e;function o(A){return A instanceof ArrayBuffer}function s(A,v,G){return new Promise(function(b,E){A.decodeAudioData(v,function(I){b(I)},function(){E("Can't decode audio data ("+v.slice(0,30)+"...)")})})}var c=a(/\.(mp3|wav|ogg)(\?.*)?$/i);function u(A,v,G){var b=t(G.from,v);return r(A,r.fetch(b,"arraybuffer"),G)}function l(A){return A&&typeof A.then=="function"}function f(A,v,G){return v.then(function(b){return r(A,b,G)})}var m=Array.isArray;function h(A,v,G){return Promise.all(v.map(function(b){return r(A,b,G,b)}))}function p(A){return A&&typeof A=="object"}function g(A,v,G){var b={},E=Object.keys(v).map(function(I){if(G.only&&G.only.indexOf(I)===-1)return null;var Ge=v[I];return r(A,Ge,G,Ge).then(function(mn){b[I]=mn})});return Promise.all(E).then(function(){return b})}var T=a(/\.json(\?.*)?$/i);function w(A,v,G){var b=t(G.from,v);return r(A,r.fetch(b,"text").then(JSON.parse),G)}var S=a(/^data:audio/);function M(A,v,G){var b=v.indexOf(",");return r(A,n.decode(v.slice(b+1)).buffer,G)}var O=a(/\.js(\?.*)?$/i);function _(A,v,G){var b=t(G.from,v);return r(A,r.fetch(b,"text").then(fn),G)}function fn(A){var v=A.indexOf("MIDI.Soundfont.");if(v<0)throw Error("Invalid MIDI.js Soundfont format");v=A.indexOf("=",v)+2;var G=A.lastIndexOf(",");return JSON.parse(A.slice(v,G)+"}")}i.exports&&(i.exports=r),typeof window<"u"&&(window.loadAudio=r)})(ne);var Pe=ne.exports,ae={exports:{}},Ie=Be;function Be(i){var n=i.createGain(),e=n._voltage=Le(i),a=B(e),t=B(e),r=B(e);return n._startAmount=B(t),n._endAmount=B(r),n._multiplier=B(a),n._multiplier.connect(n),n._startAmount.connect(n),n._endAmount.connect(n),n.value=a.gain,n.startValue=t.gain,n.endValue=r.gain,n.startValue.value=0,n.endValue.value=0,Object.defineProperties(n,Ee),n}var Ee={attack:{value:0,writable:!0},decay:{value:0,writable:!0},sustain:{value:1,writable:!0},release:{value:0,writable:!0},getReleaseDuration:{value:function(){return this.release}},start:{value:function(i){var n=this._multiplier.gain,e=this._startAmount.gain,a=this._endAmount.gain;this._voltage.start(i),this._decayFrom=this._decayFrom=i+this.attack,this._startedAt=i;var t=this.sustain;n.cancelScheduledValues(i),e.cancelScheduledValues(i),a.cancelScheduledValues(i),a.setValueAtTime(0,i),this.attack?(n.setValueAtTime(0,i),n.linearRampToValueAtTime(1,i+this.attack),e.setValueAtTime(1,i),e.linearRampToValueAtTime(0,i+this.attack)):(n.setValueAtTime(1,i),e.setValueAtTime(0,i)),this.decay&&n.setTargetAtTime(t,this._decayFrom,ie(this.decay))}},stop:{value:function(i,n){n&&(i=i-this.release);var e=i+this.release;if(this.release){var a=this._multiplier.gain,t=this._startAmount.gain,r=this._endAmount.gain;a.cancelScheduledValues(i),t.cancelScheduledValues(i),r.cancelScheduledValues(i);var o=ie(this.release);if(this.attack&&i<this._decayFrom){var s=_e(0,1,this._startedAt,this._decayFrom,i);a.linearRampToValueAtTime(s,i),t.linearRampToValueAtTime(1-s,i),t.setTargetAtTime(0,i,o)}r.setTargetAtTime(1,i,o),a.setTargetAtTime(0,i,o)}return this._voltage.stop(e),e}},onended:{get:function(){return this._voltage.onended},set:function(i){this._voltage.onended=i}}},Fe=new Float32Array([1,1]);function Le(i){var n=i.createBufferSource(),e=i.createBuffer(1,2,i.sampleRate);return e.getChannelData(0).set(Fe),n.buffer=e,n.loop=!0,n}function B(i){var n=i.context.createGain();return i.connect(n),n}function ie(i){return Math.log(i+1)/Math.log(100)}function _e(i,n,e,a,t){var r=n-i,o=a-e,s=t-e,c=s/o,u=i+c*r;return u<=i&&(u=i),u>=n&&(u=n),u}var De=Ie,ke={},Ce={gain:1,attack:.01,decay:.1,sustain:.9,release:.3,loop:!1,cents:0,loopStart:0,loopEnd:0};function $e(i,n,e){var a=!1,t=0,r={},o=i.createGain();o.gain.value=1;var s=Object.assign({},Ce,e),c={context:i,out:o,opts:s};return n instanceof AudioBuffer?c.buffer=n:c.buffers=n,c.start=function(f,m,h){if(c.buffer&&f!==null)return c.start(null,f,m);var p=f?c.buffers[f]:c.buffer;if(p){if(!a){console.warn("SamplePlayer not connected to any node.");return}}else{console.warn("Buffer "+f+" not found.");return}var g=h||ke;m=Math.max(i.currentTime,m||0),c.emit("start",m,f,g);var T=l(f,p,g);return T.id=u(f,T),T.env.start(m),T.source.start(m),c.emit("started",m,T.id,T),g.duration&&T.stop(m+g.duration),T},c.play=function(f,m,h){return c.start(f,m,h)},c.stop=function(f,m){var h;return m=m||Object.keys(r),m.map(function(p){return h=r[p],h?(h.stop(f),h.id):null})},c.connect=function(f){return a=!0,o.connect(f),c},c.emit=function(f,m,h,p){c.onevent&&c.onevent(f,m,h,p);var g=c["on"+f];g&&g(m,h,p)},c;function u(f,m){return m.id=t++,r[m.id]=m,m.source.onended=function(){var h=i.currentTime;m.source.disconnect(),m.env.disconnect(),m.disconnect(),c.emit("ended",h,m.id,m)},m.id}function l(f,m,h){var p=i.createGain();return p.gain.value=0,p.connect(o),p.env=Ue(i,h,s),p.env.connect(p.gain),p.source=i.createBufferSource(),p.source.buffer=m,p.source.connect(p),p.source.loop=h.loop||s.loop,p.source.playbackRate.value=He(h.cents||s.cents),p.source.loopStart=h.loopStart||s.loopStart,p.source.loopEnd=h.loopEnd||s.loopEnd,p.stop=function(g){var T=g||i.currentTime;c.emit("stop",T,f);var w=p.env.stop(T);p.source.stop(w)},p}}function re(i){return typeof i=="number"}var je=["attack","decay","sustain","release"];function Ue(i,n,e){var a=De(i),t=n.adsr||e.adsr;return je.forEach(function(r,o){t?a[r]=t[o]:a[r]=n[r]||e[r]}),a.value.value=re(n.gain)?n.gain:re(e.gain)?e.gain:1,a}function He(i){return i?Math.pow(2,i/1200):1}var We=$e,ze=function(i){return i.on=function(n,e){if(arguments.length===1&&typeof n=="function")return i.on("event",n);var a="on"+n,t=i[a];return i[a]=t?Je(t,e):e,i},i};function Je(i,n){return function(e,a,t,r){i(e,a,t,r),n(e,a,t,r)}}var oe=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function Qe(){return oe}var Ke=[0,2,4,5,7,9,11];function se(i,n,e){if(typeof i!="string")return null;var a=oe.exec(i);if(!a||!n&&a[4])return null;var t={letter:a[1].toUpperCase(),acc:a[2].replace(/x/g,"##")};return t.pc=t.letter+t.acc,t.step=(t.letter.charCodeAt(0)+3)%7,t.alt=t.acc[0]==="b"?-t.acc.length:t.acc.length,t.chroma=Ke[t.step]+t.alt,a[3]&&(t.oct=+a[3],t.midi=t.chroma+12*(t.oct+1),t.freq=ce(t.midi,e)),n&&(t.tonicOf=a[4]),t}function ce(i,n){return Math.pow(2,(i-69)/12)*(n||440)}var ue={parse:se,regex:Qe,midiToFreq:ce},Xe=["letter","acc","pc","step","alt","chroma","oct","midi","freq"];Xe.forEach(function(i){ue[i]=function(n){var e=se(n);return e&&typeof e[i]<"u"?e[i]:null}});var Ye=ue,Ze=Ye,et=function(i){return i!==null&&i!==[]&&i>=0&&i<129},tt=function(i){return et(i)?+i:Ze.midi(i)},nt=function(i){if(i.buffers){var n=i.opts.map,e=typeof n=="function"?n:tt,a=function(r){return r?e(r)||r:null};i.buffers=at(i.buffers,a);var t=i.start;i.start=function(r,o,s){var c=a(r),u=c%1;return u&&(c=Math.floor(c),s=Object.assign(s||{},{cents:Math.floor(u*100)})),t(c,o,s)}}return i};function at(i,n){return Object.keys(i).reduce(function(e,a){return e[n(a)]=i[a],e},{})}var it=Array.isArray,rt=function(i){return i&&typeof i=="object"},ot={},st=function(i){return i.schedule=function(n,e){var a=i.context.currentTime,t=n<a?a:n;i.emit("schedule",t,e);var r,o,s,c;return e.map(function(u){if(u)it(u)?(r=u[0],o=u[1]):(r=u.time,o=u);else return null;return rt(o)?(s=o.name||o.key||o.note||o.midi||null,c=o):(s=o,c=ot),i.start(s,t+(r||0),c)})},i};function C(i){throw new Error('Could not dynamically require "'+i+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var le={exports:{}};(function(i,n){(function(e){i.exports=e()})(function(){return function e(a,t,r){function o(u,l){if(!t[u]){if(!a[u]){var f=typeof C=="function"&&C;if(!l&&f)return f(u,!0);if(s)return s(u,!0);var m=new Error("Cannot find module '"+u+"'");throw m.code="MODULE_NOT_FOUND",m}var h=t[u]={exports:{}};a[u][0].call(h.exports,function(p){var g=a[u][1][p];return o(g||p)},h,h.exports,e,a,t,r)}return t[u].exports}for(var s=typeof C=="function"&&C,c=0;c<r.length;c++)o(r[c]);return o}({1:[function(e,a,t){Object.defineProperty(t,"__esModule",{value:!0}),t.default=function(r){function o(s){if(this._event=s,this._data=s.data,this.receivedTime=s.receivedTime,this._data&&this._data.length<2){console.warn("Illegal MIDI message of length",this._data.length);return}switch(this._messageCode=s.data[0]&240,this.channel=s.data[0]&15,this._messageCode){case 128:this.messageType="noteoff",this.key=s.data[1]&127,this.velocity=s.data[2]&127;break;case 144:this.messageType="noteon",this.key=s.data[1]&127,this.velocity=s.data[2]&127;break;case 160:this.messageType="keypressure",this.key=s.data[1]&127,this.pressure=s.data[2]&127;break;case 176:this.messageType="controlchange",this.controllerNumber=s.data[1]&127,this.controllerValue=s.data[2]&127,this.controllerNumber===120&&this.controllerValue===0?this.channelModeMessage="allsoundoff":this.controllerNumber===121?this.channelModeMessage="resetallcontrollers":this.controllerNumber===122?this.controllerValue===0?this.channelModeMessage="localcontroloff":this.channelModeMessage="localcontrolon":this.controllerNumber===123&&this.controllerValue===0?this.channelModeMessage="allnotesoff":this.controllerNumber===124&&this.controllerValue===0?this.channelModeMessage="omnimodeoff":this.controllerNumber===125&&this.controllerValue===0?this.channelModeMessage="omnimodeon":this.controllerNumber===126?this.channelModeMessage="monomodeon":this.controllerNumber===127&&(this.channelModeMessage="polymodeon");break;case 192:this.messageType="programchange",this.program=s.data[1];break;case 208:this.messageType="channelpressure",this.pressure=s.data[1]&127;break;case 224:this.messageType="pitchbendchange";var c=s.data[2]&127,u=s.data[1]&127;this.pitchBend=(c<<8)+u;break}}return new o(r)},a.exports=t.default},{}]},{},[1])(1)})})(le);var ct=le.exports,ut=ct,lt=function(i){return i.listenToMidi=function(n,e){var a={},t=e||{},r=t.gain||function(o){return o/127};return n.onmidimessage=function(o){var s=o.messageType?o:ut(o);if(s.messageType==="noteon"&&s.velocity===0&&(s.messageType="noteoff"),!(t.channel&&s.channel!==t.channel))switch(s.messageType){case"noteon":a[s.key]=i.play(s.key,0,{gain:r(s.velocity)});break;case"noteoff":a[s.key]&&(a[s.key].stop(),delete a[s.key]);break}},i},i};(function(i){var n=We,e=ze,a=nt,t=st,r=lt;function o(s,c,u){return r(t(a(e(n(s,c,u)))))}i.exports&&(i.exports=o),typeof window<"u"&&(window.SamplePlayer=o)})(ae);var ft=ae.exports;function fe(i,n){return Array(n+1).join(i)}function j(i){return typeof i=="number"}function mt(i){return typeof i=="string"}function ht(i){return typeof i<"u"}function me(i,n){return Math.pow(2,(i-69)/12)*(n||440)}var he=/^([a-gA-G])(#{1,}|b{1,}|x{1,}|)(-?\d*)\s*(.*)\s*$/;function dt(){return he}var pt=[0,2,4,5,7,9,11];function q(i,n,e){if(typeof i!="string")return null;var a=he.exec(i);if(!a||!n&&a[4])return null;var t={letter:a[1].toUpperCase(),acc:a[2].replace(/x/g,"##")};t.pc=t.letter+t.acc,t.step=(t.letter.charCodeAt(0)+3)%7,t.alt=t.acc[0]==="b"?-t.acc.length:t.acc.length;var r=pt[t.step]+t.alt;return t.chroma=r<0?12+r:r%12,a[3]&&(t.oct=+a[3],t.midi=r+12*(t.oct+1),t.freq=me(t.midi,e)),n&&(t.tonicOf=a[4]),t}var gt="CDEFGAB";function yt(i){return j(i)?i<0?fe("b",-i):fe("#",i):""}function vt(i){return j(i)?""+i:""}function de(i,n,e){return i===null||typeof i>"u"?null:i.step?de(i.step,i.alt,i.oct):i<0||i>6?null:gt.charAt(i)+yt(n)+vt(e)}function pe(i){if((j(i)||mt(i))&&i>=0&&i<128)return+i;var n=q(i);return n&&ht(n.midi)?n.midi:null}function Tt(i,n){var e=pe(i);return e===null?null:me(e,n)}function At(i){return(q(i)||{}).letter}function Vt(i){return(q(i)||{}).acc}function wt(i){return(q(i)||{}).pc}function Gt(i){return(q(i)||{}).step}function Mt(i){return(q(i)||{}).alt}function bt(i){return(q(i)||{}).chroma}function Nt(i){return(q(i)||{}).oct}const St=Se(Object.freeze(Object.defineProperty({__proto__:null,acc:Vt,alt:Mt,build:de,chroma:bt,freq:Tt,letter:At,midi:pe,oct:Nt,parse:q,pc:wt,regex:dt,step:Gt},Symbol.toStringTag,{value:"Module"})));var U,ge;function xt(){if(ge)return U;ge=1;var i=St;function n(t,r){if(console.warn("new Soundfont() is deprected"),console.log("Please use Soundfont.instrument() instead of new Soundfont().instrument()"),!(this instanceof n))return new n(t);this.nameToUrl=r||n.nameToUrl,this.ctx=t,this.instruments={},this.promises=[]}n.prototype.onready=function(t){console.warn("deprecated API"),console.log("Please use Promise.all(Soundfont.instrument(), Soundfont.instrument()).then() instead of new Soundfont().onready()"),Promise.all(this.promises).then(t)},n.prototype.instrument=function(t,r){console.warn("new Soundfont().instrument() is deprecated."),console.log("Please use Soundfont.instrument() instead.");var o=this.ctx;if(t=t||"default",t in this.instruments)return this.instruments[t];var s={name:t,play:a(o,r)};if(this.instruments[t]=s,t!=="default"){var c=n.instrument(o,t,r).then(function(u){return s.play=u.play,s});this.promises.push(c),s.onready=function(u){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),c.then(u)}}else s.onready=function(u){console.warn("onready is deprecated. Use Soundfont.instrument().then()"),u()};return s};function e(t,r,o){return console.warn("Soundfont.loadBuffers is deprecate."),console.log("Use Soundfont.instrument(..) and get buffers properties from the result."),n.instrument(t,r,o).then(function(s){return s.buffers})}n.loadBuffers=e;function a(t,r){return r=r||{},function(o,s,c,u){console.warn("The oscillator player is deprecated."),console.log("Starting with version 0.9.0 you will have to wait until the soundfont is loaded to play sounds.");var l=o>0&&o<129?+o:i.midi(o),f=l?i.midiToFreq(l,440):null;if(f){c=c||.2,u=u||{};var m=u.destination||r.destination||t.destination,h=u.vcoType||r.vcoType||"sine",p=u.gain||r.gain||.4,g=t.createOscillator();g.type=h,g.frequency.value=f;var T=t.createGain();return T.gain.value=p,g.connect(T),T.connect(m),g.start(s),c>0&&g.stop(s+c),g}}}return n.noteToMidi=i.midi,U=n,U}(function(i){var n=Pe,e=ft;function a(s,c,u){if(arguments.length===1)return function(p,g){return a(s,p,g)};var l=u||{},f=l.isSoundfontURL||t,m=l.nameToUrl||r,h=f(c)?c:m(c,l.soundfont,l.format);return n(s,h,{only:l.only||l.notes}).then(function(p){var g=e(s,p,l).connect(l.destination?l.destination:s.destination);return g.url=h,g.name=c,g})}function t(s){return/\.js(\?.*)?$/i.test(s)}function r(s,c,u){return u=u==="ogg"?u:"mp3",c=c==="FluidR3_GM"?c:"MusyngKite","https://gleitz.github.io/midi-js-soundfonts/"+c+"/"+s+"-"+u+".js"}var o=xt();o.instrument=a,o.nameToUrl=r,i.exports&&(i.exports=o),typeof window<"u"&&(window.Soundfont=o)})(te);var Rt=te.exports;const qt=Ne(Rt),H={piano:"acoustic_grand_piano",electricPiano:"electric_piano_1",organ:"drawbar_organ",guitar:"acoustic_guitar_nylon",electricGuitar:"electric_guitar_clean",bass:"acoustic_bass",electricBass:"electric_bass_finger",strings:"string_ensemble_1",violin:"violin",cello:"cello",flute:"flute",trumpet:"trumpet",saxophone:"alto_sax",marimba:"marimba",vibraphone:"vibraphone",bells:"tubular_bells",pad:"pad_2_warm"};class ye{constructor(n=H.piano){y(this,"instrument",null);y(this,"instrumentName");y(this,"loading",!1);y(this,"outputNode");y(this,"activeNotes",new Map);this.instrumentName=n;const e=d();this.outputNode=e.createGain(),this.outputNode.gain.value=.7,this.outputNode.connect(R())}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}async loadInstrument(n){if(n&&(this.instrumentName=n),!this.loading){this.loading=!0;try{const e=d();this.instrument=await qt.instrument(e,this.instrumentName,{soundfont:"MusyngKite",destination:this.outputNode}),console.log(`Loaded instrument: ${this.instrumentName}`)}catch(e){console.error(`Failed to load instrument: ${this.instrumentName}`,e)}finally{this.loading=!1}}}isLoaded(){return this.instrument!==null}isLoading(){return this.loading}playNote(n,e,a=.5,t=.7){if(!this.instrument){console.warn("Instrument not loaded. Call loadInstrument() first.");return}const r=d(),o=e??r.currentTime;this.instrument.play(n.toString(),o,{duration:a,gain:t})}playNoteByFrequency(n,e,a=.5,t=.7){const r=Math.round(12*Math.log2(n/440)+69);this.playNote(r,e,a,t)}startNote(n,e=.7){if(!this.instrument)return console.warn("Instrument not loaded. Call loadInstrument() first."),-1;const a=this.instrument.play(n.toString(),void 0,{gain:e}),t=n*1e3+Math.random()*100;return this.activeNotes.set(t,a),t}startNoteByFrequency(n,e=.7){const a=Math.round(12*Math.log2(n/440)+69);return this.startNote(a,e)}releaseNote(n){const e=this.activeNotes.get(n);e&&(e.stop(),this.activeNotes.delete(n))}async setInstrument(n){this.stopAll(),this.instrument=null,await this.loadInstrument(n)}getInstrumentName(){return this.instrumentName}stopAll(){this.activeNotes.forEach(n=>{try{n.stop()}catch{}}),this.activeNotes.clear(),this.instrument&&this.instrument.stop()}}const Ot={decay:1.5,wet:.3,preDelay:.01};class W{constructor(n={}){y(this,"options");y(this,"inputNode");y(this,"outputNode");y(this,"wetGain");y(this,"dryGain");y(this,"convolver");y(this,"preDelayNode");this.options={...Ot,...n};const e=d();this.inputNode=e.createGain(),this.outputNode=e.createGain(),this.wetGain=e.createGain(),this.dryGain=e.createGain(),this.convolver=e.createConvolver(),this.preDelayNode=e.createDelay(1),this.wetGain.gain.value=this.options.wet,this.dryGain.gain.value=1-this.options.wet,this.preDelayNode.delayTime.value=this.options.preDelay,this.generateImpulseResponse(),this.inputNode.connect(this.dryGain),this.dryGain.connect(this.outputNode),this.inputNode.connect(this.preDelayNode),this.preDelayNode.connect(this.convolver),this.convolver.connect(this.wetGain),this.wetGain.connect(this.outputNode),this.outputNode.connect(R())}generateImpulseResponse(){const n=d(),e=X(),a=Math.ceil(e*this.options.decay),t=n.createBuffer(2,a,e),r=t.getChannelData(0),o=t.getChannelData(1);for(let s=0;s<a;s++){const c=Math.exp(-3*s/a),u=Math.random()*.2+.9;r[s]=(Math.random()*2-1)*c*u,o[s]=(Math.random()*2-1)*c*u}this.convolver.buffer=t}getInput(){return this.inputNode}getOutput(){return this.outputNode}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}setWet(n){this.options.wet=Math.max(0,Math.min(1,n));const e=d();this.wetGain.gain.setValueAtTime(this.options.wet,e.currentTime),this.dryGain.gain.setValueAtTime(1-this.options.wet,e.currentTime)}setDecay(n){this.options.decay=Math.max(.1,Math.min(10,n)),this.generateImpulseResponse()}setPreDelay(n){this.options.preDelay=Math.max(0,Math.min(.5,n));const e=d();this.preDelayNode.delayTime.setValueAtTime(this.options.preDelay,e.currentTime)}getOptions(){return{...this.options}}}const Pt={time:.3,feedback:.4,wet:.3};class z{constructor(n={}){y(this,"options");y(this,"inputNode");y(this,"outputNode");y(this,"wetGain");y(this,"dryGain");y(this,"delayNode");y(this,"feedbackNode");y(this,"filterNode");this.options={...Pt,...n};const e=d();this.inputNode=e.createGain(),this.outputNode=e.createGain(),this.wetGain=e.createGain(),this.dryGain=e.createGain(),this.delayNode=e.createDelay(5),this.feedbackNode=e.createGain(),this.filterNode=e.createBiquadFilter(),this.wetGain.gain.value=this.options.wet,this.dryGain.gain.value=1-this.options.wet,this.delayNode.delayTime.value=this.options.time,this.feedbackNode.gain.value=this.options.feedback,this.filterNode.type="lowpass",this.filterNode.frequency.value=4e3,this.inputNode.connect(this.dryGain),this.dryGain.connect(this.outputNode),this.inputNode.connect(this.delayNode),this.delayNode.connect(this.filterNode),this.filterNode.connect(this.wetGain),this.wetGain.connect(this.outputNode),this.filterNode.connect(this.feedbackNode),this.feedbackNode.connect(this.delayNode),this.outputNode.connect(R())}getInput(){return this.inputNode}getOutput(){return this.outputNode}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}setTime(n){this.options.time=Math.max(.01,Math.min(5,n));const e=d();this.delayNode.delayTime.setValueAtTime(this.options.time,e.currentTime)}setFeedback(n){this.options.feedback=Math.max(0,Math.min(.95,n));const e=d();this.feedbackNode.gain.setValueAtTime(this.options.feedback,e.currentTime)}setWet(n){this.options.wet=Math.max(0,Math.min(1,n));const e=d();this.wetGain.gain.setValueAtTime(this.options.wet,e.currentTime),this.dryGain.gain.setValueAtTime(1-this.options.wet,e.currentTime)}syncToTempo(n,e=1){const t=60/n/e;this.setTime(t)}getOptions(){return{...this.options}}}const It={reverbEnabled:!0,delayEnabled:!0};class ve{constructor(n={}){y(this,"options");y(this,"inputNode");y(this,"outputNode");y(this,"reverb");y(this,"delay");y(this,"reverbBypass");y(this,"delayBypass");this.options={...It,...n};const e=d();this.inputNode=e.createGain(),this.outputNode=e.createGain(),this.reverb=new W(n.reverb),this.delay=new z(n.delay),this.reverbBypass=e.createGain(),this.delayBypass=e.createGain(),this.setupRouting(),this.outputNode.connect(R())}setupRouting(){const n=d();this.inputNode.disconnect(),this.reverb.getOutput().disconnect(),this.delay.getOutput().disconnect(),this.options.delayEnabled?(this.inputNode.connect(this.delay.getInput()),this.delayBypass.gain.setValueAtTime(0,n.currentTime)):(this.inputNode.connect(this.delayBypass),this.delayBypass.gain.setValueAtTime(1,n.currentTime));const e=this.options.delayEnabled?this.delay.getOutput():this.delayBypass;this.options.reverbEnabled?(e.connect(this.reverb.getInput()),this.reverbBypass.gain.setValueAtTime(0,n.currentTime),this.reverb.connect(this.outputNode)):(e.connect(this.reverbBypass),this.reverbBypass.gain.setValueAtTime(1,n.currentTime),this.reverbBypass.connect(this.outputNode))}getInput(){return this.inputNode}getOutput(){return this.outputNode}connect(n){this.outputNode.disconnect(),this.outputNode.connect(n)}setReverbEnabled(n){this.options.reverbEnabled=n,this.setupRouting()}setDelayEnabled(n){this.options.delayEnabled=n,this.setupRouting()}getReverb(){return this.reverb}getDelay(){return this.delay}setReverbWet(n){this.reverb.setWet(n)}setReverbDecay(n){this.reverb.setDecay(n)}setDelayTime(n){this.delay.setTime(n)}setDelayFeedback(n){this.delay.setFeedback(n)}setDelayWet(n){this.delay.setWet(n)}}const P={};function $(i,n){P[i]&&console.warn(`Theme "${i}" is already registered. Overwriting.`),P[i]=n}function Te(i){return P[i]}function Ae(){return Object.keys(P)}const Ve=new Proxy({},{get(i,n){if(typeof n=="string")return P[n]},ownKeys(){return Object.keys(P)},has(i,n){return typeof n!="string"?!1:n in P}});class F extends D{constructor(){super(),this.registerPreset("deepSea",Bt),this.registerPreset("rov",Et),this.registerPreset("sonar",Ft),this.registerPreset("bioluminescence",Lt),this.registerPreset("hydrophone",_t),this.registerPreset("discovery",Dt),this.registerPreset("lab",kt),this.registerPreset("surface",Ct),this.registerPreset("tension",$t)}async play(n,e={}){return super.play(n,e)}async addLayer(n,e={}){return super.addLayer(n,e)}}function Bt(i,n){const e=d(),a={name:"deepSea",oscillators:[],gains:[],intervals:[]},t=Math.max(20,60-(n.depth||2e3)/100),r=e.createOscillator();r.type="sine",r.frequency.value=t;const o=e.createGain();o.gain.value=0,o.gain.linearRampToValueAtTime((n.intensity||.5)*.3,e.currentTime+(n.fadeIn||2));const s=e.createOscillator();s.type="sine",s.frequency.value=t/2;const c=e.createGain();c.gain.value=0,c.gain.linearRampToValueAtTime((n.intensity||.5)*.2,e.currentTime+(n.fadeIn||2));const u=e.createOscillator();u.type="sine",u.frequency.value=.05;const l=e.createGain();if(l.gain.value=5,u.connect(l),l.connect(r.frequency),r.connect(o),s.connect(c),o.connect(i.getMasterGain()),c.connect(i.getMasterGain()),r.start(),s.start(),u.start(),a.oscillators.push(r,s,u),a.gains.push(o,c),i.addFilteredNoise(a,(n.intensity||.5)*.1,100,400,n.fadeIn||2),(n.mystery||.3)>.2){const f=window.setInterval(()=>{i.getIsPlaying()&&Math.random()<(n.mystery||.3)&&jt(i,(n.intensity||.5)*.15)},8e3);a.intervals.push(f)}i.getLayers().push(a)}function Et(i,n){const e=d(),a={name:"rov",oscillators:[],gains:[],intervals:[]},t=e.createOscillator();t.type="sawtooth",t.frequency.value=60;const r=e.createBiquadFilter();r.type="lowpass",r.frequency.value=200,r.Q.value=2;const o=e.createGain();o.gain.value=0,o.gain.linearRampToValueAtTime((n.intensity||.5)*.15,e.currentTime+(n.fadeIn||2));const s=e.createOscillator();s.type="triangle",s.frequency.value=120;const c=e.createGain();c.gain.value=0,c.gain.linearRampToValueAtTime((n.intensity||.5)*.08,e.currentTime+(n.fadeIn||2)),t.connect(r),r.connect(o),o.connect(i.masterGain),s.connect(c),c.connect(i.masterGain),t.start(),s.start(),a.oscillators.push(t,s),a.gains.push(o,c);const u=window.setInterval(()=>{i.isPlaying&&Math.random()<.3&&Ut(i,(n.intensity||.5)*.2)},4e3);a.intervals.push(u),i.layers.push(a)}function Ft(i,n){const e={name:"sonar",oscillators:[],gains:[],intervals:[]},a=window.setInterval(()=>{i.isPlaying&&we(i,(n.intensity||.5)*.4)},(n.interval||5)*1e3);e.intervals.push(a),setTimeout(()=>we(i,(n.intensity||.5)*.4),500),i.layers.push(e)}function Lt(i,n){const e=d(),a={name:"bioluminescence",oscillators:[],gains:[],intervals:[]};[220,330,440,554].forEach((o,s)=>{const c=e.createOscillator();c.type="sine",c.frequency.value=o;const u=e.createGain();u.gain.value=0,u.gain.linearRampToValueAtTime((n.intensity||.5)*.08,e.currentTime+(n.fadeIn||2)+s*.5);const l=e.createOscillator();l.type="sine",l.frequency.value=.2+s*.1;const f=e.createGain();f.gain.value=(n.intensity||.5)*.02,l.connect(f),f.connect(u.gain),c.connect(u),u.connect(i.masterGain),c.start(),l.start(),a.oscillators.push(c,l),a.gains.push(u)});const r=window.setInterval(()=>{i.isPlaying&&Math.random()<.4&&Ht(i,(n.intensity||.5)*.15)},3e3);a.intervals.push(r),i.layers.push(a)}function _t(i,n){const e={name:"hydrophone",oscillators:[],gains:[],intervals:[]};i.addFilteredNoise(e,(n.intensity||.5)*.15,200,2e3,n.fadeIn||2);const a=window.setInterval(()=>{i.isPlaying&&Math.random()<.5&&Wt(i,(n.intensity||.5)*.1)},2e3);e.intervals.push(a),i.layers.push(e)}function Dt(i,n){const e=d(),a={name:"discovery",oscillators:[],gains:[],intervals:[]},t=e.createOscillator();t.type="sine",t.frequency.value=80,t.frequency.linearRampToValueAtTime(120,e.currentTime+10);const r=e.createBiquadFilter();r.type="lowpass",r.frequency.value=300;const o=e.createGain();o.gain.value=0,o.gain.linearRampToValueAtTime((n.intensity||.5)*.2,e.currentTime+(n.fadeIn||2));const s=e.createOscillator();s.type="sine",s.frequency.value=440;const c=e.createGain();c.gain.value=0,c.gain.linearRampToValueAtTime((n.intensity||.5)*.1,e.currentTime+(n.fadeIn||2)+2),t.connect(r),r.connect(o),o.connect(i.masterGain),s.connect(c),c.connect(i.masterGain),t.start(),s.start(),a.oscillators.push(t,s),a.gains.push(o,c),i.layers.push(a)}function kt(i,n){const e=d(),a={name:"lab",oscillators:[],gains:[],intervals:[]},t=e.createOscillator();t.type="sine",t.frequency.value=60;const r=e.createGain();r.gain.value=0,r.gain.linearRampToValueAtTime((n.intensity||.5)*.05,e.currentTime+(n.fadeIn||2));const o=e.createOscillator();o.type="triangle",o.frequency.value=120;const s=e.createGain();s.gain.value=0,s.gain.linearRampToValueAtTime((n.intensity||.5)*.03,e.currentTime+(n.fadeIn||2)),t.connect(r),r.connect(i.masterGain),o.connect(s),s.connect(i.masterGain),t.start(),o.start(),a.oscillators.push(t,o),a.gains.push(r,s);const c=window.setInterval(()=>{i.isPlaying&&Math.random()<.3&&zt(i,(n.intensity||.5)*.15)},5e3);a.intervals.push(c),i.layers.push(a)}function Ct(i,n){const e=d(),a={name:"surface",oscillators:[],gains:[],intervals:[]};i.addFilteredNoise(a,(n.intensity||.5)*.2,100,800,n.fadeIn||2);const t=e.createOscillator();t.type="sine",t.frequency.value=.1;const r=e.createGain();r.gain.value=0,r.gain.linearRampToValueAtTime((n.intensity||.5)*.1,e.currentTime+(n.fadeIn||2)),t.connect(r),r.connect(i.masterGain),t.start(),a.oscillators.push(t),a.gains.push(r),i.layers.push(a)}function $t(i,n){const e=d(),a={name:"tension",oscillators:[],gains:[],intervals:[]},t=e.createOscillator();t.type="sine",t.frequency.value=30;const r=e.createGain();r.gain.value=0,r.gain.linearRampToValueAtTime((n.intensity||.5)*.25,e.currentTime+(n.fadeIn||2));const o=e.createOscillator();o.type="sine",o.frequency.value=233;const s=e.createGain();s.gain.value=0,s.gain.linearRampToValueAtTime((n.intensity||.5)*.08,e.currentTime+(n.fadeIn||2)+3),t.connect(r),r.connect(i.masterGain),o.connect(s),s.connect(i.masterGain),t.start(),o.start(),a.oscillators.push(t,o),a.gains.push(r,s),i.layers.push(a)}function we(i,n){const e=d(),a=e.createOscillator();a.type="sine",a.frequency.value=1200,a.frequency.exponentialRampToValueAtTime(800,e.currentTime+.3);const t=e.createGain();t.gain.value=n,t.gain.exponentialRampToValueAtTime(.001,e.currentTime+2),a.connect(t),t.connect(i.masterGain),a.start(),a.stop(e.currentTime+2)}function jt(i,n){const e=d(),a=[55,82.5,110,165],t=a[Math.floor(Math.random()*a.length)],r=e.createOscillator();r.type="sine",r.frequency.value=t;const o=e.createGain();o.gain.value=0,o.gain.linearRampToValueAtTime(n,e.currentTime+2),o.gain.linearRampToValueAtTime(0,e.currentTime+6),r.connect(o),o.connect(i.masterGain),r.start(),r.stop(e.currentTime+6)}function Ut(i,n){const e=d(),a=e.createOscillator();a.type="sawtooth",a.frequency.value=200+Math.random()*100,a.frequency.linearRampToValueAtTime(150+Math.random()*50,e.currentTime+.3);const t=e.createBiquadFilter();t.type="bandpass",t.frequency.value=400,t.Q.value=5;const r=e.createGain();r.gain.value=n,r.gain.exponentialRampToValueAtTime(.001,e.currentTime+.3),a.connect(t),t.connect(r),r.connect(i.masterGain),a.start(),a.stop(e.currentTime+.3)}function Ht(i,n){const e=d(),a=800+Math.random()*400;for(let t=0;t<3;t++){const r=e.createOscillator();r.type="sine",r.frequency.value=a*(1+t*.5);const o=e.createGain();o.gain.value=0,o.gain.linearRampToValueAtTime(n*(1-t*.3),e.currentTime+.1),o.gain.exponentialRampToValueAtTime(.001,e.currentTime+1.5),r.connect(o),o.connect(i.masterGain),r.start(e.currentTime+t*.1),r.stop(e.currentTime+1.5)}}function Wt(i,n){const e=d(),a=e.sampleRate*.1,t=e.createBuffer(1,a,e.sampleRate),r=t.getChannelData(0);for(let u=0;u<a;u++)r[u]=(Math.random()*2-1)*Math.random();const o=e.createBufferSource();o.buffer=t;const s=e.createBiquadFilter();s.type="highpass",s.frequency.value=2e3;const c=e.createGain();c.gain.value=n,c.gain.exponentialRampToValueAtTime(.001,e.currentTime+.1),o.connect(s),s.connect(c),c.connect(i.masterGain),o.start()}function zt(i,n){const e=d(),a=e.createOscillator();a.type="sine",a.frequency.value=880;const t=e.createGain();t.gain.value=n,t.gain.setValueAtTime(n,e.currentTime+.1),t.gain.exponentialRampToValueAtTime(.001,e.currentTime+.15),a.connect(t),t.connect(i.masterGain),a.start(),a.stop(e.currentTime+.15)}class L extends k{constructor(n=.5){super(n),this.registerSound("sonarPing",Jt),this.registerSound("sonarReturn",Qt),this.registerSound("notification",Kt),this.registerSound("error",Xt),this.registerSound("success",Yt),this.registerSound("click",Zt),this.registerSound("hover",en),this.registerSound("open",tn),this.registerSound("close",nn),this.registerSound("discovery",an),this.registerSound("warning",rn),this.registerSound("transmit",on),this.registerSound("receive",sn),this.registerSound("depth",cn),this.registerSound("pressure",un),this.registerSound("creature",ln)}async play(n){return super.play(n)}}function Jt(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.setValueAtTime(1200,e),a.frequency.exponentialRampToValueAtTime(800,e+.3);const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.6,e),t.gain.exponentialRampToValueAtTime(.001,e+2),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+2)}function Qt(i){setTimeout(()=>{const n=d(),e=n.createOscillator();e.type="sine",e.frequency.setValueAtTime(900,n.currentTime),e.frequency.exponentialRampToValueAtTime(600,n.currentTime+.2);const a=n.createGain();a.gain.setValueAtTime(i.getVolume()*.2,n.currentTime),a.gain.exponentialRampToValueAtTime(.001,n.currentTime+1),e.connect(a),a.connect(i.getMasterGain()),e.start(),e.stop(n.currentTime+1)},800)}function Kt(i){const n=d(),e=n.currentTime;[440,554,659].forEach((a,t)=>{const r=n.createOscillator();r.type="sine",r.frequency.value=a;const o=n.createGain();o.gain.setValueAtTime(0,e+t*.1),o.gain.linearRampToValueAtTime(i.getVolume()*.3,e+t*.1+.05),o.gain.exponentialRampToValueAtTime(.001,e+t*.1+.4),r.connect(o),o.connect(i.getMasterGain()),r.start(e+t*.1),r.stop(e+t*.1+.4)})}function Xt(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="square",a.frequency.setValueAtTime(200,e),a.frequency.setValueAtTime(150,e+.1);const t=n.createBiquadFilter();t.type="lowpass",t.frequency.value=400;const r=n.createGain();r.gain.setValueAtTime(i.getVolume()*.3,e),r.gain.setValueAtTime(i.getVolume()*.3,e+.2),r.gain.exponentialRampToValueAtTime(.001,e+.3),a.connect(t),t.connect(r),r.connect(i.getMasterGain()),a.start(e),a.stop(e+.3)}function Yt(i){const n=d(),e=n.currentTime;[523,659,784].forEach((a,t)=>{const r=n.createOscillator();r.type="sine",r.frequency.value=a;const o=n.createGain();o.gain.setValueAtTime(0,e+t*.08),o.gain.linearRampToValueAtTime(i.getVolume()*.25,e+t*.08+.03),o.gain.exponentialRampToValueAtTime(.001,e+t*.08+.5),r.connect(o),o.connect(i.getMasterGain()),r.start(e+t*.08),r.stop(e+t*.08+.5)})}function Zt(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.value=800;const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.2,e),t.gain.exponentialRampToValueAtTime(.001,e+.05),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+.05)}function en(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.value=600;const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.08,e),t.gain.exponentialRampToValueAtTime(.001,e+.03),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+.03)}function tn(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.setValueAtTime(300,e),a.frequency.exponentialRampToValueAtTime(500,e+.15);const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.2,e),t.gain.exponentialRampToValueAtTime(.001,e+.2),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+.2)}function nn(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.setValueAtTime(500,e),a.frequency.exponentialRampToValueAtTime(300,e+.15);const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.2,e),t.gain.exponentialRampToValueAtTime(.001,e+.2),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+.2)}function an(i){const n=d(),e=n.currentTime;[261,329,392,523,659].forEach((a,t)=>{const r=n.createOscillator();r.type="sine",r.frequency.value=a;const o=n.createGain();o.gain.setValueAtTime(0,e+t*.1),o.gain.linearRampToValueAtTime(i.getVolume()*.2,e+t*.1+.05),o.gain.exponentialRampToValueAtTime(.001,e+t*.1+1),r.connect(o),o.connect(i.getMasterGain()),r.start(e+t*.1),r.stop(e+t*.1+1)})}function rn(i){const n=d(),e=n.currentTime;for(let a=0;a<3;a++){const t=n.createOscillator();t.type="square",t.frequency.value=440;const r=n.createBiquadFilter();r.type="lowpass",r.frequency.value=600;const o=n.createGain();o.gain.setValueAtTime(i.getVolume()*.25,e+a*.3),o.gain.setValueAtTime(0,e+a*.3+.15),t.connect(r),r.connect(o),o.connect(i.getMasterGain()),t.start(e+a*.3),t.stop(e+a*.3+.15)}}function on(i){const n=d(),e=n.currentTime;for(let a=0;a<5;a++){const t=n.createOscillator();t.type="sine",t.frequency.value=1e3+Math.random()*500;const r=n.createGain();r.gain.setValueAtTime(i.getVolume()*.15,e+a*.05),r.gain.exponentialRampToValueAtTime(.001,e+a*.05+.05),t.connect(r),r.connect(i.getMasterGain()),t.start(e+a*.05),t.stop(e+a*.05+.05)}}function sn(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.setValueAtTime(600,e),a.frequency.linearRampToValueAtTime(800,e+.1);const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.2,e),t.gain.exponentialRampToValueAtTime(.001,e+.15),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+.15)}function cn(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.setValueAtTime(200,e),a.frequency.exponentialRampToValueAtTime(80,e+.5);const t=n.createGain();t.gain.setValueAtTime(i.getVolume()*.3,e),t.gain.exponentialRampToValueAtTime(.001,e+.5),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+.5)}function un(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.value=40;const t=n.createGain();t.gain.setValueAtTime(0,e),t.gain.linearRampToValueAtTime(i.getVolume()*.4,e+.2),t.gain.linearRampToValueAtTime(0,e+1),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+1)}function ln(i){const n=d(),e=n.currentTime,a=n.createOscillator();a.type="sine",a.frequency.setValueAtTime(150,e),a.frequency.exponentialRampToValueAtTime(200,e+.5),a.frequency.exponentialRampToValueAtTime(120,e+1.5),a.frequency.exponentialRampToValueAtTime(180,e+2);const t=n.createGain();t.gain.setValueAtTime(0,e),t.gain.linearRampToValueAtTime(i.getVolume()*.2,e+.3),t.gain.setValueAtTime(i.getVolume()*.2,e+1.5),t.gain.exponentialRampToValueAtTime(.001,e+2.5),a.connect(t),t.connect(i.getMasterGain()),a.start(e),a.stop(e+2.5)}$("deepSea",{Ambience:F,SoundEffect:L});class J extends D{constructor(){super();y(this,"growthLevel",0);y(this,"activeFieldStationLayer",null);this.registerPreset("fieldStation",this.createFieldStationAmbience.bind(this)),this.registerPreset("researchLab",this.createResearchLabAmbience.bind(this))}updateGrowthLevel(e){if(this.growthLevel=Math.max(0,Math.min(100,e)),this.activeFieldStationLayer){this.cleanupLayerTimeouts(this.activeFieldStationLayer);const t=d().currentTime;for(const r of this.activeFieldStationLayer.gains)r.gain.linearRampToValueAtTime(0,t+.5);setTimeout(()=>{const r={intensity:.18,growthLevel:this.growthLevel,fadeIn:1};this.createFieldStationAmbience(this,r)},500)}}stop(e=1){for(const a of this.getLayers())this.cleanupLayerTimeouts(a);super.stop(e)}cleanupLayerTimeouts(e){e.birdTimeouts&&(e.birdTimeouts.forEach(a=>clearTimeout(a)),e.birdTimeouts=[]),e.rustleTimeouts&&(e.rustleTimeouts.forEach(a=>clearTimeout(a)),e.rustleTimeouts=[]),e.organicTimeouts&&(e.organicTimeouts.forEach(a=>clearTimeout(a)),e.organicTimeouts=[])}getGrowthLevel(){return this.growthLevel}async play(e,a={}){return a.growthLevel!==void 0&&(this.growthLevel=Math.max(0,Math.min(100,a.growthLevel))),super.play(e,a)}createFieldStationAmbience(e,a){const t={name:"fieldStation",oscillators:[],gains:[],intervals:[]},r=a.growthLevel??this.growthLevel,o=a.intensity||.3,s=a.fadeIn||2,c=this.getStage(r);this.addNatureLayer(t,e,c,o,s),this.addLabLayer(t,e,c,o,s),c>=2&&this.addOrganicLayer(t,e,c,o,s),this.activeFieldStationLayer=t,e.getLayers().push(t)}createResearchLabAmbience(e,a){const t=d(),r={name:"researchLab",oscillators:[],gains:[],intervals:[]},o=a.growthLevel??this.growthLevel,s=a.intensity||.18,c=a.fadeIn||2,u=this.getStage(o),l=t.createOscillator();l.type="triangle",l.frequency.value=60;const f=t.createBiquadFilter();f.type="lowpass",f.frequency.value=u>=2?150:200;const m=t.createGain();if(m.gain.value=0,m.gain.linearRampToValueAtTime(s*.08,t.currentTime+c),u>=2){const h=t.createOscillator();h.type="sine",h.frequency.value=.3;const p=t.createGain();p.gain.value=s*.02,h.connect(p),p.connect(m.gain),h.start(),r.oscillators.push(h)}l.connect(f),f.connect(m),m.connect(e.getMasterGain()),l.start(),r.oscillators.push(l),r.gains.push(m),e.getLayers().push(r)}getStage(e){return e<20?0:e<50?1:e<80?2:3}addNatureLayer(e,a,t,r,o){const s=d(),c=s.createBufferSource(),u=s.sampleRate*45,l=s.createBuffer(1,u,s.sampleRate),f=l.getChannelData(0);for(let w=0;w<u;w++){const S=w/u,M=.9+.2*Math.sin(S*Math.PI*2);f[w]=(Math.random()*2-1)*Math.pow(Math.random(),.5)*M}c.buffer=l,c.loop=!0;const m=s.createBiquadFilter();m.type="lowpass",m.frequency.value=t>=2?400:800;const h=s.createOscillator();h.type="sine",h.frequency.value=.02;const p=s.createGain();if(p.gain.value=r*.03,h.connect(p),t>=2){const w=s.createWaveShaper();w.curve=this.makeDistortionCurve(t===3?30:15),w.oversample="4x",c.connect(w),w.connect(m)}else c.connect(m);const g=s.createGain();g.gain.value=0,g.gain.linearRampToValueAtTime(r*.12,s.currentTime+o),p.connect(g.gain),m.connect(g),g.connect(a.getMasterGain()),c.start(),h.start(),e.noiseSource=c,e.oscillators.push(h),e.gains.push(g);const T=t>=2?2:4;for(let w=0;w<T;w++){const S=Math.random()*5e3;setTimeout(()=>{this.scheduleNextBirdChirp(a,e,t,r,w)},S)}}scheduleNextBirdChirp(e,a,t,r,o){if(!e.getIsPlaying())return;const s=t>=2?12e3:8e3,c=.7+o*.2,u=s*c,l=-Math.log(Math.random())*u,f=Math.max(2e3,Math.min(6e4,l)),h=Math.random()<.1?f+(3e4+Math.random()*6e4):f,p=window.setTimeout(()=>{if(!e.getIsPlaying())return;const g=r*.08*(.7+Math.random()*.3);this.playBirdChirp(e,t,g),this.scheduleNextBirdChirp(e,a,t,r,o)},h);a.birdTimeouts||(a.birdTimeouts=[]),a.birdTimeouts.push(p)}addLabLayer(e,a,t,r,o){const s=d(),c=s.createOscillator();c.type="sine",c.frequency.value=60;const u=s.createGain();if(u.gain.value=0,u.gain.linearRampToValueAtTime(r*.05,s.currentTime+o),t>=2){const l=s.createOscillator();l.type="sine",l.frequency.value=.4;const f=s.createGain();f.gain.value=r*.02,l.connect(f),f.connect(u.gain),l.start(),e.oscillators.push(l)}c.connect(u),u.connect(a.getMasterGain()),c.start(),e.oscillators.push(c),e.gains.push(u),this.scheduleNextRustle(a,e,t,r)}addOrganicLayer(e,a,t,r,o){const s=d();if(this.scheduleNextOrganicGrowth(a,e,t,r),t===3){const c=s.createOscillator();c.type="sine",c.frequency.value=40;const u=s.createGain();u.gain.value=0,u.gain.linearRampToValueAtTime(r*.08,s.currentTime+o),c.connect(u),u.connect(a.getMasterGain()),c.start(),e.oscillators.push(c),e.gains.push(u)}}playBirdChirp(e,a,t){const r=d(),o=r.currentTime,s=700+Math.random()*500,u=(a>=2?s*(a===3?.5:.7):s)*(1+(Math.random()-.5)*.1),l=r.createOscillator();l.type="sine",l.frequency.value=u;const f=.15+Math.random()*.1;if(a===3)l.frequency.setValueAtTime(u,o),l.frequency.exponentialRampToValueAtTime(u*1.5,o+f*.5);else{const p=u*(1.15+Math.random()*.1),g=u*(.95+Math.random()*.1);l.frequency.setValueAtTime(p,o),l.frequency.exponentialRampToValueAtTime(g,o+f)}const m=t*(.8+Math.random()*.2),h=r.createGain();h.gain.setValueAtTime(0,o),h.gain.linearRampToValueAtTime(m,o+f*.2),h.gain.exponentialRampToValueAtTime(.001,o+f),l.connect(h),h.connect(e.getMasterGain()),l.start(o),l.stop(o+f)}scheduleNextRustle(e,a,t,r){if(!e.getIsPlaying())return;const o=15e3+Math.random()*1e4,s=-Math.log(Math.random())*o,c=Math.max(5e3,Math.min(45e3,s)),u=window.setTimeout(()=>{if(e.getIsPlaying()){if(Math.random()<.3){const l=r*.08*(.8+Math.random()*.2);this.playRustle(e,t,l)}this.scheduleNextRustle(e,a,t,r)}},c);a.rustleTimeouts||(a.rustleTimeouts=[]),a.rustleTimeouts.push(u)}scheduleNextOrganicGrowth(e,a,t,r){if(!e.getIsPlaying())return;const s=(t===3?8e3:12e3)+Math.random()*7e3,c=-Math.log(Math.random())*s,u=Math.max(3e3,Math.min(3e4,c)),l=window.setTimeout(()=>{if(!e.getIsPlaying())return;const f=t===3?.5:.3;if(Math.random()<f){const m=r*.1*(.7+Math.random()*.3);this.playOrganicGrowth(e,t,m)}this.scheduleNextOrganicGrowth(e,a,t,r)},u);a.organicTimeouts||(a.organicTimeouts=[]),a.organicTimeouts.push(l)}playRustle(e,a,t){const r=d(),o=r.currentTime,s=r.sampleRate*.3,c=r.createBuffer(1,s,r.sampleRate),u=c.getChannelData(0);for(let h=0;h<s;h++)u[h]=(Math.random()*2-1)*Math.random()*.5;const l=r.createBufferSource();l.buffer=c;const f=r.createBiquadFilter();f.type="bandpass",f.frequency.value=a>=2?2e3:3e3,f.Q.value=2;const m=r.createGain();m.gain.setValueAtTime(t,o),m.gain.exponentialRampToValueAtTime(.001,o+.3),l.connect(f),f.connect(m),m.connect(e.getMasterGain()),l.start()}playOrganicGrowth(e,a,t){const r=d(),o=r.currentTime,s=r.createOscillator();s.type="sine",s.frequency.setValueAtTime(100,o),s.frequency.exponentialRampToValueAtTime(150,o+.5);const c=r.createBiquadFilter();c.type="lowpass",c.frequency.value=300;const u=r.createGain();u.gain.setValueAtTime(0,o),u.gain.linearRampToValueAtTime(t*.5,o+.3),u.gain.exponentialRampToValueAtTime(.001,o+.8),s.connect(c),c.connect(u),u.connect(e.getMasterGain()),s.start(o),s.stop(o+.8)}makeDistortionCurve(e){const t=new Float32Array(44100),r=Math.PI/180;for(let o=0;o<44100;o++){const s=o*2/44100-1;t[o]=(3+e)*s*20*r/(Math.PI+e*Math.abs(s))}return t}}class Q extends k{constructor(e=.5){super(e);y(this,"growthLevel",0);this.registerSound("fileConsume",this.playFileConsume.bind(this)),this.registerSound("systemNotification",this.playSystemNotification.bind(this)),this.registerSound("growth",this.playGrowth.bind(this)),this.registerSound("glitch",this.playGlitch.bind(this))}setGrowthLevel(e){this.growthLevel=Math.max(0,Math.min(100,e))}getGrowthLevel(){return this.growthLevel}async play(e,a={}){a.growthLevel!==void 0&&(this.growthLevel=Math.max(0,Math.min(100,a.growthLevel)));const t=this.getVolume();a.volume!==void 0&&this.setVolume(a.volume),await super.play(e),a.volume!==void 0&&this.setVolume(t)}playFileConsume(e){const a=d(),t=a.currentTime,r=this.getStage(this.growthLevel),o=a.sampleRate*.2,s=a.createBuffer(1,o,a.sampleRate),c=s.getChannelData(0);for(let m=0;m<o;m++){const h=m/o,p=Math.sin(h*Math.PI*8)*Math.exp(-h*5),g=Math.sin(h*Math.PI*12)*Math.exp(-(h-.3)*8),T=Math.sin(h*Math.PI*6)*Math.exp(-(h-.6)*6);c[m]=(p+g*.5+T*.3)*.3}const u=a.createBufferSource();u.buffer=s;const l=a.createBiquadFilter();l.type="bandpass",l.frequency.value=r>=2?800:1200,l.Q.value=3;const f=a.createGain();f.gain.setValueAtTime(0,t),f.gain.linearRampToValueAtTime(e.getVolume()*.4,t+.05),f.gain.exponentialRampToValueAtTime(.001,t+.3),u.connect(l),l.connect(f),f.connect(e.getMasterGain()),u.start(t),setTimeout(()=>{this.playRustleLayer(e,r)},50)}playSystemNotification(e){const a=d(),t=a.currentTime,r=this.getStage(this.growthLevel);(r>=2?[440,523]:[440,554,659]).forEach((s,c)=>{const u=a.createOscillator();u.type="sine";const l=r>=2?s*(.95+Math.random()*.1):s;u.frequency.value=l;const f=a.createGain();if(f.gain.setValueAtTime(0,t+c*.05),f.gain.linearRampToValueAtTime(e.getVolume()*.25,t+c*.05+.03),f.gain.exponentialRampToValueAtTime(.001,t+c*.05+.3),r>=2){const m=a.createBiquadFilter();m.type="lowpass",m.frequency.value=r===3?400:600,u.connect(m),m.connect(f)}else u.connect(f);f.connect(e.getMasterGain()),u.start(t+c*.05),u.stop(t+c*.05+.3)}),r>=2&&setTimeout(()=>{this.playOrganicUndertone(e,r)},100)}playGrowth(e){const a=d(),t=a.currentTime,r=a.createOscillator();r.type="sine",r.frequency.setValueAtTime(80,t),r.frequency.exponentialRampToValueAtTime(120,t+1);const o=a.createBiquadFilter();o.type="lowpass",o.frequency.value=200;const s=a.createGain();s.gain.setValueAtTime(0,t),s.gain.linearRampToValueAtTime(e.getVolume()*.15,t+.5),s.gain.exponentialRampToValueAtTime(.001,t+1.5),r.connect(o),o.connect(s),s.connect(e.getMasterGain()),r.start(t),r.stop(t+1.5),setTimeout(()=>{this.playGrowthTexture(e)},200)}playGlitch(e){const a=d(),t=a.currentTime,r=a.createOscillator();r.type="square",r.frequency.setValueAtTime(200,t),r.frequency.setValueAtTime(150,t+.02),r.frequency.setValueAtTime(250,t+.04);const o=a.createBiquadFilter();o.type="lowpass",o.frequency.value=400;const s=a.createGain();s.gain.setValueAtTime(e.getVolume()*.2,t),s.gain.setValueAtTime(0,t+.06),r.connect(o),o.connect(s),s.connect(e.getMasterGain()),r.start(t),r.stop(t+.06)}getStage(e){return e<20?0:e<50?1:e<80?2:3}playRustleLayer(e,a){const t=d(),r=t.currentTime,o=t.sampleRate*.1,s=t.createBuffer(1,o,t.sampleRate),c=s.getChannelData(0);for(let m=0;m<o;m++)c[m]=(Math.random()*2-1)*Math.random()*.2;const u=t.createBufferSource();u.buffer=s;const l=t.createBiquadFilter();l.type="highpass",l.frequency.value=2e3;const f=t.createGain();f.gain.setValueAtTime(e.getVolume()*.1,r),f.gain.exponentialRampToValueAtTime(.001,r+.15),u.connect(l),l.connect(f),f.connect(e.getMasterGain()),u.start()}playOrganicUndertone(e,a){const t=d(),r=t.currentTime,o=t.createOscillator();o.type="sine",o.frequency.value=100;const s=t.createBiquadFilter();s.type="lowpass",s.frequency.value=150;const c=t.createGain();c.gain.setValueAtTime(0,r),c.gain.linearRampToValueAtTime(e.getVolume()*.08,r+.1),c.gain.exponentialRampToValueAtTime(.001,r+.4),o.connect(s),s.connect(c),c.connect(e.getMasterGain()),o.start(r),o.stop(r+.4)}playGrowthTexture(e){const a=d(),t=a.currentTime,r=a.sampleRate*.2,o=a.createBuffer(1,r,a.sampleRate),s=o.getChannelData(0);for(let f=0;f<r;f++)s[f]=(Math.random()*2-1)*Math.random()*.1;const c=a.createBufferSource();c.buffer=o;const u=a.createBiquadFilter();u.type="bandpass",u.frequency.value=500,u.Q.value=2;const l=a.createGain();l.gain.setValueAtTime(e.getVolume()*.05,t),l.gain.exponentialRampToValueAtTime(.001,t+.3),c.connect(u),u.connect(l),l.connect(e.getMasterGain()),c.start()}}$("livingOs",{Ambience:J,SoundEffect:Q}),typeof window<"u"&&(window.MusicPlayground={CoreAmbience:D,CoreSoundEffect:k,Ambience:F,SoundEffect:L,Synth:Y,PhysicalModel:Z,DrumSynth:ee,Sampler:ye,INSTRUMENTS:H,EffectsChain:ve,Reverb:W,Delay:z,registerTheme:$,getTheme:Te,getThemeNames:Ae,themes:Ve,DeepSeaAmbience:F,DeepSeaSoundEffect:L,LivingOsAmbience:J,LivingOsSoundEffect:Q}),V.Ambience=F,V.CoreAmbience=D,V.CoreSoundEffect=k,V.DeepSeaAmbience=F,V.DeepSeaSoundEffect=L,V.Delay=z,V.DrumSynth=ee,V.EffectsChain=ve,V.INSTRUMENTS=H,V.LivingOsAmbience=J,V.LivingOsSoundEffect=Q,V.PhysicalModel=Z,V.Reverb=W,V.Sampler=ye,V.SoundEffect=L,V.Synth=Y,V.getTheme=Te,V.getThemeNames=Ae,V.registerTheme=$,V.themes=Ve,Object.defineProperty(V,Symbol.toStringTag,{value:"Module"})});
